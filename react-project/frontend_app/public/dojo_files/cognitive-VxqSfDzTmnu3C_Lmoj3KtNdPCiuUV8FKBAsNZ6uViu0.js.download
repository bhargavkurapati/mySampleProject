/* © Copyright HCL Technologies Ltd. 2018 */
(function(){(this||window).webpackJsonp.registerAbsMids({"app/layers/cognitiveLayer":569,"lodash/sortBy":622,"app/cognitive/algorithmlib/svm_Kernel":782,"app/cognitive/algorithmlib/svm_Cache":867,"sml/plugins/WebWorkerForText":952,"app/cognitive/algorithmlib/svm_Solver":1466,"app/cognitive/algorithmlib/svm_parameter":1467,"app/cognitive/util/cognitive-worker-channel":1468,"app/cognitive/suggestedPeopleTimingParams":1469,"app/util/convertSolrNameToNameModel":1470,"app/cognitive/ServiceDelegator":1471,"sml/util/asyncSetTimeout":2983,"app/redux/cognitive/components/suggested-recipients":3471,"app/cognitive/constructSuggestedRecipientsComponents":3472,"app/cognitive/algorithmlib/svm_ONE_CLASS_Q":3473,"app/cognitive/algorithmlib/svm_SVC_Q":3474,"app/cognitive/algorithmlib/svm_SVR_Q":3475,"app/cognitive/algorithmlib/svm_model":3476,"app/cognitive/algorithmlib/svm_problem":3477,"app/cognitive/algorithmlib/svm_node":3479,"app/cognitive/algorithmlib/svm_Solver_NU":3480,"app/cognitive/algorithmlib/svm":3481,"app/cognitive/algorithmlib/TFIDF_stop_words":3482,"app/cognitive/algorithmlib/TFIDF_VectorizerMxin":3484,"app/cognitive/algorithmlib/TFIDF_CountVectorizer":3485,"app/cognitive/algorithmlib/TFIDF_Transformer":3486,"app/cognitive/algorithmlib/TFIDF_Vectorizer":3487,"app/cognitive-es/svm-worker":3488,"sml/plugins/WebWorker!app/cognitive-es/svm-worker":3489,"app/cognitive/folders/FolderSuggestionClass":3492,"app/cognitive/folders/FolderSuggestion":3493,"app/cognitive/CognitiveFolderControllerClass":3494,"app/cognitive/CognitiveFolderController":3495,"sml/plugins/text!app/cognitive-es/build/cognitive-worker.js":3496,"sml/plugins/WebWorkerForText!app/cognitive-es/build/cognitive-worker.js":3497,"app/cognitive/util/dominoRequestQueuerClass":3498,"app/cognitive/util/dataCollection":3499,"app/cognitive/GraphDataProcessor":3500,"lodash/unionWith":3501,"app/cognitive/util/BotLookupQueue":3502,"app/cognitive/util/NameLookupQueue":3503,"app/cognitive/DataCollector":3504,"sml/plugins/css!app/redux/cognitive/components/suggested-recipients.less":5510})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{1466:function(t,e,r){var n;function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}void 0===(n=function(){function t(e){var r;if(null==e||"object"!=i(e))return e;if(e instanceof Date)return(r=new Date).setTime(e.getTime()),r;if(e instanceof Array){r=[];for(var n=0,o=e.length;n<o;n++)r[n]=t(e[n]);return r}if(e instanceof Object){for(var s in r={},e)e.hasOwnProperty(s)&&(r[s]=t(e[s]));return r}}function e(t,e){for(var r=new Array(t),n=0;n<t;n++)r[n]=e;return r}function r(){this.active_size=0,this.y=null,this.G=null,this.alpha_status=null,this.alpha=null,this.Q=null,this.QD=null,this.eps=0,this.Cp=0,this.Cn=0,this.p=null,this.active_set=null,this.G_bar=null,this.l=0,this.unshrink=!1}return r.prototype.Solve=function(r,n,i,o,s,a,u,h,l,c){if(0!=arguments.length){this.active_size=0,this.y=null,this.G=null,this.alpha_status=null,this.alpha=null,this.Q=null,this.QD=null,this.eps=0,this.Cp=0,this.Cn=0,this.p=null,this.active_set=null,this.G_bar=null,this.l=0,this.unshrink=!1,this.l=r,this.Q=n,this.QD=n.get_QD(),this.p=t(i),this.y=t(o),this.alpha=t(s),this.Cp=a,this.Cn=u,this.eps=h,this.unshrink=!1,this.alpha_status=e(r,0);for(var f=0;f<r;f++)this.update_alpha_status(f);this.active_set=e(r,0);for(f=0;f<r;f++)this.active_set[f]=f;for(this.active_size=r,this.G=e(r,0),this.G_bar=e(r,0),f=0;f<r;f++)this.G[f]=this.p[f],this.G_bar[f]=0;for(f=0;f<r;f++)if(!this.is_lower_bound(f)){var d=n.get_Q(f,r),p=this.alpha[f];for(b=0;b<r;b++)this.G[b]+=p*d[b];if(this.is_upper_bound(f))for(b=0;b<r;b++)this.G_bar[b]+=this.get_C(f)*d[b]}for(var v=0,_=Math.max(1e7,r>21474836?2147483647:100*r),g=Math.min(r,1e3)+1,m=e(2,0);v<_;){if(0==--g&&(g=Math.min(r,1e3),0!=c&&this.do_shrinking()),0!=this.select_working_set(m)){if(this.reconstruct_gradient(),this.active_size=r,0!=this.select_working_set(m))break;g=1}f=m[0];var b=m[1];++v;d=n.get_Q(f,this.active_size);var y=n.get_Q(b,this.active_size),w=this.get_C(f),x=this.get_C(b),S=this.alpha[f],M=this.alpha[b];if(this.y[f]!=this.y[b]){(T=this.QD[f]+this.QD[b]+2*d[b])<=0&&(T=1e-12);var D=(-this.G[f]-this.G[b])/T,A=this.alpha[f]-this.alpha[b];this.alpha[f]+=D,this.alpha[b]+=D,A>0?this.alpha[b]<0&&(this.alpha[b]=0,this.alpha[f]=A):this.alpha[f]<0&&(this.alpha[f]=0,this.alpha[b]=-A),A>w-x?this.alpha[f]>w&&(this.alpha[f]=w,this.alpha[b]=w-A):this.alpha[b]>x&&(this.alpha[b]=x,this.alpha[f]=x+A)}else{var T;(T=this.QD[f]+this.QD[b]-2*d[b])<=0&&(T=1e-12);D=(this.G[f]-this.G[b])/T;var O=this.alpha[f]+this.alpha[b];this.alpha[f]-=D,this.alpha[b]+=D,O>w?this.alpha[f]>w&&(this.alpha[f]=w,this.alpha[b]=O-w):this.alpha[b]<0&&(this.alpha[b]=0,this.alpha[f]=O),O>x?this.alpha[b]>x&&(this.alpha[b]=x,this.alpha[f]=O-x):this.alpha[f]<0&&(this.alpha[f]=0,this.alpha[b]=O)}for(var k=this.alpha[f]-S,E=this.alpha[b]-M,C=0;C<this.active_size;C++)this.G[C]+=d[C]*k+y[C]*E;var j=this.is_upper_bound(f),I=this.is_upper_bound(b);if(this.update_alpha_status(f),this.update_alpha_status(b),j!=this.is_upper_bound(f))if(d=n.get_Q(f,r),j)for(C=0;C<r;C++)this.G_bar[C]-=w*d[C];else for(C=0;C<r;C++)this.G_bar[C]+=w*d[C];if(I!=this.is_upper_bound(b))if(y=n.get_Q(b,r),I)for(C=0;C<r;C++)this.G_bar[C]-=x*y[C];else for(C=0;C<r;C++)this.G_bar[C]+=x*y[C]}v>=_&&(this.active_size<r&&(this.reconstruct_gradient(),this.active_size=r),console.error("\nWARNING: reaching max number of iterations\n")),l.rho=this.calculate_rho();var N=0;for(f=0;f<r;f++)N+=this.alpha[f]*(this.G[f]+this.p[f]);l.obj=N/2;for(f=0;f<r;f++)s[this.active_set[f]]=this.alpha[f];l.upper_bound_p=a,l.upper_bound_n=u}},r.prototype.get_C=function(t){return this.y[t]>0?this.Cp:this.Cn},r.prototype.update_alpha_status=function(t){this.alpha[t]>=this.get_C(t)?this.alpha_status[t]=1:this.alpha[t]<=0?this.alpha_status[t]=0:this.alpha_status[t]=2},r.prototype.is_upper_bound=function(t){return 1==this.alpha_status[t]},r.prototype.is_lower_bound=function(t){return 0==this.alpha_status[t]},r.prototype.is_free=function(t){return 2==this.alpha_status[t]},r.prototype.swap_index=function(t,e){this.Q.swap_index(t,e);var r=this.y[t];this.y[t]=this.y[e],this.y[e]=r;r=this.G[t];this.G[t]=this.G[e],this.G[e]=r;r=this.alpha_status[t];this.alpha_status[t]=this.alpha_status[e],this.alpha_status[e]=r;r=this.alpha[t];this.alpha[t]=this.alpha[e],this.alpha[e]=r;r=this.p[t];this.p[t]=this.p[e],this.p[e]=r;r=this.active_set[t];this.active_set[t]=this.active_set[e],this.active_set[e]=r;r=this.G_bar[t];this.G_bar[t]=this.G_bar[e],this.G_bar[e]=r},r.prototype.reconstruct_gradient=function(){if(this.active_size!=this.l){var t,e,r=0;for(e=this.active_size;e<this.l;e++)this.G[e]=this.G_bar[e]+this.p[e];for(e=0;e<this.active_size;e++)this.is_free(e)&&r++;if(r*this.l>2*this.active_size*(this.l-this.active_size))for(t=this.active_size;t<this.l;t++){var n=this.Q.get_Q(t,this.active_size);for(e=0;e<this.active_size;e++)this.is_free(e)&&(this.G[t]+=this.alpha[e]*n[e])}else for(t=0;t<this.active_size;t++)if(this.is_free(t)){n=this.Q.get_Q(t,this.l);var i=this.alpha[t];for(e=this.active_size;e<this.l;e++)this.G[e]+=i*n[e]}}},r.prototype.select_working_set=function(t){for(var e=-Number.MAX_VALUE,r=-Number.MAX_VALUE,n=-1,i=-1,o=Number.MAX_VALUE,s=0;s<this.active_size;s++)1==this.y[s]?this.is_upper_bound(s)||-this.G[s]>=e&&(e=-this.G[s],n=s):this.is_lower_bound(s)||this.G[s]>=e&&(e=this.G[s],n=s);var a=n,u=null;-1!=a&&(u=this.Q.get_Q(a,this.active_size));for(var h=0;h<this.active_size;h++)if(1==this.y[h]){if(!this.is_lower_bound(h)){var l=e+this.G[h];if(this.G[h]>=r&&(r=this.G[h]),l>0)(c=(f=this.QD[a]+this.QD[h]-2*this.y[a]*u[h])>0?-l*l/f:-l*l/1e-12)<=o&&(i=h,o=c)}}else if(!this.is_upper_bound(h)){var c,f;l=e-this.G[h];if(-this.G[h]>=r&&(r=-this.G[h]),l>0)(c=(f=this.QD[a]+this.QD[h]+2*this.y[a]*u[h])>0?-l*l/f:-l*l/1e-12)<=o&&(i=h,o=c)}return e+r<this.eps||-1==i?1:(t[0]=n,t[1]=i,0)},r.prototype.be_shrunk=function(t,e,r){return this.is_upper_bound(t)?1==this.y[t]?-this.G[t]>e:-this.G[t]>r:!!this.is_lower_bound(t)&&(1==this.y[t]?this.G[t]>r:this.G[t]>e)},r.prototype.do_shrinking=function(){var t,e=-Number.MAX_VALUE,r=-Number.MAX_VALUE;for(t=0;t<this.active_size;t++)1==this.y[t]?(this.is_upper_bound(t)||-this.G[t]>=e&&(e=-this.G[t]),this.is_lower_bound(t)||this.G[t]>=r&&(r=this.G[t])):(this.is_upper_bound(t)||-this.G[t]>=r&&(r=-this.G[t]),this.is_lower_bound(t)||this.G[t]>=e&&(e=this.G[t]));for(0==this.unshrink&&e+r<=10*this.eps&&(this.unshrink=!0,this.reconstruct_gradient(),this.active_size=this.l),t=0;t<this.active_size;t++)if(this.be_shrunk(t,e,r))for(this.active_size--;this.active_size>t;){if(!this.be_shrunk(this.active_size,e,r)){this.swap_index(t,this.active_size);break}this.active_size--}},r.prototype.calculate_rho=function(){for(var t=0,e=Number.MAX_VALUE,r=-Number.MAX_VALUE,n=0,i=0;i<this.active_size;i++){var o=this.y[i]*this.G[i];this.is_lower_bound(i)?this.y[i]>0?e=Math.min(e,o):r=Math.max(r,o):this.is_upper_bound(i)?this.y[i]<0?e=Math.min(e,o):r=Math.max(r,o):(++t,n+=o)}return t>0?n/t:(e+r)/2},r.LOWER_BOUND=0,r.UPPER_BOUND=1,r.FREE=2,r.INF=Number.MAX_VALUE,r.SolutionInfo=function(){this.obj=0,this.rho=0,this.upper_bound_p=0,this.upper_bound_n=0,this.r=0},r}.apply(null,[]))||(t.exports=n)},1467:function(t,e,r){var n,i;n=[r(2)],void 0===(i=function(t){var e=t([],{svm_type:0,kernel_type:0,degree:0,gamma:0,coef0:0,cache_size:0,eps:0,C:0,nr_weight:0,weight_label:void 0,weight:void 0,nu:0,p:0,shrinking:0,probability:0});return e.prototype.toString=function(){return"C:"+this.C+" svm_type:"+this.svm_type+" kernel_type:"+this.kernel_type+" eps:"+this.eps},e.C_SVC=0,e.NU_SVC=1,e.ONE_CLASS=2,e.EPSILON_SVR=3,e.NU_SVR=4,e.LINEAR=0,e.POLY=1,e.RBF=2,e.SIGMOID=3,e.PRECOMPUTED=4,e}.apply(null,n))||(t.exports=i)},1468:function(t,e,r){var n,i;n=[r(753),r(3497)],void 0===(i=function(t,e){return t.ChunkedPostChannel(e)}.apply(null,n))||(t.exports=i)},1469:function(t,e,r){var n,i;n=[r(1)],void 0===(i=function(t){return{initialWait:function(){return t("cognitive-debug")?1e3:Math.floor(3e5*Math.random())},dominoRequestDelay:t("cognitive-debug")?5e3:6e5}}.apply(null,n))||(t.exports=i)},1470:function(t,e,r){var n,i;n=[r(528),r(516),r(517)],void 0===(i=function(t,e,r){return function(n){var i=t(n),o={};o.inet=(i[0].getInetAddress()||"").toLowerCase();var s=e(i,{nameDisplayMode:"abbrevaddress"})[0];r.containsEmailAddress(s)||(o.notes=s);var a=e(i,{nameDisplayMode:"mailinfosummary"})[0];return a&&a!==o.notes&&a.toLowerCase()!==o.inet&&"undefined"!==a&&(o.display=a),o}}.apply(null,n))||(t.exports=i)},1471:function(t,e,r){var n,i;n=[r(2),r(0),r(15)],void 0===(i=function(t,e,r){var n=0;return t([],{_context:void 0,_outstandingRequests:void 0,_workerHandleCleanup:void 0,constructor:function(t){this._context=t,this._outstandingRequests={}},_init:function(){this._workerHandleCleanup=this._context.addMessageListener(e.hitch(this,"_onMessage"))},_onMessage:function(t){var e=this._outstandingRequests[t.responseId];if(e){switch(t.type){case"success":e.resolve(t.result);break;case"error":e.reject(t.error||"Service returned error.");break;default:e.reject("Unknown message type received: "+t.type)}delete this._outstandingRequests[t.responseId]}},requestService:function(t,e){this._workerHandleCleanup||this._init();var i=new r,o=n++;return this._outstandingRequests[o]=i,this._context.postMessage({service:t,params:e,requestId:o,hasDebugLogging:!0}),i.promise},destroy:function(){this._workerHandleCleanup(),Object.keys(this._outstandingRequests).forEach(function(t){this._outstandingRequests[t].reject("No response received.")}.bind(this))}})}.apply(null,n))||(t.exports=i)},2983:function(t,e,r){var n,i;n=[r(15)],void 0===(i=function(t){return function(e,r){var n=new t;return setTimeout(function(){n.resolve(r)},e||0),n.promise}}.apply(null,n))||(t.exports=i)},3471:function(t,e,r){var n,i;n=[r(655),r(1704),r(550),r(486),r(495),r(487),r(510),r(153),r(500),r(5510)],void 0===(i=function(t,e,r,n,i,o,s,a,u){return t(i({displayName:"SuggestedRecipientsList",propTypes:{className:o.string.isRequired,id:o.string.isRequired,onNameActivate:o.func,suggestedPeople:o.arrayOf(o.shape({inet:o.string,display:o.string})).isRequired,onKeydown:o.func.isRequired,noAlert:o.bool},render:function(){var t=s("suggestions-list",this.props.className),i=this.props.suggestedPeople.slice(0,5).map(function(t){return a({},t,{inet:t.inet,id:t.inet,displayName:t.display||t.inet,isCurrentUser:!1})}),o=this.props.noAlert?null:n.createElement("div",{className:"alert-label",role:"alert","aria-live":"assertive"},u.suggestionsUpdatedAriaAlert),h="".concat(this.props.id,"_list");return n.createElement("div",{className:t},n.createElement("label",{htmlFor:h,className:"label-text"},u.suggestionsLabel),o,n.createElement("div",{tabIndex:"-1",id:h,className:"list","aria-label":u.suggestionsExitNavitationGuide},n.createElement(e,{ariaLive:"polite",role:"toolbar",noNameDividers:!0,className:"people-list",isBizCardMessageEnabled:!1,onNameActivate:this.props.onNameActivate,onListKeydown:this.props.onKeydown,people:i,showDraftInsteadOfMe:!1,nameTitle:u.addSuggestionTooltip,navigable:!0,canWrap:!0,direction:r.navigationDirections.LEFT_RIGHT,nameAriaLabel:u.suggestionNameAriaLabel,ariaLabel:u.suggestionNameListAriaLabel})))}}))}.apply(null,n))||(t.exports=i)},3472:function(t,e,r){var n,i;n=[r(1765),r(794),r(562),r(623),r(622),r(922),r(535),r(587),r(1468),r(1471),r(1470),r(686),r(517),r(3471),r(511),r(15),r(10),r(16),r(266),r(497),r(279)],void 0===(i=function(t,e,r,n,i,o,s,a,u,h,l,c,f,d,p,v,_,g,m,b,y){var w=15;return function(t){var x=[],S=[],M={},D=[],A=new h(u);function T(t){if(t.inet)return t.inet;if(t.notes)return f.getNameModel({notes:t.notes}).inet;if(t.email){var e=l(t.email);return f.getNameModel(e).inet}return""}function O(){var e=[];return t.forEach(function(t){t.input.otiView.getChildren().forEach(function(t){e.push(t.item)})}),e&&e.length?i(o(s(a(s(e,T),function(t){return!!t}),function(t){return t.toLowerCase()}))):[]}function k(t){var e=t.domNode.querySelector(".person.focused");if(e)e.focus();else{var r=t.domNode.querySelector(".person");r&&r.focus()}}function E(t,e,r){if(t.area.contains(m.curNode)&&O().length){var n=M[t.name];if(r.length){var i=new v;if(p.get("user"))i.resolve();else var o=p.watch("user",function(t,e,r){i.resolve(),o.remove()});return i.then(function(){var i=p.get("user").toLowerCase();if(r=r.filter(function(t){return i!==t.inet.toLowerCase()}),(S=r).length){var o={className:t.name,onNameActivate:function(t,e,r){var n,i=f.getNameModel(l(r));i.get("display")&&i.get("inet")?n='"'+i.get("display")+'" <'+i.get("inet")+">":i.get("inet")?n=i.get("inet"):i.get("notes")&&(n=i.get("notes")),n&&0!==n.length&&(t.input.addChiclet(n,{isFromSuggestions:!0,type:e.type}),b.onElement("suggested-recipients-selected",{event:e.type,name:t.name,index:S.indexOf(r)}))}.bind(null,t),suggestedPeople:S,onKeydown:function(t,e){e.keyCode!==y.DOWN_ARROW&&e.keyCode!==y.SPACE||e.preventDefault(),e.keyCode!==y.UP_ARROW&&e.keyCode!==y.ESCAPE||t.input.focus(!0)}.bind(null,t),noAlert:!0};return n.show(o).then(function(){return o.noAlert=!1,n.show(o).then(function(){return e&&e.options&&e.options.isFromSuggestions&&"keyup"===e.options.type?k(n):t.input.focus(),S.length})})}if(n.isShowing())return n.hide(!0,!0),t.input.focus(),0})}return n.isShowing()&&n.hide(!0,!0),(new v).resolve(0)}}function C(t,i,o){var s=r(x),a=O(),u=M[t.name];if(i&&!i.isFromSuggestions&&o&&u.isShowing()){var h=e(a,s);b.onElement("suggested-recipients-manually-added",{wasSuggested:S.indexOf(h)>-1})}n(a,x)&&u.isShowing()||(x=a,a.length?A.requestService("suggestRecipientsFromStore",{initialList:a,limit:w}).then(E.bind(null,t,i)).then(function(e){o&&e>0&&b.onElement("suggested-recipients-shown",{name:t.name,numShown:e})}):u.isShowing()&&u.hide(!0,!0))}return t.forEach(function(t){M[t.name]=c(d),g.place(M[t.name].domNode,t.area,"last"),function(t,e){D.push(_(t.input.inputNode,"chiclet-changed",function(r){e.isShowing()||C(t,r,!0)}))}(t,M[t.name])}),D.push(m.watch("curNode",function(e,r,n){var i=!1;t.forEach(function(t){n&&t.area.contains(n)&&(i=!0,Object.keys(M).forEach(function(e){t.name!==e?M[e].hide(!0,!0):C(t)}))}),i||Object.keys(M).forEach(function(t){M[t].isShowing&&M[t].hide(!0,!0)})})),t.forEach(function(t){Object.keys(M).forEach(function(e){D.push(_(t.input.inputNode,"chiclet-changed",function(r){M[e].isShowing()&&C(t,r,!r.isFromSuggestions)}))});var e=t.input.otiController;D.push(_(e,"navigate-down-from-input",function(){M[t.name].isShowing()&&k(M[t.name])}))}),function(){D.forEach(function(t){t.remove()}),Object.keys(M).forEach(function(t){M[t].hide()})}}}.apply(null,n))||(t.exports=i)},3473:function(t,e,r){var n,i;n=[r(782),r(867)],void 0===(i=function(t,e){function r(t,e){for(var r=new Array(t),n=0;n<t;n++)r[n]=e;return r}function n(n,i){t.call(this,n.l,n.x,i),this.cache=new e(n.l,Math.round(1048576*i.cache_size)),this.QD=r(n.l,0);for(var o=0;o<n.l;o++)this.QD[o]=this.kernel_function(o,o)}return n.prototype=new t,n.prototype.constructor=n,n.prototype.get_Q=function(t,e){var n,i,o=r(1,0);if((n=this.cache.get_data(t,o,e))<e)for(i=n;i<e;i++)o[0][i]=this.kernel_function(t,i);return o[0]},n.prototype.get_QD=function(){return this.QD},n.prototype.swap_index=function(e,r){this.cache.swap_index(e,r),t.prototype.swap_index.apply(this,[e,r]);var n=this.QD[e];this.QD[e]=this.QD[r],this.QD[r]=n},n}.apply(null,n))||(t.exports=i)},3474:function(t,e,r){var n,i;function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n=[r(782),r(867)],void 0===(i=function(t,e){function r(t,e){for(var r=new Array(t),n=0;n<t;n++)r[n]=e;return r}function n(n,i,s){t.call(this,n.l,n.x,i),this.y=function t(e){var r;if(null==e||"object"!=o(e))return e;if(e instanceof Date)return(r=new Date).setTime(e.getTime()),r;if(e instanceof Array){r=[];for(var n=0,i=e.length;n<i;n++)r[n]=t(e[n]);return r}if(e instanceof Object){for(var s in r={},e)e.hasOwnProperty(s)&&(r[s]=t(e[s]));return r}}(s),this.cache=new e(n.l,Math.round(1048576*i.cache_size)),this.QD=r(n.l,0);for(var a=0;a<n.l;a++)this.QD[a]=this.kernel_function(a,a)}return n.prototype=new t,n.prototype.constructor=n,n.prototype.get_Q=function(t,e){var n,i,o=r(1,0);if((n=this.cache.get_data(t,o,e))<e)for(i=n;i<e;i++)o[0][i]=this.y[t]*this.y[i]*this.kernel_function(t,i);return o[0]},n.prototype.get_QD=function(){return this.QD},n.prototype.swap_index=function(e,r){this.cache.swap_index(e,r),t.prototype.swap_index.apply(this,[e,r]);var n=this.y[e];this.y[e]=this.y[r],this.y[r]=n;n=this.QD[e];this.QD[e]=this.QD[r],this.QD[r]=n},n}.apply(null,n))||(t.exports=i)},3475:function(t,e,r){var n,i;n=[r(782),r(867)],void 0===(i=function(t,e){function r(t,e){for(var r=new Array(t),n=0;n<t;n++)r[n]=e;return r}function n(n,i){t.call(this,n.l,n.x,i),this.l=n.l,this.cache=new e(this.l,Math.round(1048576*i.cache_size)),this.QD=r(2*this.l,0),this.sign=r(2*this.l,0),this.index=r(2*this.l,0);for(var o=0;o<this.l;o++)this.sign[o]=1,this.sign[o+this.l]=-1,this.index[o]=o,this.index[o+this.l]=o,this.QD[o]=this.kernel_function(o,o),this.QD[o+this.l]=this.QD[o];this.buffer=function(t,e,r){for(var n=new Array(t),i=0;i<t;i++){n[i]=new Array(e);for(var o=0;o<e;o++)n[i][o]=r}return n}(2,2*this.l,0),this.next_buffer=0}return n.prototype=new t,n.prototype.constructor=n,n.prototype.swap_index=function(t,e){var r=this.sign[t];this.sign[t]=this.sign[e],this.sign[e]=r;r=this.index[t];this.index[t]=this.index[e],this.index[e]=r;r=this.QD[t];this.QD[t]=this.QD[e],this.QD[e]=r},n.prototype.get_Q=function(t,e){var n,i=r(1,0),o=this.index[t];if(this.cache.get_data(o,i,this.l)<this.l)for(n=0;n<this.l;n++)i[0][n]=this.kernel_function(o,n);var s=this.buffer[this.next_buffer];this.next_buffer=1-this.next_buffer;var a=this.sign[t];for(n=0;n<e;n++)s[n]=a*this.sign[n]*i[0][this.index[n]];return s},n.prototype.get_QD=function(){return this.QD},n}.apply(null,n))||(t.exports=i)},3476:function(t,e,r){var n,i;n=[r(2)],void 0===(i=function(t){return t([],{param:void 0,nr_class:0,l:0,SV:void 0,sv_coef:void 0,rho:void 0,probA:void 0,probB:void 0,sv_indices:void 0,label:void 0,nSV:void 0})}.apply(null,n))||(t.exports=i)},3477:function(t,e,r){var n,i;n=[r(2)],void 0===(i=function(t){return t([],{l:0,y:void 0,x:void 0})}.apply(null,n))||(t.exports=i)},3479:function(t,e,r){var n,i;n=[r(2)],void 0===(i=function(t){return t([],{index:0,value:0})}.apply(null,n))||(t.exports=i)},3480:function(t,e,r){var n,i;n=[r(1466)],void 0===(i=function(t){function e(e,r,n,i,o,s,a,u,h,l){this.si=h,t.call(this,e,r,n,i,o,s,a,u,h,l)}return e.prototype=new t,e.prototype.constructor=e,e.prototype.select_working_set=function(t){for(var e=-Number.MAX_VALUE,r=-Number.MAX_VALUE,n=-1,i=-Number.MAX_VALUE,o=-Number.MAX_VALUE,s=-1,a=-1,u=Number.MAX_VALUE,h=0;h<this.active_size;h++)1==this.y[h]?this.is_upper_bound(h)||-this.G[h]>=e&&(e=-this.G[h],n=h):this.is_lower_bound(h)||this.G[h]>=i&&(i=this.G[h],s=h);var l=n,c=s,f=null,d=null;-1!=l&&(f=this.Q.get_Q(l,this.active_size)),-1!=c&&(d=this.Q.get_Q(c,this.active_size));for(var p=0;p<this.active_size;p++)if(1==this.y[p]){if(!this.is_lower_bound(p)){var v=e+this.G[p];if(this.G[p]>=r&&(r=this.G[p]),v>0)(_=(g=this.QD[l]+this.QD[p]-2*f[p])>0?-v*v/g:-v*v/1e-12)<=u&&(a=p,u=_)}}else if(!this.is_upper_bound(p)){var _,g;v=i-this.G[p];if(-this.G[p]>=o&&(o=-this.G[p]),v>0)(_=(g=this.QD[c]+this.QD[p]-2*d[p])>0?-v*v/g:-v*v/1e-12)<=u&&(a=p,u=_)}return Math.max(e+r,i+o)<this.eps||-1==a?1:(1==this.y[a]?t[0]=n:t[0]=s,t[1]=a,0)},e.prototype.be_shrunk=function(t,e,r,n,i){return this.is_upper_bound(t)?1==this.y[t]?-this.G[t]>e:-this.G[t]>i:!!this.is_lower_bound(t)&&(1==this.y[t]?this.G[t]>r:this.G[t]>n)},e.prototype.do_shrinking=function(){var t,e=-Number.MAX_VALUE,r=-Number.MAX_VALUE,n=-Number.MAX_VALUE,i=-Number.MAX_VALUE;for(t=0;t<this.active_size;t++)this.is_upper_bound(t)||(1==this.y[t]?-this.G[t]>e&&(e=-this.G[t]):-this.G[t]>i&&(i=-this.G[t])),this.is_lower_bound(t)||(1==this.y[t]?this.G[t]>r&&(r=this.G[t]):this.G[t]>n&&(n=this.G[t]));for(0==this.unshrink&&Math.max(e+r,n+i)<=10*this.eps&&(this.unshrink=!0,this.reconstruct_gradient(),this.active_size=this.l),t=0;t<this.active_size;t++)if(this.be_shrunk(t,e,r,n,i))for(this.active_size--;this.active_size>t;){if(!this.be_shrunk(this.active_size,e,r,n,i)){this.swap_index(t,this.active_size);break}this.active_size--}},e.prototype.calculate_rho=function(){for(var t,e,r=0,n=0,i=Number.MAX_VALUE,o=Number.MAX_VALUE,s=-Number.MAX_VALUE,a=-Number.MAX_VALUE,u=0,h=0,l=0;l<this.active_size;l++)1==this.y[l]?this.is_lower_bound(l)?i=Math.min(i,this.G[l]):this.is_upper_bound(l)?s=Math.max(s,this.G[l]):(++r,u+=this.G[l]):this.is_lower_bound(l)?o=Math.min(o,this.G[l]):this.is_upper_bound(l)?a=Math.max(a,this.G[l]):(++n,h+=this.G[l]);return t=r>0?u/r:(i+s)/2,e=n>0?h/n:(o+a)/2,this.si.r=(t+e)/2,(t-e)/2},e}.apply(null,n))||(t.exports=i)},3481:function(t,e,r){var n,i;function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n=[r(2),r(3476),r(3479),r(1467),r(3477),r(1466),r(3480),r(3475),r(3474),r(3473),r(782)],void 0===(i=function(t,e,r,n,i,s,a,u,h,l,c){function f(t){var e;if(null==t||"object"!=o(t))return t;if(t instanceof Date)return(e=new Date).setTime(t.getTime()),e;if(t instanceof Array){e=[];for(var r=0,n=t.length;r<n;r++)e[r]=f(t[r]);return e}if(t instanceof Object){for(var i in e={},t)t.hasOwnProperty(i)&&(e[i]=f(t[i]));return e}}function d(t,e){for(var r=new Array(t),n=0;n<t;n++)r[n]=e;return r}function p(t,e,r){for(var n=new Array(t),i=0;i<t;i++){n[i]=new Array(e);for(var o=0;o<e;o++)n[i][o]=r}return n}function v(t,e,r,n,i){for(var o=0;o<i;o++)r[n+o]=t[e+o]}var _=["c_svc","nu_svc","one_class","epsilon_svr","nu_svr"],g=["linear","polynomial","rbf","sigmoid","precomputed"];return t([],{constructor:function(){},rand:{nextInt:function(t){return Math.floor(Math.random()*t)}},getTopIndex:function(t){for(var e=new Array(t.length),r=0;r<t.length;r++)e[r]=r;for(var n=t.length-1;n>0;n--)for(r=0;r<n;r++)if(t[e[r]]<t[e[r+1]]){var i=e[r];e[r]=e[r+1],e[r+1]=i}return e},info:function(t){},solve_c_svc:function(t,e,r,n,i,o){var a,u=t.l,l=d(u,0),c=d(u,0);for(a=0;a<u;a++)r[a]=0,l[a]=-1,t.y[a]>0?c[a]=1:c[a]=-1;(new s).Solve(u,new h(t,e,c),l,c,r,i,o,e.eps,n,e.shrinking);var f=0;for(a=0;a<u;a++)f+=r[a];for(i==o&&this.info("nu = "+f/(i*t.l)+"\n"),a=0;a<u;a++)r[a]*=c[a]},solve_nu_svc:function(t,e,r,n){var i,o=t.l,s=e.nu,u=d(o,0);for(i=0;i<o;i++)t.y[i]>0?u[i]=1:u[i]=-1;var l=s*o/2,c=s*o/2;for(i=0;i<o;i++)1==u[i]?(r[i]=Math.min(1,l),l-=r[i]):(r[i]=Math.min(1,c),c-=r[i]);var f=d(o,0);for(i=0;i<o;i++)f[i]=0;(new a).Solve(o,new h(t,e,u),f,u,r,1,1,e.eps,n,e.shrinking);var p=n.r;for(this.info("C = "+1/p+"\n"),i=0;i<o;i++)r[i]*=u[i]/p;n.rho/=p,n.obj/=p*p,n.upper_bound_p=1/p,n.upper_bound_n=1/p},solve_one_class:function(t,e,r,n){var i,o=t.l,a=d(o,0),u=d(o,0),h=Math.round(e.nu*t.l);for(i=0;i<h;i++)r[i]=1;for(h<t.l&&(r[h]=e.nu*t.l-h),i=h+1;i<o;i++)r[i]=0;for(i=0;i<o;i++)a[i]=0,u[i]=1;(new s).Solve(o,new l(t,e),a,u,r,1,1,e.eps,n,e.shrinking)},solve_epsilon_svr:function(t,e,r,n){var i,o=t.l,a=d(2*o,0),h=d(2*o,0),l=d(2*o,0);for(i=0;i<o;i++)a[i]=0,h[i]=e.p-t.y[i],l[i]=1,a[i+o]=0,h[i+o]=e.p+t.y[i],l[i+o]=-1;(new s).Solve(2*o,new u(t,e),h,l,a,e.C,e.C,e.eps,n,e.shrinking);var c=0;for(i=0;i<o;i++)r[i]=a[i]-a[i+o],c+=Math.abs(r[i]);this.info("nu = "+c/(e.C*o)+"\n")},solve_nu_svr:function(t,e,r,n){var i,o=t.l,s=e.C,h=d(2*o,0),l=d(2*o,0),c=d(2*o,0),f=s*e.nu*o/2;for(i=0;i<o;i++)h[i]=h[i+o]=Math.min(f,s),f-=h[i],l[i]=-t.y[i],c[i]=1,l[i+o]=t.y[i],c[i+o]=-1;for((new a).Solve(2*o,new u(t,e),l,c,h,s,s,e.eps,n,e.shrinking),this.info("epsilon = "+-n.r+"\n"),i=0;i<o;i++)r[i]=h[i]-h[i+o]},svm_train_one:function(t,e,r,n){var i=d(t.l,0),o=new s.SolutionInfo;switch(e.svm_type){case 0:this.solve_c_svc(t,e,i,o,r,n);break;case 1:this.solve_nu_svc(t,e,i,o);break;case 2:this.solve_one_class(t,e,i,o);break;case 3:this.solve_epsilon_svr(t,e,i,o);break;case 4:this.solve_nu_svr(t,e,i,o)}this.info("obj = "+o.obj+", rho = "+o.rho+"\n");for(var a=0,u=0,h=0;h<t.l;h++)Math.abs(i[h])>0&&(++a,t.y[h]>0?Math.abs(i[h])>=o.upper_bound_p&&++u:Math.abs(i[h])>=o.upper_bound_n&&++u);return this.info("nSV = "+a+", nBSV = "+u+"\n"),{alpha:i,rho:o.rho}},sigmoid_train:function(t,e,r,n){var i,o,s,a=0,u=0;for(s=0;s<t;s++)r[s]>0?a+=1:u+=1;var h,l,c,f,p,v,_,g,m,b,y,w,x,S,M,D,A,T,O,k=(a+1)/(a+2),E=1/(u+2),C=d(t,0);i=0,o=Math.log((u+1)/(a+1));var j=0;for(s=0;s<t;s++)r[s]>0?C[s]=k:C[s]=E,j+=(h=e[s]*i+o)>=0?C[s]*h+Math.log(1+Math.exp(-h)):(C[s]-1)*h+Math.log(1+Math.exp(h));for(O=0;O<100;O++){for(f=1e-12,p=1e-12,v=0,_=0,g=0,s=0;s<t;s++)(h=e[s]*i+o)>=0?(l=Math.exp(-h)/(1+Math.exp(-h)),c=1/(1+Math.exp(-h))):(l=1/(1+Math.exp(h)),c=Math.exp(h)/(1+Math.exp(h))),T=l*c,f+=e[s]*e[s]*T,p+=T,v+=e[s]*T,A=C[s]-l,_+=e[s]*A,g+=A;if(Math.abs(_)<1e-5&&Math.abs(g)<1e-5)break;for(w=_*(b=-(p*_-v*g)/(m=f*p-v*v))+g*(y=-(-v*_+f*g)/m),x=1;x>=1e-10;){for(S=i+x*b,M=o+x*y,D=0,s=0;s<t;s++)D+=(h=e[s]*S+M)>=0?C[s]*h+Math.log(1+Math.exp(-h)):(C[s]-1)*h+Math.log(1+Math.exp(h));if(D<j+1e-4*x*w){i=S,o=M,j=D;break}x/=2}if(x<1e-10){this.info("Line search fails in two-class probability estimates\n");break}}O>=100&&this.info("Reaching maximal iterations in two-class probability estimates\n"),n[0]=i,n[1]=o},sigmoid_predict:function(t,e,r){var n=t*e+r;return n>=0?Math.exp(-n)/(1+Math.exp(-n)):1/(1+Math.exp(n))},multiclass_probability:function(t,e,r){var n,i,o,s=0,a=Math.max(100,t),u=p(t,t,0),h=d(t,0),l=.005/t;for(n=0;n<t;n++){for(r[n]=1/t,u[n][n]=0,i=0;i<n;i++)u[n][n]+=e[i][n]*e[i][n],u[n][i]=u[i][n];for(i=n+1;i<t;i++)u[n][n]+=e[i][n]*e[i][n],u[n][i]=-e[i][n]*e[n][i]}for(s=0;s<a;s++){for(o=0,n=0;n<t;n++){for(h[n]=0,i=0;i<t;i++)h[n]+=u[n][i]*r[i];o+=r[n]*h[n]}var c=0;for(n=0;n<t;n++){var f=Math.abs(h[n]-o);f>c&&(c=f)}if(c<l)break;for(n=0;n<t;n++){var v=(-h[n]+o)/u[n][n];for(r[n]+=v,o=(o+v*(v*u[n][n]+2*h[n]))/(1+v)/(1+v),i=0;i<t;i++)h[i]=(h[i]+v*u[n][i])/(1+v),r[i]/=1+v}}s>=a&&this.info("Exceeds max_iter in multiclass_prob\n")},svm_binary_svc_probability:function(t,e,r,n,o){var s,a=d(t.l,0),u=d(t.l,0);for(s=0;s<t.l;s++)a[s]=s;for(s=0;s<t.l;s++){var h=s+this.rand.nextInt(t.l-s),l=a[s];a[s]=a[h],a[h]=l}for(s=0;s<5;s++){var c,p=Math.floor(s*t.l/5),v=Math.floor((s+1)*t.l/5),_=new i;for(_.l=t.l-(v-p),_.x=new Array(_.l),_.y=d(_.l,0),c=0,h=0;h<p;h++)_.x[c]=t.x[a[h]],_.y[c]=t.y[a[h]],++c;for(h=v;h<t.l;h++)_.x[c]=t.x[a[h]],_.y[c]=t.y[a[h]],++c;var g=0,m=0;for(h=0;h<c;h++)_.y[h]>0?g++:m++;if(0==g&&0==m)for(h=p;h<v;h++)u[a[h]]=0;else if(g>0&&0==m)for(h=p;h<v;h++)u[a[h]]=1;else if(0==g&&m>0)for(h=p;h<v;h++)u[a[h]]=-1;else{var b=f(e);b.probability=0,b.C=1,b.nr_weight=2,b.weight_label=d(2,0),b.weight=d(2,0),b.weight_label[0]=1,b.weight_label[1]=-1,b.weight[0]=r,b.weight[1]=n;var y=this.svm_train(_,b);for(h=p;h<v;h++){var w=d(1,0);this.svm_predict_values(y,t.x[a[h]],w),u[a[h]]=w[0],u[a[h]]*=y.label[0]}}}this.sigmoid_train(t.l,u,t.y,o)},svm_svr_probability:function(t,e){var r,n=d(t.l,0),i=0,o=f(e);for(o.probability=0,this.svm_cross_validation(t,o,5,n),r=0;r<t.l;r++)n[r]=t.y[r]-n[r],i+=Math.abs(n[r]);i/=t.l;var s=Math.sqrt(2*i*i),a=0;for(i=0,r=0;r<t.l;r++)Math.abs(n[r])>5*s?a+=1:i+=Math.abs(n[r]);return i/=t.l-a,this.info("Prob. model for test data: target value = predicted value + z,\nz: Laplace distribution e^(-|z|/sigma)/(2sigma),sigma="+i+"\n"),i},svm_group_classes:function(t,e,r,n,i,o){var s,a=t.l,u=16,h=0,l=d(u,0),c=d(u,0),f=d(a,0);for(s=0;s<a;s++){var p,_=Math.round(t.y[s]);for(p=0;p<h;p++)if(_==l[p]){++c[p];break}if(f[s]=p,p==h){if(h==u){var g=d(u*=2,0);v(l,0,g,0,l.length),l=g,v(c,0,g=d(u,0),0,c.length),c=g}l[h]=_,c[h]=1,++h}}if(2==h&&-1==l[0]&&1==l[1]){var m=l[0];l[0]=l[1],l[1]=m;m=c[0];for(c[0]=c[1],c[1]=m,s=0;s<a;s++)0==f[s]?f[s]=1:f[s]=0}var b=d(h,0);for(b[0]=0,s=1;s<h;s++)b[s]=b[s-1]+c[s-1];for(s=0;s<a;s++)o[b[f[s]]]=s,++b[f[s]];for(b[0]=0,s=1;s<h;s++)b[s]=b[s-1]+c[s-1];e[0]=h,r[0]=l,n[0]=b,i[0]=c},svm_train:function(t,r){var n=new e;if(n.param=r,2==r.svm_type||3==r.svm_type||4==r.svm_type){n.nr_class=2,n.label=null,n.nSV=null,n.probA=null,n.probB=null,n.sv_coef=d(1,0),1!=r.probability||3!=r.svm_type&&4!=r.svm_type||(n.probA=d(1,0),n.probA[0]=this.svm_svr_probability(t,r));var o=this.svm_train_one(t,r,0,0);n.rho=d(1,0),n.rho[0]=o.rho;var s=0;for(b=0;b<t.l;b++)Math.abs(o.alpha[b])>0&&++s;n.l=s,n.SV=new Array(s),n.sv_coef[0]=d(s,0),n.sv_indices=d(s,0);var a=0;for(b=0;b<t.l;b++)Math.abs(o.alpha[b])>0&&(n.SV[a]=t.x[b],n.sv_coef[0][a]=o.alpha[b],n.sv_indices[a]=b+1,++a)}else{var u=t.l,h=d(1,0),l=d(1,0),c=d(1,0),f=d(1,0),p=d(u,0);this.svm_group_classes(t,h,l,c,f,p);var v=h[0],_=l[0],g=c[0],m=f[0];1==v&&this.info("WARNING: training data in only one class. See README for details.\n");var b,y=new Array(u);for(b=0;b<u;b++)y[b]=t.x[p[b]];var w=d(v,0);for(b=0;b<v;b++)w[b]=r.C;for(b=0;b<r.nr_weight;b++){for(a=0;a<v&&r.weight_label[b]!=_[a];a++);a==v?console.error("WARNING: class label "+r.weight_label[b]+" specified in weight is not found\n"):w[a]*=r.weight[b]}var x=d(u,!1);for(b=0;b<u;b++)x[b]=!1;o=new Array(Math.floor(v*(v-1)/2));var S=null,M=null;1==r.probability&&(S=d(Math.floor(v*(v-1)/2),0),M=d(Math.floor(v*(v-1)/2),0));var D=0;for(b=0;b<v;b++)for(a=b+1;a<v;a++){var A=new i,T=g[b],O=g[a],k=m[b],E=m[a];for(A.l=k+E,A.x=new Array(A.l),A.y=d(A.l,0),L=0;L<k;L++)A.x[L]=y[T+L],A.y[L]=1;for(L=0;L<E;L++)A.x[k+L]=y[O+L],A.y[k+L]=-1;if(1==r.probability){var C=d(2,0);this.svm_binary_svc_probability(A,r,w[b],w[a],C),S[D]=C[0],M[D]=C[1]}for(o[D]=this.svm_train_one(A,r,w[b],w[a]),L=0;L<k;L++)!x[T+L]&&Math.abs(o[D].alpha[L])>0&&(x[T+L]=!0);for(L=0;L<E;L++)!x[O+L]&&Math.abs(o[D].alpha[k+L])>0&&(x[O+L]=!0);++D}for(n.nr_class=v,n.label=d(v,0),b=0;b<v;b++)n.label[b]=_[b];for(n.rho=d(Math.floor(v*(v-1)/2),0),b=0;b<Math.floor(v*(v-1)/2);b++)n.rho[b]=o[b].rho;if(1==r.probability)for(n.probA=d(Math.floor(v*(v-1)/2),0),n.probB=d(Math.floor(v*(v-1)/2),0),b=0;b<Math.floor(v*(v-1)/2);b++)n.probA[b]=S[b],n.probB[b]=M[b];else n.probA=null,n.probB=null;var j=0,I=d(v,0);for(n.nSV=d(v,0),b=0;b<v;b++){for(s=0,a=0;a<m[b];a++)x[g[b]+a]&&(++s,++j);n.nSV[b]=s,I[b]=s}for(this.info("Total nSV = "+j+"\n"),n.l=j,n.SV=new Array(j),n.sv_indices=d(j,0),D=0,b=0;b<u;b++)x[b]&&(n.SV[D]=y[b],n.sv_indices[D++]=p[b]+1);var N=d(v,0);for(N[0]=0,b=1;b<v;b++)N[b]=N[b-1]+I[b-1];for(n.sv_coef=d(v-1,0),b=0;b<v-1;b++)n.sv_coef[b]=d(j,0);for(D=0,b=0;b<v;b++)for(a=b+1;a<v;a++){T=g[b],O=g[a],k=m[b],E=m[a];var L,F=N[b];for(L=0;L<k;L++)x[T+L]&&(n.sv_coef[a-1][F++]=o[D].alpha[L]);for(F=N[a],L=0;L<E;L++)x[O+L]&&(n.sv_coef[b][F++]=o[D].alpha[k+L]);++D}}return n},svm_cross_validation:function(t,e,r,n){var o,s=d(r+1,0),a=t.l,u=d(a,0);if((0==e.svm_type||1==e.svm_type)&&r<a){var h=d(1,0),l=d(1,0),c=d(1,0),f=d(1,0);this.svm_group_classes(t,h,l,c,f,u);var p,v=h[0],_=c[0],g=f[0],m=d(r,0),b=d(a,0);for(o=0;o<a;o++)b[o]=u[o];for(p=0;p<v;p++)for(o=0;o<g[p];o++){var y=o+this.rand.nextInt(g[p]-o),w=b[_[p]+y];b[_[p]+y]=b[_[p]+o],b[_[p]+o]=w}for(o=0;o<r;o++)for(m[o]=0,p=0;p<v;p++)m[o]+=Math.floor((o+1)*g[p]/r)-Math.floor(o*g[p]/r);for(s[0]=0,o=1;o<=r;o++)s[o]=s[o-1]+m[o-1];for(p=0;p<v;p++)for(o=0;o<r;o++){var x=_[p]+Math.floor(o*g[p]/r),S=_[p]+Math.floor((o+1)*g[p]/r);for(y=x;y<S;y++)u[s[o]]=b[y],s[o]++}for(s[0]=0,o=1;o<=r;o++)s[o]=s[o-1]+m[o-1]}else{for(o=0;o<a;o++)u[o]=o;for(o=0;o<a;o++){y=o+this.rand.nextInt(a-o),w=u[o];u[o]=u[y],u[y]=w}for(o=0;o<=r;o++)s[o]=Math.floor(o*a/r)}for(o=0;o<r;o++){x=s[o],S=s[o+1];var M,D=new i;for(D.l=a-(S-x),D.x=new Array(D.l),D.y=d(D.l,0),M=0,y=0;y<x;y++)D.x[M]=t.x[u[y]],D.y[M]=t.y[u[y]],++M;for(y=S;y<a;y++)D.x[M]=t.x[u[y]],D.y[M]=t.y[u[y]],++M;var A=this.svm_train(D,e);if(1!=e.probability||0!=e.svm_type&&1!=e.svm_type)for(y=x;y<S;y++)n[u[y]]=this.svm_predict(A,t.x[u[y]]);else{var T=d(this.svm_get_nr_class(A),0);for(y=x;y<S;y++)n[u[y]]=this.svm_predict_probability(A,t.x[u[y]],T)}}},svm_get_svm_type:function(t){return t.param.svm_type},svm_get_nr_class:function(t){return t.nr_class},svm_get_labels:function(t,e){if(null!=t.label)for(var r=0;r<t.nr_class;r++)e[r]=t.label[r]},svm_get_sv_indices:function(t,e){if(null!=t.sv_indices)for(var r=0;r<t.l;r++)e[r]=t.sv_indices[r]},svm_get_nr_sv:function(t){return t.l},svm_get_svr_probability:function(t){return 3!=t.param.svm_type&&4!=t.param.svm_type||null==t.probA?(console.error("Model doesn't contain information for SVR probability inference\n"),0):t.probA[0]},svm_predict_values:function(t,e,r){var n;if(2==t.param.svm_type||3==t.param.svm_type||4==t.param.svm_type){var i=t.sv_coef[0],o=0;for(n=0;n<t.l;n++)o+=i[n]*c.k_function(e,t.SV[n],t.param);return o-=t.rho[0],r[0]=o,2==t.param.svm_type?o>0?1:-1:o}var s=t.nr_class,a=t.l,u=d(a,0);for(n=0;n<a;n++)u[n]=c.k_function(e,t.SV[n],t.param);var h=d(s,0);for(h[0]=0,n=1;n<s;n++)h[n]=h[n-1]+t.nSV[n-1];var l=d(s,0);for(n=0;n<s;n++)l[n]=0;var f=0;for(n=0;n<s;n++)for(var p=n+1;p<s;p++){o=0;var v,_=h[n],g=h[p],m=t.nSV[n],b=t.nSV[p],y=t.sv_coef[p-1],w=t.sv_coef[n];for(v=0;v<m;v++)o+=y[_+v]*u[_+v];for(v=0;v<b;v++)o+=w[g+v]*u[g+v];o-=t.rho[f],r[f]=o,r[f]>0?++l[n]:++l[p],f++}var x=0;for(n=1;n<s;n++)l[n]>l[x]&&(x=n);return t.label[x]},svm_predict:function(t,e){var r,n=t.nr_class;return r=2==t.param.svm_type||3==t.param.svm_type||4==t.param.svm_type?d(1,0):d(Math.floor(n*(n-1)/2),0),this.svm_predict_values(t,e,r)},svm_predict_probability:function(t,e,r){if(0!=t.param.svm_type&&1!=t.param.svm_type||null==t.probA||null==t.probB)return this.svm_predict(t,e);var n,i=t.nr_class,o=d(Math.floor(i*(i-1)/2),0);this.svm_predict_values(t,e,o);var s=p(i,i,0),a=0;for(n=0;n<i;n++)for(var u=n+1;u<i;u++)s[n][u]=Math.min(Math.max(this.sigmoid_predict(o[a],t.probA[a],t.probB[a]),1e-7),1-1e-7),s[u][n]=1-s[n][u],a++;2==i?(r[0]=s[0][1],r[1]=s[1][0]):this.multiclass_probability(i,s,r);var h=0;for(n=1;n<i;n++)r[n]>r[h]&&(h=n);return t.label[h]},svm_save_model:function(t){var e="",r=t.param;e+="svm_type "+_[r.svm_type]+"\nkernel_type "+g[r.kernel_type]+"\n",1==r.kernel_type&&(e+="degree "+r.degree+"\n"),1!=r.kernel_type&&2!=r.kernel_type&&3!=r.kernel_type||(e+="gamma "+r.gamma+"\n"),1!=r.kernel_type&&3!=r.kernel_type||(e+="coef0 "+r.coef0+"\n");var n=t.nr_class,i=t.l;e+="nr_class "+n+"\n",e+="total_sv "+i+"\n",e+="rho";for(var o=0;o<Math.floor(n*(n-1)/2);o++)e+=" "+t.rho[o];if(e+="\n",null!=t.label){e+="label";for(o=0;o<n;o++)e+=" "+t.label[o];e+="\n"}if(t.probA){e+="probA";for(o=0;o<Math.floor(n*(n-1)/2);o++)e+=" "+t.probA[o];e+="\n"}if(t.probB){e+="probB";for(o=0;o<Math.floor(n*(n-1)/2);o++)e+=" "+t.probB[o];e+="\n"}if(null!=t.nSV){e+="nr_sv";for(o=0;o<n;o++)e+=" "+t.nSV[o];e+="\n"}e+="SV\n";var s=t.sv_coef,a=t.SV;for(o=0;o<i;o++){for(var u=0;u<n-1;u++)e+=s[u][o]+" ";var h=a[o];if(4==r.kernel_type)e+="0:"+Math.round(h[0].value);else for(u=0;u<h.length;u++)e+=h[u].index+":"+h[u].value+" ";e+="\n"}return e},atof:function(t){return parseFloat(t)},atoi:function(t){return parseInt(t)},read_model_header:function(t,e){var r=new n;e.param=r,r.nr_weight=0,r.weight_label=null,r.weight=null;try{for(var i=0;i<t.length;i++){var o=t[i],s=o.substring(o.indexOf(" ")+1);if(o.startsWith("svm_type")){for(h=0;h<_.length;h++)if(-1!=s.indexOf(_[h])){r.svm_type=h;break}if(h==_.length)return console.error("unknown svm type.\n"),-1}else if(o.startsWith("kernel_type")){for(h=0;h<g.length;h++)if(-1!=s.indexOf(g[h])){r.kernel_type=h;break}if(h==g.length)return console.error("unknown kernel function.\n"),-1}else if(o.startsWith("degree"))r.degree=this.atoi(s);else if(o.startsWith("gamma"))r.gamma=this.atof(s);else if(o.startsWith("coef0"))r.coef0=this.atof(s);else if(o.startsWith("nr_class"))e.nr_class=this.atoi(s);else if(o.startsWith("total_sv"))e.l=this.atoi(s);else if(o.startsWith("rho")){var a=Math.floor(e.nr_class*(e.nr_class-1)/2);e.rho=d(a,0);for(var u=s.split(/ |\t|\n|\r|\f/),h=0;h<a;h++)e.rho[h]=this.atof(u[h])}else if(o.startsWith("label")){a=e.nr_class;e.label=d(a,0);for(u=s.split(/ |\t|\n|\r|\f/),h=0;h<a;h++)e.label[h]=this.atoi(u[h])}else if(o.startsWith("probA")){a=Math.floor(e.nr_class*(e.nr_class-1)/2);e.probA=d(a,0);for(u=s.split(/ |\t|\n|\r|\f/),h=0;h<a;h++)e.probA[h]=this.atof(u[h])}else if(o.startsWith("probB")){a=Math.floor(e.nr_class*(e.nr_class-1)/2);e.probB=d(a,0);for(u=s.split(/ |\t|\n|\r|\f/),h=0;h<a;h++)e.probB[h]=this.atof(u[h])}else{if(!o.startsWith("nr_sv"))return o.startsWith("SV")?i:(console.error("unknown text in model file: ["+o+"]\n"),-1);a=e.nr_class;e.nSV=d(a,0);for(u=s.split(/ |\t|\n|\r|\f/),h=0;h<a;h++)e.nSV[h]=this.atoi(u[h])}}}catch(t){return-1}return-1},svm_load_data:function(t){var e=t.split("\n"),n=new i;n.l=e.length,n.x=[],n.y=[];for(var o=0;o<e.length;o++){var s=e[o].split(" "),a=parseInt(s[0]);n.y[o]=a;for(var u=[],h=1;h<s.length;h++){var l=s[h].split(":"),c=new r;c.index=parseInt(l[0]),c.value=parseFloat(l[1]),u[h-1]=c}n.x[o]=u}return n},svm_load_model:function(t){var n=new e;n.rho=null,n.probA=null,n.probB=null,n.label=null,n.nSV=null;var i=t.split("\n"),o=this.read_model_header(i,n);if(o<0)return console.error("ERROR: failed to read model\n"),null;var s=n.nr_class-1,a=n.l;n.sv_coef=p(s,a,0),n.SV=new Array(a);for(var u=0;u<a;u++){for(var h=i[o+1+u].split(/ |\t|\n|\r|\f|:/),l=0;l<s;l++)n.sv_coef[l][u]=this.atof(h[l]);var c=s,f=Math.floor((h.length-s-1)/2);n.SV[u]=new Array(f);for(var d=0;d<f;d++)n.SV[u][d]=new r,n.SV[u][d].index=this.atoi(h[c]),c++,n.SV[u][d].value=this.atof(h[c]),c++}return n},svm_check_parameter:function(t,e){var r=e.svm_type;if(0!=r&&1!=r&&2!=r&&3!=r&&4!=r)return"unknown svm type";var n=e.kernel_type;if(0!=n&&1!=n&&2!=n&&3!=n&&4!=n)return"unknown kernel type";if(e.gamma<0)return"gamma < 0";if(e.degree<0)return"degree of polynomial kernel < 0";if(e.cache_size<=0)return"cache_size <= 0";if(e.eps<=0)return"eps <= 0";if((0==r||3==r||4==r)&&e.C<=0)return"C <= 0";if((1==r||2==r||4==r)&&(e.nu<=0||e.nu>1))return"nu <= 0 or nu > 1";if(3==r&&e.p<0)return"p < 0";if(0!=e.shrinking&&1!=e.shrinking)return"shrinking != 0 and shrinking != 1";if(0!=e.probability&&1!=e.probability)return"probability != 0 and probability != 1";if(1==e.probability&&2==r)return"one-class SVM probability output not supported yet";if(1==r){var i,o=t.l,s=16,a=0,u=d(s,0),h=d(s,0);for(i=0;i<o;i++){var l=Math.round(t.y[i]);for(p=0;p<a;p++)if(l==u[p]){++h[p];break}if(p==a){if(a==s){var c=d(s*=2,0);v(u,0,c,0,u.length),u=c,v(h,0,c=d(s,0),0,h.length),h=c}u[a]=l,h[a]=1,++a}}for(i=0;i<a;i++)for(var f=h[i],p=i+1;p<a;p++){var _=h[p];if(e.nu*(f+_)/2>Math.min(f,_))return"specified nu is infeasible"}}return null},svm_check_probability_model:function(t){return(0==t.param.svm_type||1==t.param.svm_type)&&null!=t.probA&&null!=t.probB||(3==t.param.svm_type||4==t.param.svm_type)&&null!=t.probA?1:0},decision_function:function(){this.alpha=null,this.rho=0}})}.apply(null,n))||(t.exports=i)},3482:function(t,e,r){var n;void 0===(n=function(){return{ENGLISH_STOP_WORDS:new Set(["a","about","above","across","after","afterwards","again","against","all","almost","alone","along","already","also","although","always","am","among","amongst","amoungst","amount","an","and","another","any","anyhow","anyone","anything","anyway","anywhere","are","around","as","at","back","be","became","because","become","becomes","becoming","been","before","beforehand","behind","being","below","beside","besides","between","beyond","bill","both","bottom","but","by","call","can","cannot","cant","co","con","could","couldnt","cry","de","describe","detail","do","done","down","due","during","each","eg","eight","either","eleven","else","elsewhere","empty","enough","etc","even","ever","every","everyone","everything","everywhere","except","few","fifteen","fifty","fill","find","fire","first","five","for","former","formerly","forty","found","four","from","front","full","further","get","give","go","had","has","hasnt","have","he","hence","her","here","hereafter","hereby","herein","hereupon","hers","herself","him","himself","his","how","however","hundred","i","ie","if","in","inc","indeed","interest","into","is","it","its","itself","keep","last","latter","latterly","least","less","ltd","made","many","may","me","meanwhile","might","mill","mine","more","moreover","most","mostly","move","much","must","my","myself","name","namely","neither","never","nevertheless","next","nine","no","nobody","none","noone","nor","not","nothing","now","nowhere","of","off","often","on","once","one","only","onto","or","other","others","otherwise","our","ours","ourselves","out","over","own","part","per","perhaps","please","put","rather","re","same","see","seem","seemed","seeming","seems","serious","several","she","should","show","side","since","sincere","six","sixty","so","some","somehow","someone","something","sometime","sometimes","somewhere","still","such","system","take","ten","than","that","the","their","them","themselves","then","thence","there","thereafter","thereby","therefore","therein","thereupon","these","they","thick","thin","third","this","those","though","three","through","throughout","thru","thus","to","together","too","top","toward","towards","twelve","twenty","two","un","under","until","up","upon","us","very","via","was","we","well","were","what","whatever","when","whence","whenever","where","whereafter","whereas","whereby","wherein","whereupon","wherever","whether","which","while","whither","who","whoever","whole","whom","whose","why","will","with","within","without","would","yet","you","your","yours","yourself","yourselves"])}}.apply(null,[]))||(t.exports=n)},3484:function(t,e,r){var n,i;n=[r(2),r(3482)],void 0===(i=function(t,e){return t([],{_white_spaces:/\s\s+/g,token_pattern:/[\w\u00C0-\u017FwÀ-ÿ]+|[\u0621-\u064A]+|[а-яА-Я]+|[A-Za-zΑ-Ωα-ωίϊΐόάέύϋΰήώ]+/g,_CJK_special_token_pattern:/[`~!@#\$%\^\&\*\(\)_\+-=\|<>\?:"\{\},\.\\\/;'\[\]]/g,_CJK_separator_pattern:/[\s|\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/g,lowercase:!0,analyzer:"char_wb",stop_words:"english",ngram_range:[1,2],decode:function(t){var e=t;if("filename"==this.input){var r=open(e,"rb");e=r.read(),r.close()}else"file"==this.input&&(e=t.read());return("bytes"==typeof t||t instanceof String)&&(e=t.decode(this.encoding,this.decode_error)),e},_word_ngrams:function(t,e){if(!t)return null;if(e){for(var r=[],n=t,i=0;i<n.length;i++){var o=n[i];e.has(o)||r.push(o)}return r}return t},_char_wb_ngrams:function(t,e){if(!t)return null;var r=this.build_tokenizer()(t);if(r&&(t=t.replace(this.token_pattern,""),e))for(var n=r.length-1;n>=0;n--)e.has(r[n])&&r.splice(n,1);for(var i=(t=t.replace(this._CJK_special_token_pattern," ")).split(this._CJK_separator_pattern),o=this.ngram_range[0],s=this.ngram_range[1],a=[],u=0;u<i.length;u++)for(var h=i[u],l=h.length,c=o;c<=s;c++)for(var f=0;f+c<=l;f++)a.push(h.substr(f,c));return r&&(a=a.concat(r)),a},build_preprocessor:function(){if(null!=this.preprocessor)return this.preprocessor;var t;return this.strip_accents?"function"==typeof this.strip_accents&&(t=this.strip_accents):t=function(t){return t},this.lowercase?function(e){return t(e.toLowerCase())}:t},build_tokenizer:function(){if(this.tokenizer)return this.tokenizer;var t=this.token_pattern;return function(e){return e.match(t)}},get_stop_words:function(){return this._check_stop_list(this.stop_words)},build_analyzer:function(){var t=this;if("function"==typeof this.analyzer)return this.analyzer;var e=this.build_preprocessor();if("char"==this.analyzer)return function(t){return this._char_ngrams(e(t))};if("char_wb"==this.analyzer){var r=this.get_stop_words();return function(n){return t._char_wb_ngrams(e(n),r)}}if("word"==this.analyzer){r=this.get_stop_words();var n=this.build_tokenizer();return function(i){return t._word_ngrams(n(e(i)),r)}}throw new Error("%s is not a valid tokenization scheme/analyzer",this.analyzer)},_check_stop_list:function(t){return"english"==t?e.ENGLISH_STOP_WORDS:null}})}.apply(null,n))||(t.exports=i)},3485:function(t,e,r){var n,i;n=[r(2),r(3484)],void 0===(i=function(t,e){function r(t){for(var e=new Array(t.length),r=0;r<t.length;r++)e[r]=r;for(var n=t.length-1;n>0;n--)for(r=0;r<n;r++)if(t[e[r]]<t[e[r+1]]){var i=e[r];e[r]=e[r+1],e[r+1]=i}return e}return t([e],{max_df:1,min_df:1,vocabulary_:void 0,_sort_features:function(t,e){var r=this._getMapKeys(e);r.sort();for(var n=new Map,i=new Map,o=0;o<r.length;o++)n.set(r[o],o),i.set(e.get(r[o]),o);for(o=0;o<t.length;o++)for(var s=t[o].length-1;s>=0;s--){var a=t[o][s];a.index=i.get(a.index)}for(o=0;o<t.length;o++)t[o].sort(function(t,e){return t.index-e.index});return this.vocabulary_=n,t},_getMapKeys:function(t){if(t.keys)return Array.from(t.keys());var e=[];return t.forEach(function(t,r){e.push(r)}),e},removeFeatures:function(t,e,r){for(var n=0;n<t.length;n++)for(var i=t[n].length-1;i>=0;i--){var o=t[n][i];r.has(o.index)&&t[n].splice(i,1)}e.forEach(function(t,n){r.has(t)&&e.delete(n)}),r.size>0&&this._sort_features(t,e)},chooseFeaturesByCHI:function(t,e,n){(new Date).getTime();for(var i=this.vocabulary_,o=i.size,s=this._getMapKeys(i),a=[],u=new Set,h=0;h<o;h++)u.add(h);for(var l=0;l<n.length;l++){(new Date).getTime();for(var c=new Array(o).fill(0),f=new Array(o).fill(0),d=new Array(o).fill(0),p=new Array(o).fill(0),v=new Array(o).fill(0),_=new Array(o).fill(0),g=n[l].end-n[l].begin+1,m=e.length-g,b=0;b<e.length;b++)for(var y=0;y<t[b].length;y++){var w=t[b][y];w.value>0&&(b>=n[l].begin&&b<=n[l].end?c[w.index]>0?c[w.index]++:c[w.index]=1:f[w.index]>0?f[w.index]++:f[w.index]=1)}for(var x=i.size-1;x>=0;x--)d[x]=g-c[x],p[x]=m-f[x],v[x]=c[x]*p[x]-f[x]*d[x],_[x]=v[x]*v[x]/((c[x]+d[x])*(c[x]+f[x])*(f[x]+p[x])*(d[x]+p[x]));(new Date).getTime();var S=r(_);a.push(S);for(var M="",D=0;D<100;D++)M=M+s[S[D]]+":"+_[S[D]]+","}for(var A=0;A<a.length;A++)for(var T=0;T<100;T++)u.delete(a[A][T]);this.removeFeatures(t,i,u)},_count_vocab:function(t,e){var r;r=e?this.vocabulary_:new Map;var n=this.build_analyzer();[].push(0);for(var i=new Array(t.length),o=0;o<t.length;o++){var s=t[o],a=new Map,u=s&&n(s);if(u)for(var h=0;h<u.length;h++){var l=u[h];try{e||r.has(l)||r.set(l,r.size);var c=r.get(l);null!==c&&void 0!==c&&(a.has(c)?a.set(c,a.get(c)+1):a.set(c,1))}catch(t){if(console.log(t),t instanceof Error)continue;throw t}}var f=[];a.forEach(function(t,e){f.push({index:e,value:t})}),i[o]=f}return[r,i]},_limit_features:function(t,e,r,n,i){if(!r&&!n&&!i)return[t,new Set];for(var o=function(t){for(var e=[],r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++){var i=t[r][n];e[i.index]?e[i.index]++:e[i.index]=1}return e}(t),s=new Set,a=o.length-1;a>=0;a--)(o[a]>=r||o[a]<=n)&&(s.add(a),o.splice(a,1));this.removeFeatures(t,e,s)},fit:function(t){return this.fit_transform(t),this},fit_transform:function(t,e){if("string"==typeof t)throw"Iterable over raw text documents expected, string object received.";var r,n=this.max_df,i=this.min_df,o=this.max_features,s=this._count_vocab(t,e);e||(r=s[0],this.vocabulary_=r);var a=s[1];e||(a=this._sort_features(a,this.vocabulary_));var u=t.length,h=n>1?n:n*u,l=i>=1?i:i*u;return e||this._limit_features(a,this.vocabulary_,h,l,o),a},transform:function(t){if("string"==typeof t)throw"Iterable over raw text documents expected, string object received.";for(var e=this._count_vocab(t,!0),r=e[1],n=0;n<r.length;n++)r[n].sort(function(t,e){return t.index-e.index});return e[1]},get_feature_names:function(){var t=[];return this.vocabulary_.forEach(function(e,r){t.push(e+":"+r)}),t},toString:function(){var t="";return this.vocabulary_.forEach(function(e,r){t+=e+":"+r+","}),'{"max_df":'+this.max_df+',"min_df":'+this.min_df+',"lowercase":'+this.lowercase+',"analyzer":"'+this.analyzer+'","stop_words":'+(this.stop_words?'"'+this.stop_words+'"':null)+"}\n"+t}})}.apply(null,n))||(t.exports=i)},3486:function(t,e,r){var n,i;n=[r(2),r(0)],void 0===(i=function(t,e){return t([],{norm:"l1",use_idf:!0,smooth_idf:!0,sublinear_tf:!1,constructor:function(t,e,r,n){this.norm=t||"l1",this.use_idf=e||!0,this.smooth_idf=r||!0,this.sublinear_tf=n||!1},_document_frequency:function(t){for(var e=[],r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++){var i=t[r][n];e[i.index]?e[i.index]++:e[i.index]=1}return e},normalize:function(t){for(var e=0;e<t.length;e++){for(var r=0,n=0;n<t[e].length;n++){r+=(i=t[e][n]).value*i.value}if(r>0){r=Math.sqrt(r);for(n=0;n<t[e].length;n++){var i;(i=t[e][n]).value=i.value/r}}}return t},fit:function(t){if(this.use_idf){for(var e=this._document_frequency(t),r=t.length,n=e.length,i=this.smooth_idf?1:0,o=[n],s=0;s<n;s++)o[s]=Math.log((r+i)/(e[s]+i))+1;this._idf_diag=o}return this},transform:function(t,r){var n=r?e.clone(t):t,i=n.length;if(this.use_idf)for(var o=0;o<i;o++)for(var s=0;s<n[o].length;s++){var a=n[o][s];a.value=a.value*this._idf_diag[a.index]}return this.norm&&(n=this.normalize(n)),n},idf_:function(){return this._idf_diag}})}.apply(null,n))||(t.exports=i)},3487:function(t,e,r){var n,i;n=[r(2),r(3486),r(3485)],void 0===(i=function(t,e,r){var n;return t([],{input:n,encoding:n,decode_error:n,strip_accents:n,lowercase:n,preprocessor:n,tokenizer:n,analyzer:n,stop_words:n,token_pattern:n,ngram_range:n,max_df:n,min_df:n,max_features:n,vocabulary:n,binary:n,dtype:n,norm:n,use_idf:n,smooth_idf:n,sublinear_tf:n,_tfidf:n,idf_:n,_countVectorizer:n,constructor:function(){this._tfidf=new e,this._countVectorizer=new r},__init__:function(t,n,i,o,s,a,u,h,l,c,f,d,p,v,_,g,m,b,y,w,x){this.input=void 0===t?"content":t,this.encoding=void 0===t?"utf-8":n,this.decode_error=void 0===t?"strict":i,this.strip_accents=void 0===t?null:o,this.lowercase=void 0===t||s,this.preprocessor=void 0===t?null:a,this.tokenizer=void 0===t?null:u,this.analyzer=void 0===t?"word":h,this.stop_words=void 0===t?null:l,this.token_pattern=void 0===t?"(?u)\\b\\w\\w+\\b":c,this.ngram_range=void 0===t?new Array(1,1):f,this.max_df=void 0===t?1:d,this.min_df=void 0===t?1:p,this.max_features=void 0===t?null:v,this.vocabulary=void 0===t?null:_,this.binary=void 0!==t&&g,this.dtype=void 0===t?"int":m,this.norm=void 0===t?"l2":b,this.use_idf=void 0===t||y,this.smooth_idf=void 0===t||w,this.sublinear_tf=void 0!==t&&x,this._tfidf=new e(this.norm,this.use_idf,this.smooth_idf,this.sublinear_tf),this._countVectorizer=new r},setNorm:function(t){this.norm=t},setUseidf:function(t){this.use_idf=t},setSmoothIdf:function(t){this.smooth_idf=t},setSublinearTf:function(t){this.sublinear_tf=t},getIdf:function(){return this._tfidf.idf_()},fit:function(t){var e=this._countVectorizer.fit_transform(t);return this._tfidf.fit(e),this},fit_transform:function(t,e){var r=this._countVectorizer.fit_transform(t,e);return this._tfidf.fit(r),this._tfidf.transform(r,!1)},transform:function(t){var e=this._countVectorizer.transform(t);return this._tfidf.transform(e,!1)},get_feature_names:function(){return this._countVectorizer.get_feature_names()},getVocabulary:function(){return this._countVectorizer.vocabulary_},setMaxdf:function(t){this._countVectorizer.max_df=t},setMindf:function(t){this._countVectorizer.min_df=t},setStopWords:function(t){this._countVectorizer.stop_words=t},setLowercase:function(t){this._countVectorizer.lowercase=t},setAnalyzer:function(t){this._countVectorizer.analyzer=t},chooseFeaturesByCHI:function(t,e,r){this._countVectorizer.chooseFeaturesByCHI(t,e,r)},toString:function(){return this._countVectorizer.toString()+"\n"+JSON.stringify(this._tfidf)},loadFromStr:function(t){if(t){var e=t.split("\n"),r=JSON.parse(e[0]);this.setMaxdf(r.max_df),this.setMindf(r.min_df),this.setStopWords(r.stop_words),this.setLowercase(r.lowercase),this.setAnalyzer(r.analyzer);for(var n=e[1].split(","),i=new Map,o=0;o<n.length;o++)if(n[o]){var s=n[o].split(":");i.set(s[1],parseInt(s[0]))}this._countVectorizer.vocabulary_=i,this._tfidf._idf_diag=JSON.parse(e[2])._idf_diag}}})}.apply(null,n))||(t.exports=i)},3488:function(t,e,r){var n,i;void 0===(i="function"==typeof(n=function(){return function(){var t=function(){this.param=null,this.nr_class=0,this.l=0,this.SV=null,this.sv_coef=null,this.rho=null,this.probA=null,this.probB=null,this.sv_indices=null,this.label=null,this.nSV=null},e=function(){this.index=0,this.value=0},r=function(){this.svm_type=0,this.kernel_type=0,this.degree=0,this.gamma=0,this.coef0=0,this.cache_size=0,this.eps=0,this.C=0,this.nr_weight=0,this.weight_label=null,this.weight=null,this.nu=0,this.p=0,this.shrinking=0,this.probability=0};r.prototype.toString=function(){var t="C:";return t+=this.C,t+=" svm_type:",t+=this.svm_type,t+=" kernel_type:",t+=this.kernel_type,t+=" eps:",t+=this.eps},r.C_SVC=0,r.NU_SVC=1,r.ONE_CLASS=2,r.EPSILON_SVR=3,r.NU_SVR=4,r.LINEAR=0,r.POLY=1,r.RBF=2,r.SIGMOID=3,r.PRECOMPUTED=4;var n=function(){this.l=0,this.y=null,this.x=null};function i(t){var e;if(null===t||!(t instanceof Object))return t;if(t instanceof Date)return(e=new Date).setTime(t.getTime()),e;if(t instanceof Array){e=[];for(var r=0,n=t.length;r<n;r++)e[r]=i(t[r]);return e}return t instanceof Object?(e={},Object.keys(t).forEach(function(r){Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=i(t[r]))}),e):e}function o(t,e){for(var r=new Array(t),n=0;n<t;n++)r[n]=e;return r}function s(t,e,r){for(var n=new Array(t),i=0;i<t;i++){n[i]=new Array(e);for(var o=0;o<e;o++)n[i][o]=r}return n}function a(t,e,r,n,i){for(var o=r,s=0;s<i;s++)o[n+s]=t[e+s]}var u=function(){},h=function(t,e){this.l=0,this.size=0,this.head=null,this.lru_head=null,this.head_t=function(){this.prev=null,this.next=null,this.data=null,this.len=0},this.l=t,this.size=e,this.head=new Array(this.l);for(var r=0;r<this.l;r++)this.head[r]=new this.head_t;this.size/=4,this.size-=4*this.l,this.size=Math.max(this.size,2*this.l),this.lru_head=new this.head_t,this.lru_head.next=this.lru_head,this.lru_head.prev=this.lru_head};h.prototype.lru_delete=function(t){var e=t;e.prev.next=e.next,e.next.prev=e.prev},h.prototype.lru_insert=function(t){var e=t;e.next=this.lru_head,e.prev=this.lru_head.prev,e.prev.next=e,e.next.prev=e},h.prototype.get_data=function(t,e,r){var n=r,i=e,s=this.head[t];s.len>0&&this.lru_delete(s);var u=n-s.len;if(u>0){for(;this.size<u;){var h=this.lru_head.next;this.lru_delete(h),this.size+=h.len,h.data=null,h.len=0}var l=o(n,0);null!==s.data&&a(s.data,0,l,0,s.len),s.data=l,this.size-=u;var c=s.len;s.len=n,n=c}return this.lru_insert(s),i[0]=s.data,n},h.prototype.swap_index=function(t,e){var r,n=t,i=e;if(n!==i){this.head[n].len>0&&this.lru_delete(this.head[n]),this.head[i].len>0&&this.lru_delete(this.head[i]),r=this.head[n].data,this.head[n].data=this.head[i].data,this.head[i].data=r,r=this.head[n].len,this.head[n].len=this.head[i].len,this.head[i].len=r,this.head[n].len>0&&this.lru_insert(this.head[n]),this.head[i].len>0&&this.lru_insert(this.head[i]),n>i&&(r=n,n=i,i=r);for(var o=this.lru_head.next;o!==this.lru_head;o=o.next)o.len>n&&(o.len>i?(r=o.data[n],o.data[n]=o.data[i],o.data[i]=r):(this.lru_delete(o),this.size+=o.len,o.data=null,o.len=0))}};var l=function t(e,r,n){if(0!==arguments.length)if(this.x=null,this.x_square=null,this.kernel_type=0,this.degree=0,this.gamma=0,this.coef0=0,this.kernel_type=n.kernel_type,this.degree=n.degree,this.gamma=n.gamma,this.coef0=n.coef0,this.x=i(r),2===this.kernel_type){this.x_square=o(e,0);for(var s=0;s<e;s++)this.x_square[s]=t.dot(this.x[s],this.x[s])}else this.x_square=null};l.prototype.swap_index=function(t,e){var r;r=this.x[t],this.x[t]=this.x[e],this.x[e]=r,null!==this.x_square&&(r=this.x_square[t],this.x_square[t]=this.x_square[e],this.x_square[e]=r)},l.powi=function(t,e){for(var r=t,n=1,i=e;i>0;i/=2)i%2==1&&(n*=r),r*=r;return n},l.prototype.kernel_function=function(t,e){switch(this.kernel_type){case 0:return l.dot(this.x[t],this.x[e]);case 1:return l.powi(this.gamma*l.dot(this.x[t],this.x[e])+this.coef0,this.degree);case 2:return Math.exp(-this.gamma*(this.x_square[t]+this.x_square[e]-2*l.dot(this.x[t],this.x[e])));case 3:return Math.tanh(this.gamma*l.dot(this.x[t],this.x[e])+this.coef0);case 4:return this.x[t][Math.round(this.x[e][0].value)].value;default:return 0}},l.dot=function(t,e){for(var r=0,n=t.length,i=e.length,o=0,s=0;o<n&&s<i;)t[o].index===e[s].index?r+=t[o++].value*e[s++].value:t[o].index!==e[s].index&&(t[o].index>e[s].index?++s:++o);return r},l.k_function=function(t,e,r){switch(r.kernel_type){case 0:return l.dot(t,e);case 1:return l.powi(r.gamma*l.dot(t,e)+r.coef0,r.degree);case 2:for(var n=0,i=t.length,o=e.length,s=0,a=0;s<i&&a<o;)if(t[s].index===e[a].index){var u=t[s++].value-e[a++].value;n+=u*u}else t[s].index>e[a].index?(n+=e[a].value*e[a].value,++a):(n+=t[s].value*t[s].value,++s);for(;s<i;)n+=t[s].value*t[s].value,++s;for(;a<o;)n+=e[a].value*e[a].value,++a;return Math.exp(-r.gamma*n);case 3:return Math.tanh(r.gamma*l.dot(t,e)+r.coef0);case 4:return t[Math.round(e[0].value)].value;default:return 0}};var c=function(){this.active_size=0,this.y=null,this.G=null,this.alpha_status=null,this.alpha=null,this.Q=null,this.QD=null,this.eps=0,this.Cp=0,this.Cn=0,this.p=null,this.active_set=null,this.G_bar=null,this.l=0,this.unshrink=!1};c.prototype.Solve=function(t,e,r,n,s,a,h,l,c,f){var d=s,p=c;if(0!==arguments.length){var v,_,g;for(this.active_size=0,this.y=null,this.G=null,this.alpha_status=null,this.alpha=null,this.Q=null,this.QD=null,this.eps=0,this.Cp=0,this.Cn=0,this.p=null,this.active_set=null,this.G_bar=null,this.l=0,this.unshrink=!1,this.l=t,this.Q=e,this.QD=e.get_QD(),this.p=i(r),this.y=i(n),this.alpha=i(d),this.Cp=a,this.Cn=h,this.eps=l,this.unshrink=!1,this.alpha_status=o(t,0),v=0;v<t;v++)this.update_alpha_status(v);for(this.active_set=o(t,0),v=0;v<t;v++)this.active_set[v]=v;for(this.active_size=t,this.G=o(t,0),this.G_bar=o(t,0),v=0;v<t;v++)this.G[v]=this.p[v],this.G_bar[v]=0;for(v=0;v<t;v++)if(!this.is_lower_bound(v)){g=e.get_Q(v,t);var m=this.alpha[v];for(_=0;_<t;_++)this.G[_]+=m*g[_];if(this.is_upper_bound(v))for(_=0;_<t;_++)this.G_bar[_]+=this.get_C(v)*g[_]}for(var b=0,y=Math.max(1e7,t>21474836?2147483647:100*t),w=Math.min(t,1e3)+1,x=o(2,0);b<y;){if(0==--w&&(w=Math.min(t,1e3),0!==f&&this.do_shrinking(),u.info(".")),0!==this.select_working_set(x)){if(this.reconstruct_gradient(),this.active_size=t,u.info("*"),0!==this.select_working_set(x))break;w=1}v=x[0],_=x[1],++b,g=e.get_Q(v,this.active_size);var S,M,D=e.get_Q(_,this.active_size),A=this.get_C(v),T=this.get_C(_),O=this.alpha[v],k=this.alpha[_];if(this.y[v]!==this.y[_]){(S=this.QD[v]+this.QD[_]+2*g[_])<=0&&(S=1e-12),M=(-this.G[v]-this.G[_])/S;var E=this.alpha[v]-this.alpha[_];this.alpha[v]+=M,this.alpha[_]+=M,E>0?this.alpha[_]<0&&(this.alpha[_]=0,this.alpha[v]=E):E<=0&&this.alpha[v]<0&&(this.alpha[v]=0,this.alpha[_]=-E),E>A-T?this.alpha[v]>A&&(this.alpha[v]=A,this.alpha[_]=A-E):E<=A-T&&this.alpha[_]>T&&(this.alpha[_]=T,this.alpha[v]=T+E)}else{(S=this.QD[v]+this.QD[_]-2*g[_])<=0&&(S=1e-12),M=(this.G[v]-this.G[_])/S;var C=this.alpha[v]+this.alpha[_];this.alpha[v]-=M,this.alpha[_]+=M,C>A?this.alpha[v]>A&&(this.alpha[v]=A,this.alpha[_]=C-A):C<=A&&this.alpha[_]<0&&(this.alpha[_]=0,this.alpha[v]=C),C>T?this.alpha[_]>T&&(this.alpha[_]=T,this.alpha[v]=C-T):C<=T&&this.alpha[v]<0&&(this.alpha[v]=0,this.alpha[_]=C)}var j,I=this.alpha[v]-O,N=this.alpha[_]-k;for(j=0;j<this.active_size;j++)this.G[j]+=g[j]*I+D[j]*N;var L=this.is_upper_bound(v),F=this.is_upper_bound(_);if(this.update_alpha_status(v),this.update_alpha_status(_),L!==this.is_upper_bound(v))if(g=e.get_Q(v,t),L)for(j=0;j<t;j++)this.G_bar[j]-=A*g[j];else for(j=0;j<t;j++)this.G_bar[j]+=A*g[j];if(F!==this.is_upper_bound(_))if(D=e.get_Q(_,t),F)for(j=0;j<t;j++)this.G_bar[j]-=T*D[j];else for(j=0;j<t;j++)this.G_bar[j]+=T*D[j]}b>=y&&(this.active_size<t&&(this.reconstruct_gradient(),this.active_size=t,u.info("*")),console.error("\nWARNING: reaching max number of iterations\n")),p.rho=this.calculate_rho();var P=0;for(v=0;v<t;v++)P+=this.alpha[v]*(this.G[v]+this.p[v]);for(p.obj=P/2,v=0;v<t;v++)d[this.active_set[v]]=this.alpha[v];p.upper_bound_p=a,p.upper_bound_n=h;var z="\noptimization finished, #iter = ";z+=b,u.info(z+="\n")}},c.prototype.get_C=function(t){return this.y[t]>0?this.Cp:this.Cn},c.prototype.update_alpha_status=function(t){this.alpha[t]>=this.get_C(t)?this.alpha_status[t]=1:this.alpha[t]<=0?this.alpha_status[t]=0:this.alpha_status[t]=2},c.prototype.is_upper_bound=function(t){return 1===this.alpha_status[t]},c.prototype.is_lower_bound=function(t){return 0===this.alpha_status[t]},c.prototype.is_free=function(t){return 2===this.alpha_status[t]},c.prototype.swap_index=function(t,e){var r;this.Q.swap_index(t,e),r=this.y[t],this.y[t]=this.y[e],this.y[e]=r,r=this.G[t],this.G[t]=this.G[e],this.G[e]=r,r=this.alpha_status[t],this.alpha_status[t]=this.alpha_status[e],this.alpha_status[e]=r,r=this.alpha[t],this.alpha[t]=this.alpha[e],this.alpha[e]=r,r=this.p[t],this.p[t]=this.p[e],this.p[e]=r,r=this.active_set[t],this.active_set[t]=this.active_set[e],this.active_set[e]=r,r=this.G_bar[t],this.G_bar[t]=this.G_bar[e],this.G_bar[e]=r},c.prototype.reconstruct_gradient=function(){if(this.active_size!==this.l){var t,e,r,n=0;for(e=this.active_size;e<this.l;e++)this.G[e]=this.G_bar[e]+this.p[e];for(e=0;e<this.active_size;e++)this.is_free(e)&&n++;if(2*n<this.active_size&&u.info("\nWARNING: using -h 0 may be faster\n"),n*this.l>2*this.active_size*(this.l-this.active_size))for(t=this.active_size;t<this.l;t++)for(r=this.Q.get_Q(t,this.active_size),e=0;e<this.active_size;e++)this.is_free(e)&&(this.G[t]+=this.alpha[e]*r[e]);else for(t=0;t<this.active_size;t++)if(this.is_free(t)){r=this.Q.get_Q(t,this.l);var i=this.alpha[t];for(e=this.active_size;e<this.l;e++)this.G[e]+=i*r[e]}}},c.prototype.select_working_set=function(t){for(var e=t,r=-Number.MAX_VALUE,n=-Number.MAX_VALUE,i=-1,o=-1,s=Number.MAX_VALUE,a=0;a<this.active_size;a++)1===this.y[a]?this.is_upper_bound(a)||-this.G[a]>=r&&(r=-this.G[a],i=a):1!==this.y[a]&&(this.is_lower_bound(a)||this.G[a]>=r&&(r=this.G[a],i=a));var u,h,l,c=i,f=null;-1!==c&&(f=this.Q.get_Q(c,this.active_size));for(var d=0;d<this.active_size;d++)1===this.y[d]?this.is_lower_bound(d)||(u=r+this.G[d],this.G[d]>=n&&(n=this.G[d]),u>0&&(h=(l=this.QD[c]+this.QD[d]-2*this.y[c]*f[d])>0?-u*u/l:-u*u/1e-12)<=s&&(o=d,s=h)):1!==this.y[d]&&(this.is_upper_bound(d)||(u=r-this.G[d],-this.G[d]>=n&&(n=-this.G[d]),u>0&&(h=(l=this.QD[c]+this.QD[d]+2*this.y[c]*f[d])>0?-u*u/l:-u*u/1e-12)<=s&&(o=d,s=h)));return r+n<this.eps||-1===o?1:(e[0]=i,e[1]=o,0)},c.prototype.be_shrunk=function(t,e,r){return this.is_upper_bound(t)?1===this.y[t]?-this.G[t]>e:-this.G[t]>r:!!this.is_lower_bound(t)&&(1===this.y[t]?this.G[t]>r:this.G[t]>e)},c.prototype.do_shrinking=function(){var t,e=-Number.MAX_VALUE,r=-Number.MAX_VALUE;for(t=0;t<this.active_size;t++)1===this.y[t]?(this.is_upper_bound(t)||-this.G[t]>=e&&(e=-this.G[t]),this.is_lower_bound(t)||this.G[t]>=r&&(r=this.G[t])):1!==this.y[t]&&(this.is_upper_bound(t)||-this.G[t]>=r&&(r=-this.G[t]),this.is_lower_bound(t)||this.G[t]>=e&&(e=this.G[t]));for(!1===this.unshrink&&e+r<=10*this.eps&&(this.unshrink=!0,this.reconstruct_gradient(),this.active_size=this.l),t=0;t<this.active_size;t++)if(this.be_shrunk(t,e,r))for(this.active_size--;this.active_size>t;){if(!this.be_shrunk(this.active_size,e,r)){this.swap_index(t,this.active_size);break}this.active_size--}},c.prototype.calculate_rho=function(){for(var t=0,e=Number.MAX_VALUE,r=-Number.MAX_VALUE,n=0,i=0;i<this.active_size;i++){var o=this.y[i]*this.G[i];this.is_lower_bound(i)?this.y[i]>0?e=Math.min(e,o):r=Math.max(r,o):this.is_upper_bound(i)?this.y[i]<0?e=Math.min(e,o):r=Math.max(r,o):(++t,n+=o)}return t>0?n/t:(e+r)/2},c.LOWER_BOUND=0,c.UPPER_BOUND=1,c.FREE=2,c.INF=Number.MAX_VALUE,c.SolutionInfo=function(){this.obj=0,this.rho=0,this.upper_bound_p=0,this.upper_bound_n=0,this.r=0};var f=function(t,e,r,n,i,o,s,a,u,h){this.si=u,c.call(this,t,e,r,n,i,o,s,a,u,h)};(f.prototype=new c).constructor=f,f.prototype.select_working_set=function(t){for(var e,r,n,i=t,o=-Number.MAX_VALUE,s=-Number.MAX_VALUE,a=-1,u=-Number.MAX_VALUE,h=-Number.MAX_VALUE,l=-1,c=-1,f=Number.MAX_VALUE,d=0;d<this.active_size;d++)1===this.y[d]?this.is_upper_bound(d)||-this.G[d]>=o&&(o=-this.G[d],a=d):1!==this.y[d]&&(this.is_lower_bound(d)||this.G[d]>=u&&(u=this.G[d],l=d));var p=a,v=l,_=null,g=null;-1!==p&&(_=this.Q.get_Q(p,this.active_size)),-1!==v&&(g=this.Q.get_Q(v,this.active_size));for(var m=0;m<this.active_size;m++)1===this.y[m]?this.is_lower_bound(m)||(r=o+this.G[m],this.G[m]>=s&&(s=this.G[m]),r>0&&(e=(n=this.QD[p]+this.QD[m]-2*_[m])>0?-r*r/n:-r*r/1e-12)<=f&&(c=m,f=e)):1!==this.y[m]&&(this.is_upper_bound(m)||(r=u-this.G[m],-this.G[m]>=h&&(h=-this.G[m]),r>0&&(e=(n=this.QD[v]+this.QD[m]-2*g[m])>0?-r*r/n:-r*r/1e-12)<=f&&(c=m,f=e)));return Math.max(o+s,u+h)<this.eps||-1===c?1:(1===this.y[c]?i[0]=a:i[0]=l,i[1]=c,0)},f.prototype.be_shrunk=function(t,e,r,n,i){return this.is_upper_bound(t)?1===this.y[t]?-this.G[t]>e:-this.G[t]>i:!!this.is_lower_bound(t)&&(1===this.y[t]?this.G[t]>r:this.G[t]>n)},f.prototype.do_shrinking=function(){var t,e=-Number.MAX_VALUE,r=-Number.MAX_VALUE,n=-Number.MAX_VALUE,i=-Number.MAX_VALUE;for(t=0;t<this.active_size;t++)this.is_upper_bound(t)||(1===this.y[t]?-this.G[t]>e&&(e=-this.G[t]):-this.G[t]>i&&(i=-this.G[t])),this.is_lower_bound(t)||(1===this.y[t]?this.G[t]>r&&(r=this.G[t]):this.G[t]>n&&(n=this.G[t]));for(!1===this.unshrink&&Math.ma(e+r,n+i)<=10*this.eps&&(this.unshrink=!0,this.reconstruct_gradient(),this.active_size=this.l),t=0;t<this.active_size;t++)if(this.be_shrunk(t,e,r,n,i))for(this.active_size--;this.active_size>t;){if(!this.be_shrunk(this.active_size,e,r,n,i)){this.swap_index(t,this.active_size);break}this.active_size--}},f.prototype.calculate_rho=function(){for(var t,e,r=0,n=0,i=Number.MAX_VALUE,o=Number.MAX_VALUE,s=-Number.MAX_VALUE,a=-Number.MAX_VALUE,u=0,h=0,l=0;l<this.active_size;l++)1===this.y[l]?this.is_lower_bound(l)?i=Math.min(i,this.G[l]):this.is_upper_bound(l)?s=Math.max(s,this.G[l]):(++r,u+=this.G[l]):1!==this.y[l]&&(this.is_lower_bound(l)?o=Math.min(o,this.G[l]):this.is_upper_bound(l)?a=Math.max(a,this.G[l]):(++n,h+=this.G[l]));return t=r>0?u/r:(i+s)/2,e=n>0?h/n:(o+a)/2,this.si.r=(t+e)/2,(t-e)/2};var d=function(t,e,r){l.call(this,t.l,t.x,e),this.y=i(r),this.cache=new h(t.l,Math.round(1048576*e.cache_size)),this.QD=o(t.l,0);for(var n=0;n<t.l;n++)this.QD[n]=this.kernel_function(n,n)};(d.prototype=new l).constructor=d,d.prototype.get_Q=function(t,e){var r,n=o(1,0),i=this.cache.get_data(t,n,e);if(i<e)for(r=i;r<e;r++)n[0][r]=this.y[t]*this.y[r]*this.kernel_function(t,r);return n[0]},d.prototype.get_QD=function(){return this.QD},d.prototype.swap_index=function(t,e){var r;this.cache.swap_index(t,e),l.prototype.swap_index.apply(this,[t,e]),r=this.y[t],this.y[t]=this.y[e],this.y[e]=r,r=this.QD[t],this.QD[t]=this.QD[e],this.QD[e]=r};var p=function(t,e){l.call(this,t.l,t.x,e),this.cache=new h(t.l,Math.round(1048576*e.cache_size)),this.QD=o(t.l,0);for(var r=0;r<t.l;r++)this.QD[r]=this.kernel_function(r,r)};(p.prototype=new l).constructor=p,p.prototype.get_Q=function(t,e){var r,n=o(1,0),i=this.cache.get_data(t,n,e);if(i<e)for(r=i;r<e;r++)n[0][r]=this.kernel_function(t,r);return n[0]},p.prototype.get_QD=function(){return this.QD},p.prototype.swap_index=function(t,e){this.cache.swap_index(t,e),l.prototype.swap_index.apply(this,[t,e]);var r=this.QD[t];this.QD[t]=this.QD[e],this.QD[e]=r};var v,_=function(t,e){l.call(this,t.l,t.x,e),this.l=t.l,this.cache=new h(this.l,Math.round(1048576*e.cache_size)),this.QD=o(2*this.l,0),this.sign=o(2*this.l,0),this.index=o(2*this.l,0);for(var r=0;r<this.l;r++)this.sign[r]=1,this.sign[r+this.l]=-1,this.index[r]=r,this.index[r+this.l]=r,this.QD[r]=this.kernel_function(r,r),this.QD[r+this.l]=this.QD[r];this.buffer=s(2,2*this.l,0),this.next_buffer=0};(_.prototype=new l).constructor=_,_.prototype.swap_index=function(t,e){var r;r=this.sign[t],this.sign[t]=this.sign[e],this.sign[e]=r,r=this.index[t],this.index[t]=this.index[e],this.index[e]=r,r=this.QD[t],this.QD[t]=this.QD[e],this.QD[e]=r},_.prototype.get_Q=function(t,e){var r,n=o(1,0),i=this.index[t];if(this.cache.get_data(i,n,this.l)<this.l)for(r=0;r<this.l;r++)n[0][r]=this.kernel_function(i,r);var s=this.buffer[this.next_buffer];this.next_buffer=1-this.next_buffer;var a=this.sign[t];for(r=0;r<e;r++)s[r]=a*this.sign[r]*n[0][this.index[r]];return s},_.prototype.get_QD=function(){return this.QD},u.svm_print_string=function(t){console.log(t)},u.info=function(t){},u.solve_c_svc=function(t,e,r,n,i,s){var a,h=r,l=t.l,f=o(l,0),p=o(l,0);for(a=0;a<l;a++)h[a]=0,f[a]=-1,t.y[a]>0?p[a]=1:p[a]=-1;(new c).Solve(l,new d(t,e,p),f,p,h,i,s,e.eps,n,e.shrinking);var v=0;for(a=0;a<l;a++)v+=h[a];if(i===s){var _="nu = ";_+=v/(i*t.l),u.info(_+="\n")}for(a=0;a<l;a++)h[a]*=p[a]},u.solve_nu_svc=function(t,e,r,n){var i,s=r,a=n,h=t.l,l=e.nu,c=o(h,0);for(i=0;i<h;i++)t.y[i]>0?c[i]=1:c[i]=-1;var p=l*h/2,v=l*h/2;for(i=0;i<h;i++)1===c[i]?(s[i]=Math.min(1,p),p-=s[i]):(s[i]=Math.min(1,v),v-=s[i]);var _=o(h,0);for(i=0;i<h;i++)_[i]=0;(new f).Solve(h,new d(t,e,c),_,c,s,1,1,e.eps,a,e.shrinking);var g=a.r,m="C = ";for(m+=1/g,u.info(m+="\n"),i=0;i<h;i++)s[i]*=c[i]/g;a.rho/=g,a.obj/=g*g,a.upper_bound_p=1/g,a.upper_bound_n=1/g},u.solve_one_class=function(t,e,r,n){var i,s=r,a=t.l,u=o(a,0),h=o(a,0),l=Math.round(e.nu*t.l);for(i=0;i<l;i++)s[i]=1;for(l<t.l&&(s[l]=e.nu*t.l-l),i=l+1;i<a;i++)s[i]=0;for(i=0;i<a;i++)u[i]=0,h[i]=1;(new c).Solve(a,new p(t,e),u,h,s,1,1,e.eps,n,e.shrinking)},u.solve_epsilon_svr=function(t,e,r,n){var i,s=r,a=t.l,h=o(2*a,0),l=o(2*a,0),f=o(2*a,0);for(i=0;i<a;i++)h[i]=0,l[i]=e.p-t.y[i],f[i]=1,h[i+a]=0,l[i+a]=e.p+t.y[i],f[i+a]=-1;(new c).Solve(2*a,new _(t,e),l,f,h,e.C,e.C,e.eps,n,e.shrinking);var d=0;for(i=0;i<a;i++)s[i]=h[i]-h[i+a],d+=Math.abs(s[i]);var p="nu = ";p+=d/(e.C*a),u.info(p+="\n")},u.solve_nu_svr=function(t,e,r,n){var i,s=r,a=t.l,h=e.C,l=o(2*a,0),c=o(2*a,0),d=o(2*a,0),p=h*e.nu*a/2;for(i=0;i<a;i++)l[i]=Math.min(p,h),l[i+a]=Math.min(p,h),p-=l[i],c[i]=-t.y[i],d[i]=1,c[i+a]=t.y[i],d[i+a]=-1;(new f).Solve(2*a,new _(t,e),c,d,l,h,h,e.eps,n,e.shrinking);var v="epsilon = ";for(v+=-n.r,u.info(v+="\n"),i=0;i<a;i++)s[i]=l[i]-l[i+a]},u.svm_train_one=function(t,e,r,n){var i=o(t.l,0),s=new c.SolutionInfo;switch(e.svm_type){case 0:u.solve_c_svc(t,e,i,s,r,n);break;case 1:u.solve_nu_svc(t,e,i,s);break;case 2:u.solve_one_class(t,e,i,s);break;case 3:u.solve_epsilon_svr(t,e,i,s);break;case 4:u.solve_nu_svr(t,e,i,s)}var a="obj = ";a+=s.obj,a+=", rho = ",a+=s.rho,u.info(a+="\n");for(var h=0,l=0,f=0;f<t.l;f++)Math.abs(i[f])>0&&(++h,t.y[f]>0&&Math.abs(i[f])>=s.upper_bound_p?++l:t.y[f]<=0&&Math.abs(i[f])>=s.upper_bound_n&&++l);var d="nSV = ";d+=h,d+=", nBSV = ",d+=l,u.info(d+="\n");var p=new u.decision_function;return p.alpha=i,p.rho=s.rho,p},u.sigmoid_train=function(t,e,r,n){var i,s,a,h=n,l=0,c=0;for(a=0;a<t;a++)r[a]>0?l+=1:c+=1;var f,d,p,v,_,g,m,b,y,w,x,S,M,D,A,T,O,k,E,C=(l+1)/(l+2),j=1/(c+2),I=o(t,0);i=0,s=Math.log((c+1)/(l+1));var N=0;for(a=0;a<t;a++)r[a]>0?I[a]=C:I[a]=j,N+=(f=e[a]*i+s)>=0?I[a]*f+Math.log(1+Math.exp(-f)):(I[a]-1)*f+Math.log(1+Math.exp(f));for(E=0;E<100;E++){for(v=1e-12,_=1e-12,g=0,m=0,b=0,a=0;a<t;a++)(f=e[a]*i+s)>=0?(d=Math.exp(-f)/(1+Math.exp(-f)),p=1/(1+Math.exp(-f))):(d=1/(1+Math.exp(f)),p=Math.exp(f)/(1+Math.exp(f))),k=d*p,v+=e[a]*e[a]*k,_+=k,g+=e[a]*k,O=I[a]-d,m+=e[a]*O,b+=O;if(Math.abs(m)<1e-5&&Math.abs(b)<1e-5)break;for(S=m*(w=-(_*m-g*b)/(y=v*_-g*g))+b*(x=-(-g*m+v*b)/y),M=1;M>=1e-10;){for(D=i+M*w,A=s+M*x,T=0,a=0;a<t;a++)T+=(f=e[a]*D+A)>=0?I[a]*f+Math.log(1+Math.exp(-f)):(I[a]-1)*f+Math.log(1+Math.exp(f));if(T<N+1e-4*M*S){i=D,s=A,N=T;break}M/=2}if(M<1e-10){u.info("Line search fails in two-class probability estimates\n");break}}E>=100&&u.info("Reaching maximal iterations in two-class probability estimates\n"),h[0]=i,h[1]=s},u.sigmoid_predict=function(t,e,r){var n=t*e+r;return n>=0?Math.exp(-n)/(1+Math.exp(-n)):1/(1+Math.exp(n))},u.multiclass_probability=function(t,e,r){var n,i,a,h=r,l=0,c=Math.max(100,t),f=s(t,t,0),d=o(t,0),p=.005/t;for(n=0;n<t;n++){for(h[n]=1/t,f[n][n]=0,i=0;i<n;i++)f[n][n]+=e[i][n]*e[i][n],f[n][i]=f[i][n];for(i=n+1;i<t;i++)f[n][n]+=e[i][n]*e[i][n],f[n][i]=-e[i][n]*e[n][i]}for(l=0;l<c;l++){for(a=0,n=0;n<t;n++){for(d[n]=0,i=0;i<t;i++)d[n]+=f[n][i]*h[i];a+=h[n]*d[n]}var v=0;for(n=0;n<t;n++){var _=Math.abs(d[n]-a);_>v&&(v=_)}if(v<p)break;for(n=0;n<t;n++){var g=(-d[n]+a)/f[n][n];for(h[n]+=g,a=(a+g*(g*f[n][n]+2*d[n]))/(1+g)/(1+g),i=0;i<t;i++)d[i]=(d[i]+g*f[n][i])/(1+g),h[i]/=1+g}}l>=c&&u.info("Exceeds max_iter in multiclass_prob\n")},u.svm_binary_svc_probability=function(t,e,r,s,a){var h,l=o(t.l,0),c=o(t.l,0);for(h=0;h<t.l;h++)l[h]=h;for(h=0;h<t.l;h++){var f=h+u.rand(t.l-h),d=l[h];l[h]=l[f],l[f]=d}for(h=0;h<5;h++){var p,v=Math.floor(h*t.l/5),_=Math.floor((h+1)*t.l/5),g=new n;g.l=t.l-(_-v),g.x=new Array(g.l),g.y=o(g.l,0);var m=0;for(p=0;p<v;p++)g.x[m]=t.x[l[p]],g.y[m]=t.y[l[p]],++m;for(p=_;p<t.l;p++)g.x[m]=t.x[l[p]],g.y[m]=t.y[l[p]],++m;var b=0,y=0;for(p=0;p<m;p++)g.y[p]>0?b++:y++;if(0===b&&0===y)for(p=v;p<_;p++)c[l[p]]=0;else if(b>0&&0===y)for(p=v;p<_;p++)c[l[p]]=1;else if(0===b&&y>0)for(p=v;p<_;p++)c[l[p]]=-1;else{var w=i(e);w.probability=0,w.C=1,w.nr_weight=2,w.weight_label=o(2,0),w.weight=o(2,0),w.weight_label[0]=1,w.weight_label[1]=-1,w.weight[0]=r,w.weight[1]=s;var x=u.svm_train(g,w);for(p=v;p<_;p++){var S=o(1,0);u.svm_predict_values(x,t.x[l[p]],S),c[l[p]]=S[0],c[l[p]]*=x.label[0]}}}u.sigmoid_train(t.l,c,t.y,a)},u.svm_svr_probability=function(t,e){var r,n=o(t.l,0),s=0,a=i(e);for(a.probability=0,u.svm_cross_validation(t,a,5,n),r=0;r<t.l;r++)n[r]=t.y[r]-n[r],s+=Math.abs(n[r]);s/=t.l;var h=Math.sqrt(2*s*s),l=0;for(s=0,r=0;r<t.l;r++)Math.abs(n[r])>5*h?l+=1:s+=Math.abs(n[r]);var c="Prob. model for test data: ";return c+="target value = predicted value + ",c+="z,\nz: Laplace distribution e^(-|z|/sigma)/(2sigma),sigma=",c+=s/=t.l-l,u.info(c+="\n"),s},u.svm_group_classes=function(t,e,r,n,i,s){var u,h,l=e,c=r,f=n,d=i,p=s,v=t.l,_=16,g=0,m=o(_,0),b=o(_,0),y=o(v,0);for(u=0;u<v;u++){var w,x=Math.round(t.y[u]);for(w=0;w<g;w++)if(x===m[w]){++b[w];break}if(y[u]=w,w===g){if(g===_){var S=o(_*=2,0);a(m,0,S,0,m.length),m=S,a(b,0,S=o(_,0),0,b.length),b=S}m[g]=x,b[g]=1,++g}}if(2===g&&-1===m[0]&&1===m[1])for(h=m[0],m[0]=m[1],m[1]=h,h=b[0],b[0]=b[1],b[1]=h,u=0;u<v;u++)0===y[u]?y[u]=1:y[u]=0;var M=o(g,0);for(M[0]=0,u=1;u<g;u++)M[u]=M[u-1]+b[u-1];for(u=0;u<v;u++)p[M[y[u]]]=u,++M[y[u]];for(M[0]=0,u=1;u<g;u++)M[u]=M[u-1]+b[u-1];l[0]=g,c[0]=m,f[0]=M,d[0]=b},u.svm_train=function(e,r){var i=new t;i.param=r;var s,a,h,l,c=0;if(2===r.svm_type||3===r.svm_type||4===r.svm_type){for(i.nr_class=2,i.label=null,i.nSV=null,i.probA=null,i.probB=null,i.sv_coef=o(1,0),1!==r.probability||3!==r.svm_type&&4!==r.svm_type||(i.probA=o(1,0),i.probA[0]=u.svm_svr_probability(e,r)),h=u.svm_train_one(e,r,0,0),i.rho=o(1,0),i.rho[0]=h.rho,s=0;s<e.l;s++)Math.abs(h.alpha[s])>0&&++c;for(i.l=c,i.SV=new Array(c),i.sv_coef[0]=o(c,0),i.sv_indices=o(c,0),a=0,s=0;s<e.l;s++)Math.abs(h.alpha[s])>0&&(i.SV[a]=e.x[s],i.sv_coef[0][a]=h.alpha[s],i.sv_indices[a]=s+1,++a)}else{var f=e.l,d=o(1,0),p=o(1,0),v=o(1,0),_=o(1,0),g=o(f,0);u.svm_group_classes(e,d,p,v,_,g);var m,b,y,w,x,S=d[0],M=p[0],D=v[0],A=_[0];1===S&&u.info("WARNING: training data in only one class. See README for details.\n");var T=new Array(f);for(s=0;s<f;s++)T[s]=e.x[g[s]];var O=o(S,0);for(s=0;s<S;s++)O[s]=r.C;for(s=0;s<r.nr_weight;s++){for(a=0;a<S&&r.weight_label[s]!==M[a];a++);a===S?(l="WARNING: class label ",l+=r.weight_label[s],l+=" specified in weight is not found\n",console.error(l)):O[a]*=r.weight[s]}var k=o(f,!1);for(s=0;s<f;s++)k[s]=!1;h=new Array(Math.floor(S*(S-1)/2));var E=null,C=null;1===r.probability&&(E=o(Math.floor(S*(S-1)/2),0),C=o(Math.floor(S*(S-1)/2),0));var j=0;for(s=0;s<S;s++)for(a=s+1;a<S;a++){var I=new n;for(m=D[s],b=D[a],y=A[s],w=A[a],I.l=y+w,I.x=new Array(I.l),I.y=o(I.l,0),x=0;x<y;x++)I.x[x]=T[m+x],I.y[x]=1;for(x=0;x<w;x++)I.x[y+x]=T[b+x],I.y[y+x]=-1;if(1===r.probability){var N=o(2,0);u.svm_binary_svc_probability(I,r,O[s],O[a],N),E[j]=N[0],C[j]=N[1]}for(h[j]=u.svm_train_one(I,r,O[s],O[a]),x=0;x<y;x++)!k[m+x]&&Math.abs(h[j].alpha[x])>0&&(k[m+x]=!0);for(x=0;x<w;x++)!k[b+x]&&Math.abs(h[j].alpha[y+x])>0&&(k[b+x]=!0);++j}for(i.nr_class=S,i.label=o(S,0),s=0;s<S;s++)i.label[s]=M[s];for(i.rho=o(Math.floor(S*(S-1)/2),0),s=0;s<Math.floor(S*(S-1)/2);s++)i.rho[s]=h[s].rho;if(1===r.probability)for(i.probA=o(Math.floor(S*(S-1)/2),0),i.probB=o(Math.floor(S*(S-1)/2),0),s=0;s<Math.floor(S*(S-1)/2);s++)i.probA[s]=E[s],i.probB[s]=C[s];else i.probA=null,i.probB=null;var L=0,F=o(S,0);for(i.nSV=o(S,0),s=0;s<S;s++){for(c=0,a=0;a<A[s];a++)k[D[s]+a]&&(++c,++L);i.nSV[s]=c,F[s]=c}for(l="Total nSV = ",l+=L,u.info(l+="\n"),i.l=L,i.SV=new Array(L),i.sv_indices=o(L,0),j=0,s=0;s<f;s++)k[s]&&(i.SV[j]=T[s],i.sv_indices[j++]=g[s]+1);var P=o(S,0);for(P[0]=0,s=1;s<S;s++)P[s]=P[s-1]+F[s-1];for(i.sv_coef=o(S-1,0),s=0;s<S-1;s++)i.sv_coef[s]=o(L,0);for(j=0,s=0;s<S;s++)for(a=s+1;a<S;a++){m=D[s],b=D[a],y=A[s],w=A[a];var z=P[s];for(x=0;x<y;x++)k[m+x]&&(i.sv_coef[a-1][z++]=h[j].alpha[x]);for(z=P[a],x=0;x<w;x++)k[b+x]&&(i.sv_coef[s][z++]=h[j].alpha[y+x]);++j}}return i},u.svm_cross_validation=function(t,e,r,i){var s,a,h,l,c,f=i,d=o(r+1,0),p=t.l,v=o(p,0);if((0===e.svm_type||1===e.svm_type)&&r<p){var _=o(1,0),g=o(1,0),m=o(1,0),b=o(1,0);u.svm_group_classes(t,_,g,m,b,v);var y,w=_[0],x=m[0],S=b[0],M=o(r,0),D=o(p,0);for(s=0;s<p;s++)D[s]=v[s];for(y=0;y<w;y++)for(s=0;s<S[y];s++)h=s+u.rand(S[y]-s),a=D[x[y]+h],D[x[y]+h]=D[x[y]+s],D[x[y]+s]=a;for(s=0;s<r;s++)for(M[s]=0,y=0;y<w;y++)M[s]+=Math.floor((s+1)*S[y]/r)-Math.floor(s*S[y]/r);for(d[0]=0,s=1;s<=r;s++)d[s]=d[s-1]+M[s-1];for(y=0;y<w;y++)for(s=0;s<r;s++)for(l=x[y]+Math.floor(s*S[y]/r),c=x[y]+Math.floor((s+1)*S[y]/r),h=l;h<c;h++)v[d[s]]=D[h],d[s]++;for(d[0]=0,s=1;s<=r;s++)d[s]=d[s-1]+M[s-1]}else{for(s=0;s<p;s++)v[s]=s;for(s=0;s<p;s++)h=s+u.rand(p-s),a=v[s],v[s]=v[h],v[h]=a;for(s=0;s<=r;s++)d[s]=Math.floor(s*p/r)}for(s=0;s<r;s++){var A;l=d[s],c=d[s+1];var T=new n;for(T.l=p-(c-l),T.x=new Array(T.l),T.y=o(T.l,0),A=0,h=0;h<l;h++)T.x[A]=t.x[v[h]],T.y[A]=t.y[v[h]],++A;for(h=c;h<p;h++)T.x[A]=t.x[v[h]],T.y[A]=t.y[v[h]],++A;var O=u.svm_train(T,e);if(1!==e.probability||0!==e.svm_type&&1!==e.svm_type)for(h=l;h<c;h++)f[v[h]]=u.svm_predict(O,t.x[v[h]]);else{var k=o(u.svm_get_nr_class(O),0);for(h=l;h<c;h++)f[v[h]]=u.svm_predict_probability(O,t.x[v[h]],k)}}},u.svm_get_svm_type=function(t){return t.param.svm_type},u.svm_get_nr_class=function(t){return t.nr_class},u.svm_get_labels=function(t,e){var r=e;if(null!=t.label)for(var n=0;n<t.nr_class;n++)r[n]=t.label[n]},u.svm_get_sv_indices=function(t,e){var r=e;if(null!=t.sv_indices)for(var n=0;n<t.l;n++)r[n]=t.sv_indices[n]},u.svm_get_nr_sv=function(t){return t.l},u.svm_get_svr_probability=function(t){return 3!==t.param.svm_type&&4!==t.param.svm_type||null===t.probA?(console.error("Model doesn't contain information for SVR probability inference\n"),0):t.probA[0]},u.svm_predict_values=function(t,e,r){var n,i,s=r;if(2===t.param.svm_type||3===t.param.svm_type||4===t.param.svm_type){var a=t.sv_coef[0];for(i=0,n=0;n<t.l;n++)i+=a[n]*l.k_function(e,t.SV[n],t.param);return i-=t.rho[0],s[0]=i,2===t.param.svm_type?i>0?1:-1:i}var u=t.nr_class,h=t.l,c=o(h,0);for(n=0;n<h;n++)c[n]=l.k_function(e,t.SV[n],t.param);var f=o(u,0);for(f[0]=0,n=1;n<u;n++)f[n]=f[n-1]+t.nSV[n-1];var d=o(u,0);for(n=0;n<u;n++)d[n]=0;var p=0;for(n=0;n<u;n++)for(var v=n+1;v<u;v++){i=0;var _,g=f[n],m=f[v],b=t.nSV[n],y=t.nSV[v],w=t.sv_coef[v-1],x=t.sv_coef[n];for(_=0;_<b;_++)i+=w[g+_]*c[g+_];for(_=0;_<y;_++)i+=x[m+_]*c[m+_];i-=t.rho[p],s[p]=i,s[p]>0?++d[n]:++d[v],p++}var S=0;for(n=1;n<u;n++)d[n]>d[S]&&(S=n);return t.label[S]},u.svm_predict=function(t,e){var r,n=t.nr_class;return r=2===t.param.svm_type||3===t.param.svm_type||4===t.param.svm_type?o(1,0):o(Math.floor(n*(n-1)/2),0),u.svm_predict_values(t,e,r)},u.svm_predict_probability=function(t,e,r){var n=r;if((0===t.param.svm_type||1===t.param.svm_type)&&null!==t.probA&&null!==t.probB){var i,a=t.nr_class,h=o(Math.floor(a*(a-1)/2),0);u.svm_predict_values(t,e,h);var l=s(a,a,0),c=0;for(i=0;i<a;i++)for(var f=i+1;f<a;f++)l[i][f]=Math.min(Math.max(u.sigmoid_predict(h[c],t.probA[c],t.probB[c]),1e-7),1-1e-7),l[f][i]=1-l[i][f],c++;2===a?(n[0]=l[0][1],n[1]=l[1][0]):u.multiclass_probability(a,l,n);var d=0;for(i=1;i<a;i++)n[i]>n[d]&&(d=i);return t.label[d]}return u.svm_predict(t,e)},u.svm_save_model=function(t){var e="",r=t.param;e+="svm_type ",e+=u.svm_type_table[r.svm_type],e+="\n",e+="kernel_type ",e+=u.kernel_type_table[r.kernel_type],e+="\n",1===r.kernel_type&&(e+="degree ",e+=r.degree,e+="\n"),1!==r.kernel_type&&2!==r.kernel_type&&3!==r.kernel_type||(e+="gamma ",e+=r.gamma,e+="\n"),1!==r.kernel_type&&3!==r.kernel_type||(e+="coef0 ",e+=r.coef0,e+="\n");var n,i=t.nr_class,o=t.l;for(e+="nr_class ",e+=i,e+="\n",e+="total_sv ",e+=o,e+="\n",e+="rho",n=0;n<Math.floor(i*(i-1)/2);n++)e+=" ",e+=t.rho[n];if(e+="\n",null!=t.label){for(e+="label",n=0;n<i;n++)e+=" ",e+=t.label[n];e+="\n"}if(t.probA){for(e+="probA",n=0;n<Math.floor(i*(i-1)/2);n++)e+=" ",e+=t.probA[n];e+="\n"}if(t.probB){for(e+="probB",n=0;n<Math.floor(i*(i-1)/2);n++)e+=" ",e+=t.probB[n];e+="\n"}if(null!=t.nSV){for(e+="nr_sv",n=0;n<i;n++)e+=" ",e+=t.nSV[n];e+="\n"}e+="SV\n";var s=t.sv_coef,a=t.SV;for(n=0;n<o;n++){var h;for(h=0;h<i-1;h++)e+=s[h][n],e+=" ";var l=a[n];if(4===r.kernel_type)e+="0:",e+=Math.round(l[0].value);else for(h=0;h<l.length;h++)e+=l[h].index,e+=":",e+=l[h].value,e+=" ";e+="\n"}return e},u.atof=function(t){return parseFloat(t)},u.atoi=function(t){return parseInt(t,10)},u.read_model_header=function(t,e){var n,i,s=e,a=new r;s.param=a,a.nr_weight=0,a.weight_label=null,a.weight=null;try{for(var h=0;h<t.length;h++){var l=t[h],c=l.substring(l.indexOf(" ")+1),f=c.split(/ |\t|\n|\r|\f/);if(l.startsWith("svm_type")){for(n=0;n<u.svm_type_table.length;n++)if(-1!==c.indexOf(u.svm_type_table[n])){a.svm_type=n;break}if(n===u.svm_type_table.length)return console.error("unknown svm type.\n"),-1}else if(l.startsWith("kernel_type")){for(n=0;n<u.kernel_type_table.length;n++)if(-1!==c.indexOf(u.kernel_type_table[n])){a.kernel_type=n;break}if(n===u.kernel_type_table.length)return console.error("unknown kernel function.\n"),-1}else if(l.startsWith("degree"))a.degree=u.atoi(c);else if(l.startsWith("gamma"))a.gamma=u.atof(c);else if(l.startsWith("coef0"))a.coef0=u.atof(c);else if(l.startsWith("nr_class"))s.nr_class=u.atoi(c);else if(l.startsWith("total_sv"))s.l=u.atoi(c);else if(l.startsWith("rho"))for(i=Math.floor(s.nr_class*(s.nr_class-1)/2),s.rho=o(i,0),n=0;n<i;n++)s.rho[n]=u.atof(f[n]);else if(l.startsWith("label"))for(i=s.nr_class,s.label=o(i,0),n=0;n<i;n++)s.label[n]=u.atoi(f[n]);else if(l.startsWith("probA"))for(i=Math.floor(s.nr_class*(s.nr_class-1)/2),s.probA=o(i,0),n=0;n<i;n++)s.probA[n]=u.atof(f[n]);else if(l.startsWith("probB"))for(i=Math.floor(s.nr_class*(s.nr_class-1)/2),s.probB=o(i,0),n=0;n<i;n++)s.probB[n]=u.atof(f[n]);else{if(!l.startsWith("nr_sv")){if(l.startsWith("SV"))return h;var d="unknown text in model file: [";return d+=l,d+="]\n",console.error(d),-1}for(i=s.nr_class,s.nSV=o(i,0),n=0;n<i;n++)s.nSV[n]=u.atoi(f[n])}}}catch(t){return-1}return-1},u.svm_load_data=function(t){var r=t.split("\n"),i=new n;i.l=r.length,i.x=[],i.y=[];for(var o=0;o<r.length;o++){var s=r[o].split(" "),a=parseInt(s[0],10);i.y[o]=a;for(var u=[],h=1;h<s.length;h++){var l=s[h].split(":"),c=new e;c.index=parseInt(l[0],10),c.value=parseFloat(l[1]),u[h-1]=c}i.x[o]=u}return i},u.svm_load_model=function(r){var n=new t;n.rho=null,n.probA=null,n.probB=null,n.label=null,n.nSV=null;var i=r.split("\n"),o=u.read_model_header(i,n);if(o<0)return console.error("ERROR: failed to read model\n"),null;var a=n.nr_class-1,h=n.l;n.sv_coef=s(a,h,0),n.SV=new Array(h);for(var l=0;l<h;l++){for(var c=i[o+1+l].split(/ |\t|\n|\r|\f|:/),f=0;f<a;f++)n.sv_coef[f][l]=u.atof(c[f]);var d=a,p=Math.floor((c.length-a-1)/2);n.SV[l]=new Array(p);for(var v=0;v<p;v++)n.SV[l][v]=new e,n.SV[l][v].index=u.atoi(c[d]),d++,n.SV[l][v].value=u.atof(c[d]),d++}return n},u.svm_check_parameter=function(t,e){var r=e.svm_type;if(0!==r&&1!==r&&2!==r&&3!==r&&4!==r)return"unknown svm type";var n=e.kernel_type;if(0!==n&&1!==n&&2!==n&&3!==n&&4!==n)return"unknown kernel type";if(e.gamma<0)return"gamma < 0";if(e.degree<0)return"degree of polynomial kernel < 0";if(e.cache_size<=0)return"cache_size <= 0";if(e.eps<=0)return"eps <= 0";if((0===r||3===r||4===r)&&e.C<=0)return"C <= 0";if((1===r||2===r||4===r)&&(e.nu<=0||e.nu>1))return"nu <= 0 or nu > 1";if(3===r&&e.p<0)return"p < 0";if(0!==e.shrinking&&1!==e.shrinking)return"shrinking != 0 and shrinking != 1";if(0!==e.probability&&1!==e.probability)return"probability != 0 and probability != 1";if(1===e.probability&&2===r)return"one-class SVM probability output not supported yet";if(1===r){var i,s=t.l,u=16,h=0,l=o(u,0),c=o(u,0);for(i=0;i<s;i++){var f,d=Math.round(t.y[i]);for(f=0;f<h;f++)if(d===l[f]){++c[f];break}if(f===h){if(h===u){var p=o(u*=2,0);a(l,0,p,0,l.length),l=p,a(c,0,p=o(u,0),0,c.length),c=p}l[h]=d,c[h]=1,++h}}for(var v=0;v<h;v++)for(var _=c[v],g=v+1;g<h;g++){var m=c[g];if(e.nu*(_+m)/2>Math.min(_,m))return"specified nu is infeasible"}}return null},u.svm_check_probability_model=function(t){return(0===t.param.svm_type||1===t.param.svm_type)&&null!==t.probA&&null!==t.probB||(3===t.param.svm_type||4===t.param.svm_type)&&null!==t.probA?1:0},u.decision_function=function(){this.alpha=null,this.rho=0},u.LIBSVM_VERSION=322,u.rand=function(t){return Math.floor(Math.random()*t)},u.svm_type_table=["c_svc","nu_svc","one_class","epsilon_svr","nu_svr"],u.kernel_type_table=["linear","polynomial","rbf","sigmoid","precomputed"],u.getTopIndex=function(t){var e=new Array(1),r=new Array(1);e[0]=0,r[0]=t[0];for(var n=1;n<t.length;n++)for(var i=0;i<e.length;i++)if(t[n]>=r[i]){e.splice(i,0,n),r.splice(i,0,t[n]);break}return e},addEventListener("message",function(t){var e=t.data;if(e.train&&(v=u.svm_train(e.train.problem,e.train.param),postMessage({trainResult:v})),e.predict&&v){var r=u.svm_predict(v,e.predict);postMessage({predictResult:r})}})}})?n.call(null,r,e,t):n)||(t.exports=i)},3489:function(t,e,r){var n=r(406),i=r(549),o=r.dj.c();r(3488),t.exports=n(i,"app/cognitive-es/svm-worker",o)},3492:function(t,e,r){var n,i;n=[r(2),r(0),r(15),r(10),r(3489),r(3487),r(1467),r(3481)],void 0===(i=function(t,e,r,n,i,o,s,a){var u;a=new a;return t([],{folderIdTable:u,cvPart:u,tmpCvPart:u,cvSubject:u,tmpCvSubject:u,cvBody:u,tmpCvBody:u,model:u,beginSub:0,beginBody:0,_outputX:function(t,e){for(var r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++)t[r][n].index+":"+t[r][n].value+" "},_changeEmailToID:function(t){var e="";return t&&(e=t.replace(/[-.@\<\> \/]/g,"_"),e=encodeURI(e).replace(/%/g,"")),e},_trim:function(t){return t.replace(/(^\s*)|(\s*$)/g,"")},_changeEmailsToIDs:function(t){for(var e=t.split(";"),r="",n=0;n<e.length;n++)r+=this._changeEmailToID(this._trim(e[n]))+" ";return r},_convertEmails:function(t){for(var e=0;e<t.length;e++)t[e]=this._changeEmailsToIDs(t[e])},train:function(t,e,n,a){this.folderIds=t;var u=this._buildFolderIdList(t),h=((new Date).getTime(),new o);h.setMaxdf(1e5),h.setMindf(0),h.setStopWords(null),this._convertEmails(e);var l=h.fit_transform(e),c=((new Date).getTime(),h.getVocabulary());(new Date).getTime();var f=new o;f.setMaxdf(1e4),f.setMindf(0);var d=f.fit_transform(n);(new Date).getTime();var p=f.getVocabulary();(new Date).getTime();var v=new o;v.setMaxdf(1e4),v.setMindf(0);var _=v.fit_transform(a);(new Date).getTime(),v.getVocabulary();var g=[];this.beginSub=c.size+100,this.beginBody=this.beginSub+p.size+100;for(var m=0;m<e.length;m++){for(var b=0;b<d[m].length;b++){d[m][b].index+=this.beginSub}if(a.length){for(b=0;b<_[m].length;b++){_[m][b].index+=this.beginBody}g[m]=l[m].concat(d[m]).concat(_[m])}else g[m]=l[m].concat(d[m])}this.tmpCvPart=h,this.tmpCvSubject=f,this.tmpCvBody=v;var y=new s;y.svm_type=0,y.kernel_type=0,y.cache_size=100,y.eps=1e-5,y.C=1,y.probability=1;var w={l:e.length,x:g,y:u};return this._initSvmWorker(),i.postMessage({train:{problem:w,param:y}}),this.trainDfd=new r,this.trainDfd.promise},predict:function(t,e,r){if(this.model){var n,i,o;n=this.cvPart.transform([this._changeEmailsToIDs(t)]),i=this.cvSubject.transform([e]),o=this.cvBody.transform([r]);for(var s=0;s<i[0].length;s++){i[0][s].index+=this.beginSub}for(s=0;s<o[0].length;s++){o[0][s].index+=this.beginBody}var u=[];u[0]=n[0].concat(i[0],o[0]);var h=[];a.svm_predict_probability(this.model,u[0],h);for(var l=a.getTopIndex(h),c=[],f=[],d=0;d<l.length;d++)c.push(this.folderIdTable[l[d]]),f.push(h[l[d]]);return{folderIds:c,probabilities:f}}},_buildFolderIdList:function(t){var e=new Map,r=0,n=[];this.folderIdTable=[];for(var i=0;i<t.length;i++)e.has(t[i])?n.push(e.get(t[i])):(e.set(t[i],r),n.push(r),this.folderIdTable.push(t[i]),r++);return n},saveModel:function(){return JSON.stringify({svm_model:a.svm_save_model(this.model),cvPart:this.cvPart.toString(),cvSubject:this.cvSubject.toString(),cvBody:this.cvBody.toString(),folderIdTable:this.folderIdTable,beginSub:this.beginSub,beginBody:this.beginBody})},loadModel:function(t){var e=JSON.parse(t);return this.cvPart=new o,this.cvPart.loadFromStr(e.cvPart),this.cvSubject=new o,this.cvSubject.loadFromStr(e.cvSubject),this.cvBody=new o,this.cvBody.loadFromStr(e.cvBody),this.model=a.svm_load_model(e.svm_model),this.folderIdTable=e.folderIdTable,this.beginSub=e.beginSub,this.beginBody=e.beginBody,this.model},_initSvmWorker:function(){this.workerInited||(i.postMessage({debug:!0}),n(i,"message",e.hitch(this,function(t){var e=t.data;e.trainResult&&(this.model=e.trainResult,this.cvPart=this.tmpCvPart,this.cvSubject=this.tmpCvSubject,this.cvBody=this.tmpCvBody,this.trainDfd.resolve())})),this.workerInited=!0)},clearData:function(){this.folderIdTable=u,this.cvPart=u,this.tmpCvPart=u,this.cvSubject=u,this.tmpCvSubject=u,this.cvBody=u,this.tmpCvBody=u,this.model=u,this.beginSub=0,this.beginBody=0}})}.apply(null,n))||(t.exports=i)},3493:function(t,e,r){var n,i;n=[r(3492)],void 0===(i=function(t){return new t}.apply(null,n))||(t.exports=i)},3494:function(t,e,r){var n,i;n=[r(2),r(0),r(44),r(1),r(15),r(47),r(92),r(379),r(27),r(10),r(498),r(507),r(663),r(595),r(391),r(268),r(362),r(494),r(66),r(270),r(502),r(602),r(605),r(559),r(499),r(152),r(511),r(521),r(3493),r(1780),r(665),r(515),r(627),r(935),r(580),r(615)],void 0===(i=function(t,e,r,n,i,o,s,a,u,h,l,c,f,d,p,v,_,g,m,b,y,w,x,S,M,D,A,T,O,k,E,C,j,I,N,L){var F=["id","modificationSequence","sequence","sequenceTime","formType","isInTrash","sortdate","excludeFromView"];return t([r],{_nls:N,readingPromise:[],pushingPromise:[],folderInfos:{},_encryptor:null,_trainMailCountInEachFolder:120,_allFolderDocuments:[],_trainModelLoaded:!1,_isTraining:!1,_lastUpdateTime:void 0,_trainAndTestData:void 0,_folderSuggestionEnabled:!1,_initialized:null,_movedMsgCountMap:{},_isWaitingTrain:!1,constructor:function(){this._resetTrainAndTestData(),u.subscribe("start-cognitive-folder-train",e.hitch(this,function(){this._folderSuggestionEnabled=!0,this.triggerTrainUpdate({showSuccessMsg:!0,noDelay:!0})})),u.subscribe("disable-cognitive-folder",e.hitch(this,function(){this.disableCognitiveFolder()})),(n("cal-inbox-delegation")||n("mail-delegation"))&&m()||v&&v.isOfflineMode||(h(p,"message-model-update",e.hitch(this,"_handleMessagesMoved")),h(p,"folder-model-change",e.hitch(this,"_handleFolderDeleted"))),this._initialized=y.getUserProfile("verseProfile","FolderSuggestionEnabled"),this._initialized.then(e.hitch(this,function(t){this._folderSuggestionEnabled="0"!==t}))},isFolderSuggestionEnabled:function(){return this._initialized.then(e.hitch(this,function(){return T.init().then(e.hitch(this,function(){return this._folderSuggestionEnabled&&T.getCustomizedFolderCount()>=5}))}))},_resetTrainAndTestData:function(){this._trainAndTestData={trainFolderIds:[],trainRawSubjects:[],trainRawParts:[],trainRawBodies:[],trainRawAbstracts:[],testDatas:[]}},predict:function(t,e){return this._trainModelLoaded?O.predict(t,e,""):[]},_log:function(t,e){(n("bvt")||n("test-folder-suggestion"))&&(e&&console.error(t,e),!e&&console.log(t))},loadTrainModel:function(){var t=new i;return n("mail-delegation")&&m()?(this._log("************CognitiveFolderController::loadTrainModel -- Do not load svmModel in delegation mode."),t.reject()):this._loadSVMModel().then(e.hitch(this,function(e){e&&O.loadModel(e.value)?(this._trainModelLoaded=!0,this._log("------------Load svm model from local DB succesfully----------"),t.resolve()):(this._log("------------No svm model from local DB found----------"),t.reject())})).otherwise(e.hitch(this,function(e){console.error("************Error to load stored svmModel. %O",e),t.reject(e)})),t.promise},triggerTrainUpdate:function(t){n("mail-delegation")&&m()?this._log("************CognitiveFolderController::triggerTrainUpdate -- Do not load cognitive data in delegation mode."):this._isTraining?this._log("CognitiveFolderControllerClass: training is on processing, return."):this.isFolderSuggestionEnabled().then(e.hitch(this,function(r){if((t&&t.force||!this._lastUpdateTime||!(((new Date).getTime()-this._lastUpdateTime)/864e5<1))&&r){this._trainTerminatePromise=void 0,this._trainPromise=void 0,this.pushingPromise=[],this._isTraining=!0;var n=t&&t.noDelay?0:6e4;setTimeout(e.hitch(this,function(){this._trainTerminatePromise||(this._trainPromise=this._train(t).then(e.hitch(this,function(){t&&t.showSuccessMsg&&b.createBanner({statusText:this._nls.cognitiveFolderTrainDone,classes:"success",actions:"close"}),this._isTraining=!1})).otherwise(e.hitch(this,function(t){console.error("************Error to train model. %O",t),this._getLastUpdateTime().then(e.hitch(this,function(t){if(t){if(((new Date).getTime()-t.value)/864e5>=3)return this._log("************Initialize the local database for exceptions******"),this._trainPromise=this._train({init:!0}),this._trainPromise;this._log("************Update period is less than 3 days, do not initilialize the local database******")}else this._log("************lastUpdateTime is undefined, do not initilialize the local database******")})).otherwise(e.hitch(this,function(){console.error("************Get last update time in train error******")})).always(e.hitch(this,function(){this._isTraining=!1}))})))}),n)}}))},disableCognitiveFolder:function(){if(this._folderSuggestionEnabled=!1,!this._trainPromise||this._trainPromise.isResolved()||this._trainPromise.isRejected())this._log("##### ClearData process triggered #####"),this._trainTerminatePromise=this.clearData();else{this._log("##### ClearData process triggered: There is already a training process running, wait for termination #####");var t=new i;this._trainTerminatePromise=t.promise,this._trainPromise.always(e.hitch(this,function(){this._log("##### ClearData process triggered: Training process is terminated, start ClearData #####"),this.clearData().then(e.hitch(this,function(){t.resolve()})).otherwise(e.hitch(this,function(e){t.reject(e)}))}))}this._trainTerminatePromise.always(e.hitch(this,function(){this._isTraining=!1,this._lastUpdateTime=void 0}))},_train:function(t){var r=new i;return this._log("--- Starting the cognitive folder suggestion module ---"),T.init().then(e.hitch(this,function(){v.getUserContext().then(e.hitch(this,function(){this._trainTerminatePromise?(r.reject(new Error("Train process is terminated by user.")),this._log("##### Stop training (point1): Train process is terminated by user #####")):v.isOfflineMode?this._trainModelLoaded?r.resolve():this._getLastUpdateTime().then(e.hitch(this,function(t){t?this.loadTrainModel().then(e.hitch(this,function(){this._log("------------In offline mode, load svm model from local DB succesfully----------"),r.resolve()})).otherwise(e.hitch(this,function(t){this._log("------------In offline mode, can not load svm model from local DB----------"),this.startTraining().then(e.hitch(this,function(){this._log("------------In offline mode, finish training with stored data ----------"),r.resolve()})).otherwise(e.hitch(this,function(t){this._log("------------In offline mode, CognitiveFolderControllerClass: train error, %O",t),r.reject(t)}))})):(this._log("------------In offline mode, do not have stored data for training."),r.reject(new Error("CognitiveDataError","In offline mode, do not have stored data for training.")))})).otherwise(e.hitch(this,function(t){this._log("------------In offline mode, do not have stored data for training. %O",t),r.reject(t)})):t&&t.init?(this._log("--- init the local database---"),_.deleteDatabase(v.userContext.securityManager.userId+"_Cognitive_Folder").then(e.hitch(this,function(){this._readMessages().then(e.hitch(this,function(){r.resolve()})).otherwise(e.hitch(this,function(t){r.reject(t)}))}))):this._getLastUpdateTime().then(e.hitch(this,function(i){if(i){((new Date).getTime()-i.value)/864e5>=1||!this._trainModelLoaded||t&&t.force?(this._log("--- update the message and re-train---"),this._isWaitingTrain=!1,this.updateLocalFolderDocuments(i.value).then(e.hitch(this,function(){this.startTraining().then(e.hitch(this,function(){r.resolve()})).otherwise(e.hitch(this,function(t){console.error("Train model error, %O",t),r.reject(t)}))})).otherwise(e.hitch(this,function(t){console.error("Update the message and re-train per day, %O",t),r.reject(t)}))):r.resolve()}else{var o=function(){this._isWaitingTrain=!1,this._readMessages().then(e.hitch(this,function(){r.resolve()})).otherwise(e.hitch(this,function(t){r.reject(t)}))}.bind(this);if(n("bvt")||t&&t.noDelay)o();else{var s=18e5*Math.random();setTimeout(o,s)}}})).otherwise(e.hitch(this,function(t){console.error("Get last update time in train error, %O",t),r.reject(t)}))})).otherwise(e.hitch(this,function(t){this._log("CognitiveFolderControllerClass: offlineManager getUserContext in triggerTrainUpdate error, %O",t),r.reject(t)}))})).otherwise(e.hitch(this,function(t){this._log("CognitiveFolderControllerClass: folderController initialize in triggerTrainUpdate error, %O",t),r.reject(t)})),r.promise},_verifyPredictAccuracy:function(){var t=0,r=0,n=0;this._trainAndTestData.testDatas.forEach(e.hitch(this,function(e){if(e){var i=0,o=0,s=0,a=e.testFolderId,u=e.testFolderName,h=e.testMailData;this._log("------- Start to predict "+u+" ----------"),this._log("********** test "+h.length+" mails ************");for(var l=0;l<h.length;l++){var c=O.predict(h[l].testRawPart,h[l].testRawSubject,h[l].testRawBody);c.folderIds[0]==a&&(i++,t++),c.folderIds[0]!=a&&c.folderIds[1]!=a&&c.folderIds[2]!=a||(o++,r++),s++,n++;for(var f=!1,d=0;d<c.folderIds.length;d++)f||(f=c.folderIds[d]===a)}if(s>0){var p=(100*i/s).toFixed(2),v=(100*o/s).toFixed(2);this._log("all test mail count: "+s+", in top 1: "+i+", in top 3: "+o),this._log("Top 1 rate:"+p),this._log("Top 3 rate:"+v)}this._log("------End of folder: "+u+"-----------")}}));var i=(100*t/n).toFixed(2),o=(100*r/n).toFixed(2);this._log("#######  All in test: ##########"),this._log("all test mail count: "+n+", in top 1: "+t+", in top 3: "+r),this._log("Top 1 rate:"+i),this._log("Top 3 rate:"+o),this._log("############### End of cognitive folder prediction #########################")},_getDocumentsForFolder:function(t){var r=this._allFolderDocuments&&this._allFolderDocuments.filter(e.hitch(this,function(e){return e.folderId===t}));return r&&r[0]&&r[0].documents},_collectFolderDocumentInfo:function(t,r){var n=new i;return this._trainTerminatePromise?(this._log("##### Stop training (point2): Train process is terminated by user #####"),n.reject(new Error("Train process is terminated by user."))):t?(this._allFolderDocuments.push({folderId:t.id,folderName:t.name,documents:[]}),this._getStoredDocuments(t.idTables).then(e.hitch(this,function(i){if(this._trainTerminatePromise)n.reject(new Error("Train process is terminated by user.")),this._log("##### Stop training (point3): Train process is terminated by user #####");else{var o=this._getDocumentsForFolder(t.id);i.forEach(e.hitch(this,function(t){var e=void 0;try{var r=t.formType?t:I(t);e=this._handleStoredDocData(r)}catch(r){e=t,this._log("************error to adapt stored data for folder %O",r)}var n=e?e.Subject:"",i=e?e.Participant:"",s=e?e.Body:"",a=e?e.Abstract:"";o.push({rawSubject:n,rawPart:i,rawBody:s,rawAbstract:a})})),n.resolve({index:r})}})).otherwise(e.hitch(this,function(e){this._log("************error to generate training data for folder: "+t.name+", %O",e)})),n.promise):(n.reject(),n.promise)},_isMessagesEnough:function(){for(var t=0,e=T.getCustomizedFolders(),r=0;r<e.length;r++){var n=e[r],i=this._getDocumentsForFolder(n.folderId),o=i?i.length:0;if(this._log("Message count in folder"+n.folderId+": "+o),o>=5&&t++,t>=3)return!0}return this._log("Folder count with enough folder:"+t),!1},startTraining:function(){this._log("------ Start loading stored documents and training -----------");var t=new i;return this._getAllStoredFolders().then(e.hitch(this,function(r){var o=[],s=0;r.length>80&&(this._trainMailCountInEachFolder=60);for(s=0;s<r.length;s++){var a=new i;if(o.push(a),0==s){var u=r[0];this._collectFolderDocumentInfo(u,0).then(e.hitch(this,function(t){o[t.index]&&o[t.index].resolve(t.index)}))}else o[s-1]&&o[s-1].then(e.hitch(this,function(t){t+1<r.length&&this._collectFolderDocumentInfo(r[t+1],t+1).then(e.hitch(this,function(t){o[t.index]&&o[t.index].resolve(t.index)}))}))}o[r.length-1].then(e.hitch(this,function(){this._isMessagesEnough()?(this._generateTrainDataObj(),this._trainTerminatePromise?(t.reject(new Error("Train process is terminated by user.")),this._log("##### Stop training (point4): Train process is terminated by user #####")):this._trainAndTestData.trainRawSubjects.length?O.train(this._trainAndTestData.trainFolderIds,this._trainAndTestData.trainRawParts,this._trainAndTestData.trainRawSubjects,[]).then(e.hitch(this,function(){this._trainTerminatePromise?(t.reject(new Error("Train process is terminated by user.")),this._log("##### Stop training (point5): Train process is terminated by user #####")):(this._log("------------ Train finished -------------"),n("test-folder-suggestion")?(this._trainModelLoaded=!0,this._verifyPredictAccuracy(),t.resolve()):this._saveSVMModel(O.saveModel()).then(e.hitch(this,function(){this._trainModelLoaded=!0,t.resolve(),this._log("------------ Store SVNModel finished -------------")})).otherwise(e.hitch(this,function(e){t.reject(e),this._log("-----------error occurred when Store SVNModel -----------, %O",e)})))})).otherwise(e.hitch(this,function(e){t.reject(e),this._log("-----------error occurred when Train -----------, %O",e)})):(this._log("-------------- No training data collected (no mail in folders)-----------"),t.resolve())):(this._log("-------------- Training data is not enough to enable folder suggestion-----------"),this._trainModelLoaded?(this._trainModelLoaded=!1,O.clearData(),this._deleteSVMModel().then(e.hitch(this,function(){this._log("Delete the existing model in local db succeeds"),t.resolve()})).otherwise(e.hitch(this,function(e){t.reject(e),this._log("CognitiveFolderControllerClass: delete svm model error, %O",e)}))):t.resolve())})).otherwise(e.hitch(this,function(e){t.reject(),this._log("************error to generate training data********************************, %O",e)}))})),t.promise},_isNumInArray:function(t,e){for(var r=0;r<e.length;r++)if(e[r]==t)return!0;return!1},_getRandomNums:function(t,e){for(var r=[];r.length<e;){var n=Math.round(Math.random()*(t-1));this._isNumInArray(n,r)||r.push(n)}return r},_generateTrainDataObj:function(){this._allFolderDocuments&&this._allFolderDocuments.forEach(e.hitch(this,function(t){var r=t.documents,i=r?r.length:0,o=i>this._trainMailCountInEachFolder?this._trainMailCountInEachFolder:i,s=[],a=t.folderId,u=t.folderName,h={};n("test-folder-suggestion")&&(s=this._getRandomNums(o,.3*o),h={testFolderId:a,testFolderName:u,testMailData:[]},this._trainAndTestData.testDatas.push(h));var l=0;r&&r.forEach(e.hitch(this,function(t){l<o&&(n("test-folder-suggestion")&&this._isNumInArray(l,s)?h.testMailData&&h.testMailData.push({testFolderId:a,testFolderName:u,testRawSubject:t.rawSubject,testRawPart:t.rawPart,testRawBody:t.rawBody,testRawAbstracts:t.rawAbstract}):(this._trainAndTestData.trainFolderIds.push(a),this._trainAndTestData.trainRawSubjects.push(t.rawSubject),this._trainAndTestData.trainRawParts.push(t.rawPart),this._trainAndTestData.trainRawBodies.push(t.rawBody),this._trainAndTestData.trainRawAbstracts.push(t.rawAbstract))),l++}))}))},updateLocalFolderDocuments:function(t){this.syncStore=new k;var r={usePost:!0,isInitialSync:!0,since:(new l).setDate(new Date(parseInt(t)),dwa.date.zoneInfo.prototype.oUTC).getISO8601String()};return this.syncStore.getChanges(r).then(e.hitch(this,function(t){if(this._trainTerminatePromise)return this._log("##### Stop training (point6): Train process is terminated by user #####"),(new i).reject(new Error("Train process is terminated by user."));if(t&&t.until&&t.serverId)return this._loadStoredFolderDoc().then(e.hitch(this,"_syncLocalFolders",t)).then(e.hitch(this,"_syncLocalDoc",t)).then(e.hitch(this,"_syncChangesLocalFolder",t)).then(e.hitch(this,"_maintainsStoredData")).then(e.hitch(this,function(){var e=(new l).setISO8601String(t.until).getDate().getTime();return this._setLastUpdateTime(e)}));var r=new Error("Can not validate changes data.");throw r.name="ChangesDataError",r})).otherwise(function(e){if("CancelError"==e.name)return this.updateLocalFolderDocuments(t);throw console.error("************error when updating local folders/documents data********************************, %O",e),e})},_readMessages:function(){var t=new i;delete this.folderInfos,this.folderInfos={},this._log("***************Start to load folders.");var r=T.getFolders().filter(function(t){return!!t.parentFolder});return r.length>80&&(this._trainMailCountInEachFolder=60),this.readingPromise=this._readFolderMsg(r),this.readingPromise.then(e.hitch(this,function(){this._log("************Complete reading folders*******************");var r=(new Date).getTime();o(this.pushingPromise).then(e.hitch(this,function(){this._log("************Complete pushing folders*******************");var n=[];T.getFolders().forEach(e.hitch(this,function(t){t.parentFolder&&(this.folderInfos[t.folderId].sequenceTime=r,n.push(this.folderInfos[t.folderId]))})),this._putFolders(n).then(e.hitch(this,function(){this._setLastUpdateTime(r),this.startTraining().then(e.hitch(this,function(){t.resolve()})).otherwise(e.hitch(this,function(e){t.reject(e),this._log("CognitiveFolderControllerClass: train data in _readMessages error, %O",e)}))})).otherwise(e.hitch(this,function(e){t.reject(e),this._log("CognitiveFolderControllerClass: pushing folders in _readMessages error, %O",e)}))})).otherwise(e.hitch(this,function(e){t.reject(e),this._log("CognitiveFolderControllerClass: pushing data in _readMessages error, %O",e)}))})).otherwise(e.hitch(this,function(e){t.reject(e),this._log("CognitiveFolderControllerClass: reading folders in _readMessages error, %O",e)})),t.promise},_readFolderMsg:function(t){if(t.length>0){var r=t[0];return this.folderInfos[r.folderId]={id:r.folderId,name:r.name,sequence:0,sequenceTime:0,idTables:[]},this._doReadFolderMsg({folderModel:r}).then(e.hitch(this,function(){return this._trainTerminatePromise?(this._log("##### Stop training (point7): Train process is terminated by user #####"),(new i).reject(new Error("Train process is terminated by user."))):(this._log("***************Finish loading folder -- "+r.name),t.splice(0,1),this._readFolderMsg(t))}))}return(new i).resolve()},_doReadFolderMsg:function(t){var r=t.folderModel.folderId,n={start:t.start||0,rows:t.rows||30,softdeletion:0,thread:"0",timezone:this._getTZ(),query:"((folderunid:"+r+"))"};this._log("***************Start loading messages in folder: "+t.folderModel.name+" from position "+n.start);var o=A.get("mailServer")+D.get("mailSearchApiPathPrefix")+"/api/search/searchdocuments";return s.post(o,{data:n,handleAs:"json"}).then(e.hitch(this,function(e){if(this._trainTerminatePromise){this._log("##### Stop training (point8): Train process is terminated by user #####");var r=new i;return this.pushingPromise.push(r.promise),r.reject(new Error("Train process is terminated by user."))}var o=this._pushMessages(e,t.folderModel);if(this.pushingPromise.push(o),e.response.docs.length<30||e.response.docs.length+n.start>=this._trainMailCountInEachFolder){this._log("***************Stop loading messages from folder: "+t.folderModel.name);var s=new i;return s.resolve(!0),s.promise}return t.start=n.start+30,this._log("***************Continue loading messages from folder: "+t.folderModel.name+" from position "+t.start),this._doReadFolderMsg(t)}))},_pushMessages:function(t,r){var n=t&&t.response&&t.response.docs||[];if(n&&n.length>0){var o=new i;return n.forEach(e.hitch(this,function(t){this._adaptDocument(t)})),this.putDocuments(n).then(e.hitch(this,function(){n.forEach(e.hitch(this,function(t){this.folderInfos[r.folderId].idTables.push(t.id)})),o.resolve()})).otherwise(function(t){this._log("CognitiveFolderControllerClass: putDocuments error. %O",t),o.resolve()}),o.promise}return(new i).resolve()},_handleStoredDocData:function(t){if(t){var e=t.unid||t.id,r=t.bodyHtml,n=t.subject,i=t.abstract,o=t.sendto,s=t.copyto,a=t.blindcopyto,u=t.formType?t.from:t.inetfrom||t.inetprincipal||t.from,h="";return n=n instanceof Array?n.join(" "):n,t.formType?u&&u.forEach(function(t){var e=this._getEmailAddress(t);-1===h.indexOf(e)&&(h=h+e+";")},this):h=h+u+";",o&&o.forEach(function(t){var e=this._getEmailAddress(t);-1===h.indexOf(e)&&(h=h+e+";")},this),s&&s.forEach(function(t){var e=this._getEmailAddress(t);-1===h.indexOf(e)&&(h=h+e+";")},this),a&&a.forEach(function(t){var e=this._getEmailAddress(t);-1===h.indexOf(e)&&(h=h+e+";")},this),r&&(r=r.replace(/<\/?[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/\r/g," ").replace(/\n/g," ")),i&&(i=i.replace(/<\/?[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/\r/g," ").replace(/\n/g," ")),{Unid:e,Subject:n,Participant:h,Body:r,Abstract:i}}},_handleDocData:function(t){var e=t.unid,r=t.document.get("BodyHtml"),n=t.document.get("Subject"),i=t.document.get("abstract"),o=t.document.get("SendTo"),s=t.document.get("CopyTo"),a=t.document.get("from"),u="";return n=n instanceof Array?n.join(" "):n,a.forEach(function(t){var e=this._getEmailAddress(t);-1===u.indexOf(e)&&(u=u+e+";")},this),o.forEach(function(t){var e=this._getEmailAddress(t);-1===u.indexOf(e)&&(u=u+e+";")},this),s.forEach(function(t){var e=this._getEmailAddress(t);-1===u.indexOf(e)&&(u=u+e+";")},this),r=r.replace(/<\/?[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/\r/g," ").replace(/\n/g," "),i=i.replace(/<\/?[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/\r/g," ").replace(/\n/g," "),{Unid:e,Subject:n,Participant:u,Body:r,Abstract:i}},_getEmailAddress:function(t){if(!t)return"";var r=e.isArray(t)?t[0]:t,n=r.getInetAddress&&r.getInetAddress().indexOf("@")>0?r.getInetAddress():r.oInetName&&r.oInetName.sAddress&&r.oInetName.sAddress.indexOf("@")>0?r.oInetName.sAddress:r.oPrimName&&r.oPrimName.sAddress&&r.oPrimName.sAddress.indexOf("@")>0?r.oPrimName.sAddress:r.inet&&r.inet.indexOf("@")>0?r.inet:r.notes?r.notes:"";return this._refineEmail(n)},_refineEmail:function(t){if(t){var e=t.match(/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/);if(e)return e[0]}return t},_getDocuments:function(t){var r="";t.unids&&t.unids.length&&(r=t.unids.join(" OR "));var n={softdeletion:0,thread:"0",withunread:"1",timezone:this._getTZ(),query:"((unid:("+r+")))"},i=A.get("mailServer")+D.get("mailSearchApiPathPrefix")+"/api/search/searchdocuments",o=Date.now(),a={data:n,handleAs:"json"},u=s.post(i,a);return u.always(e.hitch(this,function(){var t=Date.now()-o;t>1e4&&this._log("CognitiveFolderController -- Get Documents request took "+t/1e3+" seconds")})),u},_getTZ:function(){var t=a.format(new Date,{datePattern:"ZZZZ",selector:"date"});try{t=Intl.DateTimeFormat().resolvedOptions().timeZone||t}catch(t){}return t},_adaptDocument:function(t){return t.sequence=t.sequence||"1",t.sequenceTime=(new Date).getTime(),t.id=t.unid,t},putDocuments:function(t){var r=t.map(e.hitch(this,function(t){t.bodyHtml="";var e=Object.keys(t);return F.forEach(function(t){var r=e.indexOf(t);-1!=r&&e.splice(r,1)}),v.userContext.securityManager.encryptor.encrypt(t,e)}));return o(r).then(e.hitch(this,function(t){return g.access(v.userContext.securityManager.userId+"_Cognitive_Folder",e.hitch(this,function(e){return this._storeDocuments(e,t)}))}))},_storeDocuments:function(t,e){return e=[].concat(e),_.transaction(t,"documents","readwrite",function(t){e.forEach(function(e){!function(t,e){t.get(e.id).onsuccess=function(r){var n=r.target.result;e.modificationSequence=(n&&n.modificationSequence||0)+1,t.put(e)}}(t,e)})})},_putFolders:function(t){var r=t.map(e.hitch(this,function(t){return v.userContext.securityManager.encryptor.encrypt(t,["name"])}));return o(r).then(e.hitch(this,function(t){return g.access(v.userContext.securityManager.userId+"_Cognitive_Folder",e.hitch(this,function(e){return this._storeFolder(e,t)}))}))},_storeFolder:function(t,e){e=[].concat(e);return _.transaction(t,"designs","readwrite",function(t){e.forEach(function(e){!function(t,e){t.get(e.id).onsuccess=function(r){var n=r.target.result;n&&n.sequence&&(e.sequence=n.sequence+1),e.idTables||(e.idTables=n&&n.idTables?n.idTables:[]),t.put(e)}}(t,e)})})},_setLastUpdateTime:function(t){var r=new i;return g.access(v.userContext.securityManager.userId+"_Cognitive_Folder",e.hitch(this,function(n){return _.transaction(n,"profiles","readwrite",e.hitch(this,function(n){var i=n.get("lastUpdateTime");i.onsuccess=e.hitch(this,function(e){this._lastUpdateTime=t||(new Date).getTime(),n.put({id:"lastUpdateTime",value:this._lastUpdateTime}),r.resolve(this._lastUpdateTime)}),i.onerror=function(t){r.reject(t)}}))})),r.promise},_getLastUpdateTime:function(){var t=new i;return g.access(v.userContext.securityManager.userId+"_Cognitive_Folder",e.hitch(this,function(r){return _.transaction(r,"profiles","readwrite",e.hitch(this,function(r){var n=r.get("lastUpdateTime");n.onsuccess=e.hitch(this,function(e){t.resolve(e.target.result),this._lastUpdateTime=e.target.result&&e.target.result.value?e.target.result.value:void 0}),n.onerror=function(e){t.reject(e)}}))})),t.promise},_getStoredDocuments:function(t,e){if(t&&0===t.length)return(new i).resolve([]);var r=v.userContext.securityManager.encryptor;return g.access(v.userContext.securityManager.userId+"_Cognitive_Folder",function(n){var o,s=[],a=!1;return _.iterate(n,"documents",t||null,function(t){return!a&&(t?(n=r.decrypt(t,e).then(function(t){if(t.formType){var e=w.fromSerializableObject(t);return e.blindcopyto=j.toNameModelArray(e.bcc?e.bcc.getNames():[]),e.copyto=j.toNameModelArray(e.cc?e.cc.getNames():[]),e.sendto=j.toNameModelArray(e.to?e.to.getNames():[]),(new i).resolve(e)}return(new i).resolve(t)})).otherwise(function(t){a=!0}):(o||(o=(new i).resolve(null)),n=o),s.push(n),!0);var n}).then(function(){return s})}).then(function(t){return o(t)})},_getAllStoredFolders:function(t){var e=!1,r=v.userContext.securityManager.encryptor,n=[],i=function(i){if(e)return!1;var o=r.decrypt(i,t);return n.push(o),o.otherwise(function(t){e=!0}),!0};return g.access(v.userContext.securityManager.userId+"_Cognitive_Folder",function(t){return _.iterate(t,"designs",i)}).then(function(){return o(n)})},_loadStoredFolderDoc:function(){var t=new i;return this._allFolderDocumentsData={localFolders:{},folderCount:0,localDocuments:{},docCount:0},this._trainTerminatePromise?(t.reject(new Error("Train process is terminated by user.")),this._log("##### Stop training (point9): Train process is terminated by user #####")):this._getAllStoredFolders().then(e.hitch(this,function(r){r.forEach(e.hitch(this,function(t){this._allFolderDocumentsData.localFolders[t.id]=e.clone(t),this._allFolderDocumentsData.localFolders[t.id].idTables={},t.idTables.forEach(e.hitch(this,function(e){this._allFolderDocumentsData.localFolders[t.id].idTables[e]=!0}))})),this._allFolderDocumentsData.folderCount=r.length,this._getStoredDocuments().then(e.hitch(this,function(r){r.forEach(e.hitch(this,function(t){this._allFolderDocumentsData.localDocuments[t.id]=t})),this._allFolderDocumentsData.docCount=r.length,t.resolve()})).otherwise(function(e){t.reject(e)})})).otherwise(function(e){t.reject(e)}),t.promise},_syncLocalFolders:function(t){var r=t.folders;if(!r.length)return(new i).resolve();var n,s=[];if(this._allFolderDocumentsData.folderCount){var a={},u=this._allFolderDocumentsData.localFolders;for(var h in u){r.some(function(t){return t.unid===h})?a[h]=u[h]:s.push(h)}n=r.map(function(t){return a[t.unid]})}else n=new Array(r.length);var c=r.filter(function(t,e){var r=n[e],i=(new l).setISO8601String(t.sequenceTime).getDate().getTime(),o=T.getFolderModelByFolderId(t.unid);return o&&!!o.parentFolder&&(!r||t.sequence>r.sequence||t.sequence===r.sequence&&i>r.sequenceTime)}),f=[];if(c.length){var d=[];c.forEach(function(t){if(t.hardDeleted)s.push(t.unid);else{var e={id:t.unid,type:"folder",name:t.title,sequence:t.sequence,sequenceTime:t.sequenceTime};d.push(e)}});var p=this._putFolders(d).then(e.hitch(this,function(){return d.forEach(e.hitch(this,function(t){var r,n=this._allFolderDocumentsData.localFolders[t.id];n?r=e.clone(n.idTables):(r={},this._allFolderDocumentsData.folderCount++),this._allFolderDocumentsData.localFolders[t.id]=t,this._allFolderDocumentsData.localFolders[t.id].idTables=r})),(new i).resolve()}));f.push(p)}if(s.length){var v=this._deleteFolders(s).then(e.hitch(this,function(){return s.forEach(e.hitch(this,function(t){this._allFolderDocumentsData.localFolders[t]&&(delete this._allFolderDocumentsData.localFolders[t],this._allFolderDocumentsData.folderCount--)})),(new i).resolve()}));f.push(v)}return o(f)},_syncLocalDoc:function(t){if(!this._validateDocData(t))return(new i).reject(new Error("ChangesDataError","Validate changes data failed"));var r,n=t.documents,s=t.folderChanges,a=this._allFolderDocumentsData.localDocuments,u={},h=[],l=[];if(s.forEach(function(t){if(T.getFolderModelByFolderId(t.unid).parentFolder)for(var e=0;e<t.added.length;e++){var r=t.added[e];u[r]||a[r]||(u[r]=!0,l.push({unid:r}))}}),n.forEach(function(t){t.hardDeleted||t.softDeleted?h.push(t.unid):u[t.unid]||l.push(t)}),!l.length)return(new i).resolve();if(this._allFolderDocumentsData.docCount){var c={};for(var f in a){l.some(function(t){return t.unid===f})&&(c[f]=a[f])}r=l.map(function(t){return c[t.unid]})}else r=new Array(l.length);var d=l.filter(function(t,e){var n=r[e];return n&&(t.modificationSequence=n.modificationSequence),n&&"sequence"in n?(t.sequenceTime=E.getDateFromNotesDate(t.sequenceTime).getTime(),E.compareSequence(t,n)>0):u[t.unid]||!1});d.sort(function(t,e){return e.sequenceTime-t.sequenceTime});var p=[];if(d.length){var v=e.hitch(this,function(){if(this._trainTerminatePromise)return this._log("##### Stop training (point10): Train process is terminated by user #####"),(new i).reject(new Error("Train process is terminated by user."));if(d.length){var t=Math.min(30,d.length),r=[];return d.slice(0,t).forEach(function(t){r.push(t.unid)}),this._getDocuments({unids:r}).then(e.hitch(this,function(r){if(this._trainTerminatePromise)return this._log("##### Stop training (point11): Train process is terminated by user #####"),(new i).reject(new Error("Train process is terminated by user."));var n=r&&r.response&&r.response.docs||[];return n.forEach(e.hitch(this,function(t){this._adaptDocument(t)})),this.putDocuments(n).then(e.hitch(this,function(){return n.forEach(e.hitch(this,function(t){this._allFolderDocumentsData.localDocuments[t.id]||this._allFolderDocumentsData.docCount++,this._allFolderDocumentsData.localDocuments[t.id]=t})),d.splice(0,t),v()}))}))}return(new i).resolve()});p.push(v())}if(h.length){var _=this._deleteDocuments(h).then(e.hitch(this,function(){return h.forEach(e.hitch(this,function(t){this._allFolderDocumentsData.localDocuments[t]&&(delete this._allFolderDocumentsData.localDocuments[t],this._allFolderDocumentsData.docCount--)})),(new i).resolve()}));p.push(_)}return o(p)},_syncChangesLocalFolder:function(t){if(this._trainTerminatePromise)return this._log("##### Stop training (point12): Train process is terminated by user #####"),(new i).reject(new Error("Train process is terminated by user."));var r=t.folderChanges;if(r&&0!==r.length){var n=this._allFolderDocumentsData.localFolders;r.forEach(e.hitch(this,function(t){if(n[t.unid]){var r=n[t.unid];t.added.length&&t.added.forEach(e.hitch(this,function(t){this._allFolderDocumentsData.localDocuments[t]&&(r.idTables[t]=!0)})),(t.removed.length||this.idsDeleted&&this.idsDeleted.length)&&(t.removed.forEach(function(t){r.idTables[t]&&delete r.idTables[t]}),this.idsDeleted&&this.idsDeleted.length&&this.idsDeleted.forEach(function(t){r.idTables[t]&&delete r.idTables[t]}))}})),this.idsDeleted=[];var o=[];for(var s in n){var a={},u=n[s];for(var h in u)if("idTables"===h){var l=[],c=u[h];for(var f in c)l.push(f);a[h]=l}else a[h]=u[h];o.push(a)}return this._putFolders(o)}return(new i).resolve()},_maintainsStoredData:function(){if(this._trainTerminatePromise)return this._log("##### Stop training (point13): Train process is terminated by user #####"),(new i).reject(new Error("Train process is terminated by user."));var t=this._allFolderDocumentsData.localFolders,r=[],n={};for(var o in this._allFolderDocumentsData.folderCount&&this._allFolderDocumentsData.folderCount>80&&(this._trainMailCountInEachFolder=60),t){var s=[],a=t[o];for(var u in a.idTables)s.push(u);if(s.length>this._trainMailCountInEachFolder){var h=e.clone(a);h.idTables=s,r.push(h)}else for(var u in a.idTables)n[u]||(n[u]=!0)}if(this._log("CognitiveFolderController -- "+r.length+" folders have more than "+this._trainMailCountInEachFolder+" messages"),r.length){var l={};r.forEach(e.hitch(this,function(t){for(var e=[],r=t.idTables,i=this._allFolderDocumentsData.localDocuments,o=0;o<r.length;o++){var s=i[r[o]];s&&e.push(s)}e.sort(function(t,e){return e.sequenceTime-t.sequenceTime});var a=[];for(o=0;o<e.length;o++)o<this._trainMailCountInEachFolder?(a.push(e[o].id),n[e[o].id]||(n[e[o].id]=!0)):l[e[o].id]=!0;t.idTables=a}));var c=[];for(var f in l)n[f]||c.push(f);return this._deleteDocuments(c).then(e.hitch(this,function(){return this._putFolders(r).then(e.hitch(this,function(){for(var t=0;t<c.length;t++)delete this._allFolderDocumentsData.localDocuments[c[t]],this._allFolderDocumentsData.docCount--;return(new i).resolve()}))}))}return(new i).resolve()},_deleteFolders:function(t){return 0===t.length?(new i).resolve(0):g.access(v.userContext.securityManager.userId+"_Cognitive_Folder",e.hitch(this,function(e){var r=0;if(e.objectStoreNames.contains("designs")){return _.transaction(e,"designs","readwrite",function(e){t.forEach(function(t){e.openCursor(t).onsuccess=function(e){var n=e.target.result;n&&("folder"!==n.value.type&&console.error("Data type of "+t+" is not folder"),n.delete(),r++)}})}).then(function(){return r})}return g.close(e),r}))},_validateDocData:function(t){t.documents||(t.documents=[]);var e=0,r=!t.documents.some(function(t){return t.unid&&"number"==typeof t.sequence&&t.sequenceTime?(t.noteId&&e++,!1):(this._log("docSummary is incorrect, doc.unid= %s, doc.sequence= %s, doc.sequenceTime= %s",t.unid,t.sequence,t.sequenceTime),!0)});return!(!r||0!=e&&e!=t.documents.length)||(r&&this._log("docSummary is incorrect, noteIdCount= %s, data.documents.length= %s",e,t.documents.length),!1)},_deleteDocuments:function(t){if(!Array.isArray(t))throw new Error("DataError","CognitiveFolderController:deleteDocuments -- can not get deleting ids");return this.idsDeleted=t,0===t.length?(new i).resolve(0):g.access(v.userContext.securityManager.userId+"_Cognitive_Folder",e.hitch(this,function(e){var r=new i;return _.transaction(e,"documents","readwrite",function(e){var n,i;n=e,i=t.length,t.forEach(function(t){n.openCursor(t).onsuccess=function(t){var e=t.target.result;e&&e.delete(),0==--i&&r.resolve()}})}).otherwise(function(t){console.error("Can not adapt model. %O",t),r.reject(t)}),r.promise}))},_saveSVMModel:function(t){var r=new i,n={id:"svmModel",value:t};return v.userContext.securityManager.encryptor.encrypt(n,["value"]).then(e.hitch(this,function(t){g.access(v.userContext.securityManager.userId+"_Cognitive_Folder",e.hitch(this,function(e){return _.transaction(e,"profiles","readwrite",function(e){var n=e.get("svmModel");n.onsuccess=function(n){e.put(t),r.resolve(!0)},n.onerror=function(t){r.reject(t)}})}))})).otherwise(function(t){r.reject(t)}),r.promise},_deleteSVMModel:function(){var t=new i;return g.access(v.userContext.securityManager.userId+"_Cognitive_Folder",e.hitch(this,function(r){return _.transaction(r,"profiles","readwrite",e.hitch(this,function(e){var r=e.delete("svmModel");r.onsuccess=function(e){t.resolve()},r.onerror=function(e){t.reject(e)}}))})),t.promise},_loadSVMModel:function(){var t=new i;return g.access(v.userContext.securityManager.userId+"_Cognitive_Folder",e.hitch(this,function(e){return _.transaction(e,"profiles","readwrite",function(e){var r=e.get("svmModel");r.onsuccess=function(e){e.target.result&&e.target.result._ef_&&e.target.result._iv_?v.userContext.securityManager.encryptor.decrypt(e.target.result,["id","value"]).then(function(e){t.resolve(e)}).otherwise(function(e){t.reject(e)}):t.resolve(e.target.result)},r.onerror=function(e){t.reject(e)}})})),t.promise},clearData:function(){return O.clearData(),v.getUserContext().then(e.hitch(this,function(){return _.deleteDatabase(v.userContext.securityManager.userId+"_Cognitive_Folder")}))},getIndexOfFolderAfterPrediction:function(t,e){if(e){var r,n=[];return t.forEach(function(t){n.push.apply(n,C.getThreadedMessages(t))},this),1==n.length?r=this.predictFolders(n[0]):n.length>1&&(r=this.batchPredictFolders(n)),this.getIndexOfFolderInSuggestion(r,e)}console.error("CognitiveFolderControllerClass.js getIndexOfFolderAfterPrediction: folderId is null")},getIndexOfFolderInSuggestion:function(t,e){if(!t||0==t.length)return 0;for(var r=0;r<t.length;r++)if(t[r].folderId===e)return r+1;return-1},batchPredictFolders:function(t){if(this._trainModelLoaded){var e=[],r=[];t&&t.forEach(function(t){var r=!0;if(t.folderunids.forEach(function(t){var n={folderId:t},i=T.queryFolderModels(n)[0];i&&!/^\(\$[^)]+\)$/.test(i.value)&&(e.push({folderIds:[t],probabilities:[1]}),r=!1)}),r){var i=this._getModelRawData(t),o=this.predict(i.participant,i.subject,i.body);o&&e.push(o),n("bvt")&&this._outputMsgInfoAndSuggestedFoldersInfo({subject:i.subject,participant:i.participant},o)}},this),e=this._calcBatchSuggestions(e);for(var i=0;i<e.length;i++){var o={folderId:e[i]};r.push(T.queryFolderModels(o)[0])}return n("bvt")&&this._outputMsgInfoAndSuggestedFoldersInfo(null,{folderIds:e}),r}},_outputMsgInfoAndSuggestedFoldersInfo:function(t,e,r){t&&this._log("CognitiveFolderControllerClass.js, PredictFolders: subject: "+t.subject+", participant: "+t.participant);for(var n=r||(e.folderIds?e.folderIds.length:0),i=0;i<n;i++){var o=e.folderIds[i];if(o){var s={folderId:o},a=T.queryFolderModels(s)[0];this._log("CognitiveFolderControllerClass.js, Predict folders result: folder: "+(a?a.fullPath:"")+", probability: "+(e.probabilities?e.probabilities[i]:""))}}},predictFolders:function(t){if(this._trainModelLoaded){var e,r=this._getModelRawData(t),i=[];if(r.participant||r.subject||r.body){var o=this.predict(r.participant,r.subject,r.body);e=(e=o&&o.folderIds&&o.folderIds.length?o.folderIds.length:0)>3?3:e;for(var s=0;s<e;s++)if(o.folderIds[s]){var a={folderId:o.folderIds[s]};i.push(T.queryFolderModels(a)[0])}n("bvt")&&this._outputMsgInfoAndSuggestedFoldersInfo({subject:r.subject,participant:r.participant},o,e)}return i}},_calcBatchSuggestions:function(t){var e={},r=[];return t.forEach(function(t){for(var n=0;n<3&&n<t.folderIds.length;n++){var i=t.folderIds[n];e[i]?e[i]+=t.probabilities[n]:(e[i]=t.probabilities[n],r.push(i))}}),r.sort(function(t,r){return e[r]-e[t]}),r.slice(0,3)},_cleanUpDocData:function(t){return t?t.replace(/<\/?[^>]*>/g," ").replace(/&nbsp;/g," "):t},_getModelRawData:function(t){var e=t.get("bodyHtml")||t.abstract,r=this._cleanUpDocData(t.subject),n=this._cleanUpDocData(e),i=t.sendto||t.to,o=t.copyto||t.cc,s=t.from,a=t.blindcopyto||t.bcc,u=[];return t.inetprincipal&&t.inetprincipal.indexOf("@")>0&&u.push(t.inetprincipal),t.inetfrom&&t.inetfrom.indexOf("@")>0&&u.indexOf(t.inetfrom)<0?u.push(t.inetfrom):s&&s instanceof Array&&s.forEach(function(t){var e=this._getEmailAddress(t);u.indexOf(e)<0&&u.push(e)},this),i&&i instanceof Array&&i.forEach(function(t){var e=this._getEmailAddress(t);u.indexOf(e)<0&&u.push(e)},this),o&&o instanceof Array&&o.forEach(function(t){var e=this._getEmailAddress(t);u.indexOf(e)<0&&u.push(e)},this),a&&a.forEach(function(t){var e=this._getEmailAddress(t);u.indexOf(e)<0&&u.push(e)},this),{subject:r,participant:u.join(";"),body:n}},_updateMovedMsgCountMap:function(t,e){this._movedMsgCountMap[t]?this._movedMsgCountMap[t]=this._movedMsgCountMap[t]+e:this._movedMsgCountMap[t]=e},_checkIfForceTrain:function(){return!!this._movedMsgCountMap&&Object.keys(this._movedMsgCountMap).some(e.hitch(this,function(t){return this._movedMsgCountMap[t]>=5}))},_triggerTrain:function(){this._movedMsgCountMap={},this._isWaitingTrain=!0,setTimeout(e.hitch(this,function(){this.triggerTrainUpdate({force:!0,noDelay:!0})}),36e5)},_handleFolderDeleted:function(t,e){t&&"delete"===t.changeType&&(this._isWaitingTrain?this._log("A new train is waiting in the queue, ignore this action"):e||this._isWaitingTrain||(this._log("Trigger a new train when there is any folder deleted"),this._triggerTrain()))},_isInboxOrJunk:function(t){if(!t)return!1;var e=T.getFolderModelByFolderValue("($Inbox)");if(e&&t===e.folderId)return!0;var r=T.getFolderModelByFolderValue("($JunkMail)");return!(!r||t!==r.folderId)},_handleMessagesMoved:function(t,e){if(t&&("isInTrash"===t.name||"add-move-folder"===t.name||"remove-folder"===t.name))if(this._isWaitingTrain)this._log("A new train is waiting in the queue, ignore this action");else{var r=[].concat(t.unids);switch(t.name){case"isInTrash":for(var n=[],i=0;i<r.length;i++){var o=C.getMessageModel(r[i]);o&&n.push(o)}if(!n.length)return;for(i=0;i<n.length;i++)for(var s=n[i].folderunids?n[i].folderunids.length:0,a=0;a<s;a++)this._isInboxOrJunk(n[i].folderunids[a])||this._updateMovedMsgCountMap(n[i].folderunids[a],1);break;case"add-move-folder":t.oldValue&&!this._isInboxOrJunk(t.oldValue)&&this._updateMovedMsgCountMap(t.oldValue,r.length),t.newValue&&!this._isInboxOrJunk(t.newValue)&&this._updateMovedMsgCountMap(t.newValue,r.length);break;case"remove-folder":t.newValue&&!this._isInboxOrJunk(t.newValue)&&this._updateMovedMsgCountMap(t.newValue,r.length)}L.isTorn()?this._log("Tear off window do not trigger train"):e||this._isWaitingTrain||!this._checkIfForceTrain()||(this._log("Trigger a new train one hour later when there are at least 5 messages removed from or added to any personal folder"),this._triggerTrain())}}})}.apply(null,n))||(t.exports=i)},3495:function(t,e,r){var n,i;n=[r(3494)],void 0===(i=function(t){return new t}.apply(null,n))||(t.exports=i)},3496:function(t,e){t.exports='/* © Copyright HCL Technologies Ltd. 2018 */\n!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=91)}([function(t,e,r){var n=r(29),o=r(7),i=r(85),a=r(14),c=r(26),u=r(6),s=Object.prototype.hasOwnProperty,f=i(function(t,e){if(c(e)||a(e))o(e,u(e),t);else for(var r in e)s.call(e,r)&&n(t,r,e[r])});t.exports=f},function(t,e){var r=Array.isArray;t.exports=r},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,r){var n=r(87),o="object"==typeof self&&self&&self.Object===Object&&self,i=n||o||Function("return this")();t.exports=i},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,r){var n=r(33),o=r(64),i=r(104),a=r(10),c=r(7),u=r(100),s=r(56),f=r(60),p=s(function(t,e){var r={};if(null==t)return r;var s=!1;e=n(e,function(e){return e=a(e,t),s||(s=e.length>1),e}),c(t,f(t),r),s&&(r=o(r,7,u));for(var p=e.length;p--;)i(r,e[p]);return r});t.exports=p},function(t,e,r){var n=r(81),o=r(183),i=r(14);t.exports=function(t){return i(t)?n(t):o(t)}},function(t,e,r){var n=r(29),o=r(28);t.exports=function(t,e,r,i){var a=!r;r||(r={});for(var c=-1,u=e.length;++c<u;){var s=e[c],f=i?i(r[s],t[s],s,r,t):void 0;void 0===f&&(f=t[s]),a?o(r,s,f):n(r,s,f)}return r}},function(t,e,r){var n=r(199),o=r(193);t.exports=function(t,e){var r=o(t,e);return n(r)?r:void 0}},function(t,e,r){var n=r(34),o=1/0;t.exports=function(t){if("string"==typeof t||n(t))return t;var e=t+"";return"0"==e&&1/t==-o?"-0":e}},function(t,e,r){var n=r(1),o=r(35),i=r(140),a=r(137);t.exports=function(t,e){return n(t)?t:o(t,e)?[t]:i(a(t))}},function(t,e,r){var n=r(3).Symbol;t.exports=n},function(t,e,r){var n=r(11),o=r(197),i=r(196),a="[object Null]",c="[object Undefined]",u=n?n.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?c:a:u&&u in Object(t)?o(t):i(t)}},function(t,e,r){var n=r(39);t.exports=function(t,e){return n(t,e)}},function(t,e,r){var n=r(48),o=r(46);t.exports=function(t){return null!=t&&o(t.length)&&!n(t)}},function(t,e){t.exports=function(t,e){return t===e||t!=t&&e!=e}},function(t,e,r){var n=r(81),o=r(118),i=r(14);t.exports=function(t){return i(t)?n(t,!0):o(t)}},function(t,e,r){var n=r(10),o=r(9);t.exports=function(t,e){for(var r=0,i=(e=n(e,t)).length;null!=t&&r<i;)t=t[o(e[r++])];return r&&r==i?t:void 0}},function(t,e,r){var n=r(146),o=r(41),i=r(145),a=r(71),c=r(144),u=r(12),s=r(86),f=s(n),p=s(o),l=s(i),v=s(a),d=s(c),h=u;(n&&"[object DataView]"!=h(new n(new ArrayBuffer(1)))||o&&"[object Map]"!=h(new o)||i&&"[object Promise]"!=h(i.resolve())||a&&"[object Set]"!=h(new a)||c&&"[object WeakMap]"!=h(new c))&&(h=function(t){var e=u(t),r="[object Object]"==e?t.constructor:void 0,n=r?s(r):"";if(n)switch(n){case f:return"[object DataView]";case p:return"[object Map]";case l:return"[object Promise]";case v:return"[object Set]";case d:return"[object WeakMap]"}return e}),t.exports=h},function(t,e,r){var n=r(158);t.exports=function(t,e){var r=t.__data__;return n(e)?r["string"==typeof e?"string":"hash"]:r.map}},function(t,e,r){var n=r(8)(Object,"create");t.exports=n},function(t,e,r){var n=r(15);t.exports=function(t,e){for(var r=t.length;r--;)if(n(t[r][0],e))return r;return-1}},function(t,e,r){var n=r(176),o=r(175),i=r(174),a=r(173),c=r(172);function u(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}u.prototype.clear=n,u.prototype.delete=o,u.prototype.get=i,u.prototype.has=a,u.prototype.set=c,t.exports=u},function(t,e,r){var n=r(22),o=r(171),i=r(170),a=r(169),c=r(168),u=r(167);function s(t){var e=this.__data__=new n(t);this.size=e.size}s.prototype.clear=o,s.prototype.delete=i,s.prototype.get=a,s.prototype.has=c,s.prototype.set=u,t.exports=s},function(t,e,r){(function(t){var n=r(3),o=r(185),i="object"==typeof e&&e&&!e.nodeType&&e,a=i&&"object"==typeof t&&t&&!t.nodeType&&t,c=a&&a.exports===i?n.Buffer:void 0,u=(c?c.isBuffer:void 0)||o;t.exports=u}).call(this,r(45)(t))},function(t,e,r){var n=r(186),o=r(4),i=Object.prototype,a=i.hasOwnProperty,c=i.propertyIsEnumerable,u=n(function(){return arguments}())?n:function(t){return o(t)&&a.call(t,"callee")&&!c.call(t,"callee")};t.exports=u},function(t,e){var r=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||r)}},function(t,e){var r=9007199254740991,n=/^(?:0|[1-9]\\d*)$/;t.exports=function(t,e){var o=typeof t;return!!(e=null==e?r:e)&&("number"==o||"symbol"!=o&&n.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e,r){var n=r(88);t.exports=function(t,e,r){"__proto__"==e&&n?n(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}},function(t,e,r){var n=r(28),o=r(15),i=Object.prototype.hasOwnProperty;t.exports=function(t,e,r){var a=t[e];i.call(t,e)&&o(a,r)&&(void 0!==r||e in t)||n(t,e,r)}},function(t,e,r){var n=r(98),o=r(6);t.exports=function(t){return null==t?[]:n(t,o(t))}},function(t,e,r){var n=r(75);t.exports=function(t){var e=new t.constructor(t.byteLength);return new n(e).set(new n(t)),e}},function(t,e,r){var n=r(80)(Object.getPrototypeOf,Object);t.exports=n},function(t,e){t.exports=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}},function(t,e,r){var n=r(12),o=r(4),i="[object Symbol]";t.exports=function(t){return"symbol"==typeof t||o(t)&&n(t)==i}},function(t,e,r){var n=r(1),o=r(34),i=/\\.|\\[(?:[^[\\]]*|(["\'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,a=/^\\w*$/;t.exports=function(t,e){if(n(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!o(t))||a.test(t)||!i.test(t)||null!=e&&t in Object(e)}},function(t,e,r){var n=r(147),o=r(72),i=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,c=a?function(t){return null==t?[]:(t=Object(t),n(a(t),function(e){return i.call(t,e)}))}:o;t.exports=c},function(t,e){t.exports=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}},function(t,e){t.exports=function(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}},function(t,e,r){var n=r(154),o=r(4);t.exports=function t(e,r,i,a,c){return e===r||(null==e||null==r||!o(e)&&!o(r)?e!=e&&r!=r:n(e,r,i,a,t,c))}},function(t,e,r){var n=r(166),o=r(159),i=r(157),a=r(156),c=r(155);function u(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}u.prototype.clear=n,u.prototype.delete=o,u.prototype.get=i,u.prototype.has=a,u.prototype.set=c,t.exports=u},function(t,e,r){var n=r(8)(r(3),"Map");t.exports=n},function(t,e,r){(function(t){var n=r(87),o="object"==typeof e&&e&&!e.nodeType&&e,i=o&&"object"==typeof t&&t&&!t.nodeType&&t,a=i&&i.exports===o&&n.process,c=function(){try{var t=i&&i.require&&i.require("util").types;return t||a&&a.binding&&a.binding("util")}catch(t){}}();t.exports=c}).call(this,r(45)(t))},function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,r){var n=r(184),o=r(43),i=r(42),a=i&&i.isTypedArray,c=a?o(a):n;t.exports=c},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){var r=9007199254740991;t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}},function(t,e){t.exports=function(t){return t}},function(t,e,r){var n=r(12),o=r(2),i="[object AsyncFunction]",a="[object Function]",c="[object GeneratorFunction]",u="[object Proxy]";t.exports=function(t){if(!o(t))return!1;var e=n(t);return e==a||e==c||e==i||e==u}},function(t,e){t.exports=function(){var t={nodesById:{},edgesBySource:{},relate:function(e,r,n){if(e!==r){t.addNode(e),t.addNode(r);var o=t.getEdge(e,r);o?o.metadata.strength+=n||1:t.addEdge(e,r,n)}},addNode:function(e){t.nodesById[e]||(t.nodesById[e]={id:e,label:e,type:"person"},t.edgesBySource[e]={})},addEdge:function(e,r,n){t.getEdge(e,r)||((t.edgesBySource[e]=t.edgesBySource[e]||{})[r]={source:e,target:r,directed:!0,metadata:{strength:n||1}})},getEdge:function(e,r){return t.edgesBySource[e]&&t.edgesBySource[e][r]},convertToUndirected:function(){var e=t.getUndirectedEdgesBySource(!0),r=Object.assign({},t);return r.edgesBySource=e,r},getUndirectedEdgesBySource:function(){var e={};return Object.keys(t.edgesBySource).forEach(function(r){Object.keys(t.edgesBySource[r]).forEach(function(n){var o=t.edgesBySource[r][n],i=t.edgesBySource[n][r],a=i&&i.metadata.strength||0,c={source:r,target:n,directed:!1,metadata:{strength:(o.metadata.strength+a)/2}},u={source:n,target:r,directed:!1,metadata:{strength:(o.metadata.strength+a)/2}};e[r]=e[r]||{},e[r][n]=c,e[n]=e[n]||{},e[n][r]=u})}),e},getEdgesBySource:function(){return t.edgesBySource},toGraphJSON:function(e){var r={},n=[],o=[];return Object.keys(t.nodesById).forEach(function(e){n.push(t.nodesById[e])}),Object.keys(t.edgesBySource).forEach(function(r){Object.keys(t.edgesBySource[r]).forEach(function(n){var i=t.edgesBySource[r][n];(i.metadata.strength>1||!e)&&o.push(i)})}),r.nodes=n,r.edges=o,r},reset:function(){t.nodesById={},t.edgesBySource={}},destroy:function(){t.reset(),Object.keys(t).forEach(function(e){t[e]=null})}};return t}},function(t,e,r){var n=r(64),o=1,i=4;t.exports=function(t){return n(t,o|i)}},function(t,e,r){var n=r(66);t.exports=function(t){return t&&t.length?n(t):[]}},function(t,e,r){var n=r(67),o=r(84),i=r(66),a=r(65),c=o(function(t){return i(n(t,1,a,!0))});t.exports=c},function(t,e,r){var n=r(28),o=r(181),i=r(179);t.exports=function(t,e){var r={};return e=i(e,3),o(t,function(t,o,i){n(r,o,e(t,o,i))}),r}},function(t,e){t.exports=function(t,e){if("__proto__"!=e)return t[e]}},function(t,e,r){var n=r(28),o=r(15);t.exports=function(t,e,r){(void 0===r||o(t[e],r))&&(void 0!==r||e in t)||n(t,e,r)}},function(t,e,r){var n=r(99),o=r(83),i=r(82);t.exports=function(t){return i(o(t,void 0,n),t+"")}},function(t,e,r){var n=r(12),o=r(32),i=r(4),a="[object Object]",c=Function.prototype,u=Object.prototype,s=c.toString,f=u.hasOwnProperty,p=s.call(Object);t.exports=function(t){if(!i(t)||n(t)!=a)return!1;var e=o(t);if(null===e)return!0;var r=f.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&s.call(r)==p}},function(t,e,r){var n=r(109),o=r(32),i=r(26);t.exports=function(t){return"function"!=typeof t.constructor||i(t)?{}:n(o(t))}},function(t,e,r){var n=r(31);t.exports=function(t,e){var r=e?n(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}},function(t,e,r){var n=r(73),o=r(61),i=r(16);t.exports=function(t){return n(t,i,o)}},function(t,e,r){var n=r(37),o=r(32),i=r(36),a=r(72),c=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)n(e,i(t)),t=o(t);return e}:a;t.exports=c},function(t,e){t.exports=function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}},function(t,e,r){(function(t){var n=r(3),o="object"==typeof e&&e&&!e.nodeType&&e,i=o&&"object"==typeof t&&t&&!t.nodeType&&t,a=i&&i.exports===o?n.Buffer:void 0,c=a?a.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var r=t.length,n=c?c(r):new t.constructor(r);return t.copy(n),n}}).call(this,r(45)(t))},function(t,e,r){var n=r(23),o=r(121),i=r(29),a=r(120),c=r(119),u=r(63),s=r(62),f=r(116),p=r(115),l=r(74),v=r(60),d=r(18),h=r(114),g=r(113),y=r(58),b=r(1),_=r(24),x=r(108),m=r(2),j=r(106),O=r(6),S=1,w=2,E=4,L="[object Arguments]",N="[object Function]",T="[object GeneratorFunction]",A="[object Object]",I={};I[L]=I["[object Array]"]=I["[object ArrayBuffer]"]=I["[object DataView]"]=I["[object Boolean]"]=I["[object Date]"]=I["[object Float32Array]"]=I["[object Float64Array]"]=I["[object Int8Array]"]=I["[object Int16Array]"]=I["[object Int32Array]"]=I["[object Map]"]=I["[object Number]"]=I[A]=I["[object RegExp]"]=I["[object Set]"]=I["[object String]"]=I["[object Symbol]"]=I["[object Uint8Array]"]=I["[object Uint8ClampedArray]"]=I["[object Uint16Array]"]=I["[object Uint32Array]"]=!0,I["[object Error]"]=I[N]=I["[object WeakMap]"]=!1,t.exports=function t(e,r,B,M,k,P){var U,R=r&S,D=r&w,z=r&E;if(B&&(U=k?B(e,M,k,P):B(e)),void 0!==U)return U;if(!m(e))return e;var C=b(e);if(C){if(U=h(e),!R)return s(e,U)}else{var F=d(e),G=F==N||F==T;if(_(e))return u(e,R);if(F==A||F==L||G&&!k){if(U=D||G?{}:y(e),!R)return D?p(e,c(U,e)):f(e,a(U,e))}else{if(!I[F])return k?e:{};U=g(e,F,R)}}P||(P=new n);var q=P.get(e);if(q)return q;if(P.set(e,U),j(e))return e.forEach(function(n){U.add(t(n,r,B,n,e,P))}),U;if(x(e))return e.forEach(function(n,o){U.set(o,t(n,r,B,o,e,P))}),U;var V=z?D?v:l:D?keysIn:O,H=C?void 0:V(e);return o(H||e,function(n,o){H&&(n=e[o=n]),i(U,o,t(n,r,B,o,e,P))}),U}},function(t,e,r){var n=r(14),o=r(4);t.exports=function(t){return o(t)&&n(t)}},function(t,e,r){var n=r(77),o=r(129),i=r(124),a=r(76),c=r(123),u=r(38),s=200;t.exports=function(t,e,r){var f=-1,p=o,l=t.length,v=!0,d=[],h=d;if(r)v=!1,p=i;else if(l>=s){var g=e?null:c(t);if(g)return u(g);v=!1,p=a,h=new n}else h=e?[]:d;t:for(;++f<l;){var y=t[f],b=e?e(y):y;if(y=r||0!==y?y:0,v&&b==b){for(var _=h.length;_--;)if(h[_]===b)continue t;e&&h.push(b),d.push(y)}else p(h,b,r)||(h!==d&&h.push(b),d.push(y))}return d}},function(t,e,r){var n=r(37),o=r(130);t.exports=function t(e,r,i,a,c){var u=-1,s=e.length;for(i||(i=o),c||(c=[]);++u<s;){var f=e[u];r>0&&i(f)?r>1?t(f,r-1,i,a,c):n(c,f):a||(c[c.length]=f)}return c}},function(t,e,r){var n=r(135),o=r(134);t.exports=function(t,e){return null!=t&&o(t,e,n)}},function(t,e){t.exports=function(t,e){return function(r){return null!=r&&r[t]===e&&(void 0!==e||t in Object(r))}}},function(t,e,r){var n=r(2);t.exports=function(t){return t==t&&!n(t)}},function(t,e,r){var n=r(8)(r(3),"Set");t.exports=n},function(t,e){t.exports=function(){return[]}},function(t,e,r){var n=r(37),o=r(1);t.exports=function(t,e,r){var i=e(t);return o(t)?i:n(i,r(t))}},function(t,e,r){var n=r(73),o=r(36),i=r(6);t.exports=function(t){return n(t,i,o)}},function(t,e,r){var n=r(3).Uint8Array;t.exports=n},function(t,e){t.exports=function(t,e){return t.has(e)}},function(t,e,r){var n=r(40),o=r(153),i=r(152);function a(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new n;++e<r;)this.add(t[e])}a.prototype.add=a.prototype.push=o,a.prototype.has=i,t.exports=a},function(t,e,r){var n=r(77),o=r(151),i=r(76),a=1,c=2;t.exports=function(t,e,r,u,s,f){var p=r&a,l=t.length,v=e.length;if(l!=v&&!(p&&v>l))return!1;var d=f.get(t);if(d&&f.get(e))return d==e;var h=-1,g=!0,y=r&c?new n:void 0;for(f.set(t,e),f.set(e,t);++h<l;){var b=t[h],_=e[h];if(u)var x=p?u(_,b,h,e,t,f):u(b,_,h,t,e,f);if(void 0!==x){if(x)continue;g=!1;break}if(y){if(!o(e,function(t,e){if(!i(y,e)&&(b===t||s(b,t,r,u,f)))return y.push(e)})){g=!1;break}}else if(b!==_&&!s(b,_,r,u,f)){g=!1;break}}return f.delete(t),f.delete(e),g}},function(t,e,r){var n=r(180)();t.exports=n},function(t,e){t.exports=function(t,e){return function(r){return t(e(r))}}},function(t,e,r){var n=r(187),o=r(25),i=r(1),a=r(24),c=r(27),u=r(44),s=Object.prototype.hasOwnProperty;t.exports=function(t,e){var r=i(t),f=!r&&o(t),p=!r&&!f&&a(t),l=!r&&!f&&!p&&u(t),v=r||f||p||l,d=v?n(t.length,String):[],h=d.length;for(var g in t)!e&&!s.call(t,g)||v&&("length"==g||p&&("offset"==g||"parent"==g)||l&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||c(g,h))||d.push(g);return d}},function(t,e,r){var n=r(191),o=r(189)(n);t.exports=o},function(t,e,r){var n=r(192),o=Math.max;t.exports=function(t,e,r){return e=o(void 0===e?t.length-1:e,0),function(){for(var i=arguments,a=-1,c=o(i.length-e,0),u=Array(c);++a<c;)u[a]=i[e+a];a=-1;for(var s=Array(e+1);++a<e;)s[a]=i[a];return s[e]=r(u),n(t,this,s)}}},function(t,e,r){var n=r(47),o=r(83),i=r(82);t.exports=function(t,e){return i(o(t,e,n),t+"")}},function(t,e,r){var n=r(84),o=r(188);t.exports=function(t){return n(function(e,r){var n=-1,i=r.length,a=i>1?r[i-1]:void 0,c=i>2?r[2]:void 0;for(a=t.length>3&&"function"==typeof a?(i--,a):void 0,c&&o(r[0],r[1],c)&&(a=i<3?void 0:a,i=1),e=Object(e);++n<i;){var u=r[n];u&&t(e,u,n,a)}return e})}},function(t,e){var r=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return r.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,e,r){(function(e){var r="object"==typeof e&&e&&e.Object===Object&&e;t.exports=r}).call(this,r(198))},function(t,e,r){var n=r(8),o=function(){try{var t=n(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=o},function(t,e,r){var n=r(94),o=r(56)(function(t,e){return null==t?{}:n(t,e)});t.exports=o},function(t,e,r){var n=r(97),o=r(85)(function(t,e,r,o){n(t,e,r,o)});t.exports=o},function(t,e,r){"use strict";r.r(e);var n=r(0),o=r.n(n),i=r(53),a=r.n(i),c=r(13),u=r.n(c),s=r(52),f=r.n(s),p=r(5),l=r.n(p),v=r(30),d=r.n(v),h=r(51),g=r.n(h),y=r(50),b=r.n(y),_={STORE_VERSION_NUMBER:1,STORE_TEMPLATE:Object.freeze({VERSION:1,reducedThreadsById:{},newestMessageDate:0,namesByNotesOrInet:{},solrNames:{},botsList:{},mailingLists:{},exonerated:{},cachedGraph:{}}),SOLR_NAME_NOT_LOOKED_UP:"tbd",INITIATOR_BONUS:3,DEFAULT_SENT_WEIGHT:6,MINIMUM_NUMBER_OF_THREADS:50,NUM_DAYS_MAIL_TO_LOAD:14,NUM_MS_TO_GRAPH:12096e5,MAX_NAME_BATCH:50,MAX_BOT_BATCH:20,MAX_LIST_BATCH:50,LOOKUP_TYPES:{BOT:"bot",LIST:"list"},ENDPOINT_DELAYS:{domino:6e5}};var x=b()(_.STORE_TEMPLATE);function m(t,e){var r=t;r||(r={id:e.tua0,maildate:e.maildate,participants:[],recipients:[]});var n=(e.inetprincipal||e.principal||e.inetfrom).toLowerCase();r.participants=f()(r.participants,[n]),r.initiator||e.unid!==r.id||(r.initiator=n);var o=e.sinetsendto||e.sendto||[];return o=(o=o.concat(e.sinetcopyto||e.copyto||[])).concat(e.sinetblindcopyto||e.blindcopyto||[]),r.recipients=f()(r.recipients,o).map(function(t){return t.toLowerCase()}),r}function j(t){var e=!1,r=Object.keys(x);if(t.VERSION!==x.VERSION)e=t.VERSION>x.VERSION?"newer version":t.VERSION<x.VERSION?"older version":"corrupt";else if(Object.keys(t).length<r.length)e="corrupt";else for(var n=0;n<r.length;n++)if(!t[r[n]]){e="corrupt";break}return e}var O={isInvalidStore:j,getSerializedStore:function(){return JSON.stringify(x)},get:function(t){if(!t||"string"!=typeof t&&"string"!=typeof t.key)throw new Error("get: invalid params");return x[t.key||t]},setStore:function(t){if(!t||"string"!=typeof t.newStore)throw new Error("setStore: invalid params");var e=JSON.parse(t.newStore),r=j(e);if(t&&t.newStore&&r)throw new Error(r);x=e},set:function(t){if(!t||"string"!=typeof t.key)throw new Error("set: invalid params");var e,r,n;x=o()({},x,(e={},r=t.key,n=t.value,r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e))},_clearStore:function(){x=b()(_.STORE_TEMPLATE)},putThreads:function(t){if(!t||!t.threads)throw new Error("putThreads: invalid params");var e=o()({},x);return t.threads.forEach(function(r){var n;if(t.replace||(n=e.reducedThreadsById[r.id]),void 0!==r.id&&r.docs.length>0){var o=r.docs.reduce(m,n);o.maildate=r.maildate,o.participants.concat(o.recipients).forEach(function(t){t in e.solrNames||(e.solrNames[t]=_.SOLR_NAME_NOT_LOOKED_UP)}),e.reducedThreadsById[r.id]=o,r.maildate&&(e.newestMessageDate=Math.max(r.maildate,e.newestMessageDate))}}),x=e,t.threads.length},threadSelector:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.filterTimestamp;function r(t){return t in x.solrNames&&!0!==x.solrNames[t]?x.solrNames[t]:t}var n=t.filterPeople||{};function i(t){return!(!t||t===_.SOLR_NAME_NOT_LOOKED_UP||t in x.mailingLists||t in x.botsList||t in n)}return d()(x.reducedThreadsById).map(function(t){var e=o()({},t,{recipients:g()(t.recipients.map(r)),participants:g()(t.participants.map(r))}),n=e.participants.filter(i),a=e.recipients.filter(i);return o()({},e,{participants:n,recipients:a,initiator:r(e.initiator)})}).filter(function(t){return i(t.initiator)&&t.participants.length>0&&t.recipients.length>0&&(!e||t.maildate>e)})},getInitiatorlessThreadIds:function(){return Object.keys(x.reducedThreadsById).filter(function(t){return!x.reducedThreadsById[t].initiator})},getNamesToLookUp:function(){return Object.keys(x.solrNames).filter(function(t){return x.solrNames[t]===_.SOLR_NAME_NOT_LOOKED_UP})},putSolrNames:function(t){if(!t||!t.solrNames)throw new Error("setNames: invalid params");var e=o()({},x);Object.keys(t.solrNames).forEach(function(r){var n=t.solrNames[r],o=n.inet&&n.inet.toLowerCase()||n.notes;o?(e.namesByNotesOrInet[o]=n,e.solrNames[r]=o):e.solrNames[r]=!0}),u()(e,x)||(x=e)},putBotNames:function(t){if(!t||!t.guiltyBots)throw new Error("putBotNames: invalid params");var e=o()({},x,{botsList:l()(o()({},t.guiltyBots,x.botsList),Object.keys(t.exonerated)),mailingLists:l()(x.mailingLists,Object.keys(t.exonerated)),exonerated:o()({},t.exonerated,x.exonerated)});u()(e,x)||(x=e)},putMailingListNames:function(t){if(!t||!t.guiltyLists)throw new Error("putMailingListNames: invalid params");var e=o()({},x,{mailingLists:l()(o()({},t.guiltyLists,x.mailingLists),Object.keys(t.exonerated)),botsList:l()(x.botsList,Object.keys(t.exonerated)),exonerated:o()({},t.exonerated,x.exonerated)});u()(e,x)||(x=e)},getStoreStats:function(){return{numThreads:Object.keys(x.reducedThreadsById).length,numNames:Object.keys(x.namesByNotesOrInet).length,numBots:Object.keys(x.botsList).length,numLists:Object.keys(x.mailingLists).length,numNodes:Object.keys(x.cachedGraph).length}},pruneOldThreads:function(t){var e=t.maildate||t;if(0!==e){if(!e||"number"!=typeof e)throw new Error("pruneOldThreads: invalid params");var r=o()({},x,{reducedThreadsById:{},solrNames:{},namesByNotesOrInet:{},botsList:{},mailingLists:{},exonerated:{}}),n={};Object.keys(x.reducedThreadsById).forEach(function(t){var n=x.reducedThreadsById[t];n.maildate>e&&(r.reducedThreadsById[t]=n,n.participants.concat(n.recipients).forEach(i))}),r.solrNames=n,Object.keys(n).forEach(function(t){var e=n[t];"string"==typeof e&&e!==_.SOLR_NAME_NOT_LOOKED_UP?(r.namesByNotesOrInet[e]=x.namesByNotesOrInet[e],a(e)):a(t)}),x=r}function i(t){n[t]=x.solrNames[t]}function a(t){t in x.botsList?r.botsList[t]=!0:t in x.mailingLists?r.mailingLists[t]=!0:t in x.exonerated&&(r.exonerated[t]=!0)}}};function S(t){if(!t||!t.threads)throw new Error("botOrMailingListService: did not provide threads to analyze");var e={},r={},n=t.exonerated?o()({},t.exonerated):{},i=t.guiltyBots?o()({},t.guiltyBots):{},a=t.guiltyLists?o()({},t.guiltyLists):{};return t.threads.forEach(function(o){if(o.participants&&o.participants.forEach(function(t){r[t]||n[t]||i[t]||a[t]?n[t]||i[t]||(delete r[t],n[t]=!0):e[t]=!0}),o.recipients){var c=o.recipients.indexOf(t.currentUserInet);o.recipients.forEach(function(t){!(c<0)||e[t]||n[t]||i[t]||a[t]?n[t]||!e[t]||a[t]||(delete e[t],n[t]=!0):r[t]=!0})}}),{botsList:e,mailingLists:r,exonerated:n}}var w=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O,n=e(o()({threads:r.threadSelector(),exonerated:r.get("exonerated"),guiltyBots:r.get("botsList"),guiltyLists:r.get("mailingLists")},t));r.putBotNames({guiltyBots:{},exonerated:n.exonerated}),r.putMailingListNames({guiltyLists:{},exonerated:n.exonerated});var i=r.get("namesByNotesOrInet"),c=function(t,e){return i[e]||e};return{botsList:a()(n.botsList,c),mailingLists:a()(n.mailingLists,c)}},E=r(90),L=r.n(E);function N(t,e){return t&&t.strength?{occurance:t.occurance+1,strength:t.strength+e.metadata.strength,target:e.target}:{occurance:1,strength:e.metadata.strength,target:e.target}}var T=function(t,e){return e.strength-t.strength};function A(t){if(!(t&&t.edgesBySource&&t.initialList&&t.limit))throw new Error("SuggestRecipientsService: invalid arguments");var e=t.initialList.map(function(e){return l()(t.edgesBySource[e],t.initialList)}).reduce(function(t,e){return L()(t,e,N)},{});return d()(e).sort(T).slice(0,t.limit).map(function(t){return t.target})}var I=!1,B=function(t){I&&console.log("%c".concat(t),"color: green;")};B.setLogging=function(t){I=!!t},B.createLogger=function(t){return function(e){B("".concat(t,": ").concat(e))}};var M,k,P=B,U=r(49),R=r.n(U),D=P.createLogger("graphConstructor");function z(t,e,r,n){r.forEach(function(r){t.relate(e,r,n),t.relate(r,e,n)})}function C(t,e,r){e.forEach(function(e,n,o){z(t,e,o.slice(n+1),r)})}function F(t){var e=new R.a;return Object.keys(t).forEach(function(r){var n,o=0,i=0,a=!0;Object.keys(t[r]).forEach(function(e){t[r][e].metadata.strength>o&&(o=t[r][e].metadata.strength),void 0!==n&&n!==t[r][e].metadata.strength&&(a=!1),n=t[r][e].metadata.strength,i++}),Object.keys(t[r]).forEach(function(n){a?0!==o&&0!==i?e.relate(r,n,t[r][n].metadata.strength/(o*i)):console.error("graphConstructorService tried to divide by zero."+"Max: ".concat(o," numConnections: ").concat(i)):e.relate(r,n,t[r][n].metadata.strength/o)})}),e.getUndirectedEdgesBySource()}var G={constructGraph:function(t){var e=t.threads,r=t.sentWeight,n=t.noCache,o=t.currentUserInet,i=t.threadMinimum;if(!e)throw new Error("GraphConstructorService: invalid parameters");if(!n&&u()(t,M))return D("Re-using last graph."),k;D("Constructing graph with ".concat(e.length," threads"));var a="number"==typeof i?i:_.MINIMUM_NUMBER_OF_THREADS;if(!n&&e.length<a)return D("Insufficient threads"),null;var c=new R.a,s="number"==typeof r?r:_.DEFAULT_SENT_WEIGHT;e.forEach(function(t){t.initiator===o?C(c,t.recipients,_.INITIATOR_BONUS*s/t.recipients.length):t.participants.indexOf(o)>-1?(C(c,t.recipients,s/t.recipients.length),z(c,t.initiator,t.recipients)):(C(c,t.recipients,1/t.recipients.length),z(c,t.initiator,t.recipients))});var f=F(c.getUndirectedEdgesBySource());return n||(M=t,k=f),f},normalize:F},q=P.createLogger("constructGraphFromDataStore");var V=function(t,e){var r=t.addMessageListener(function(r){var n=e[r.service];n?n(r.params,function(e,n){e?t.postMessage({type:"error",responseId:r.requestId,error:e&&(e.message||e)}):t.postMessage({type:"success",responseId:r.requestId,result:n})}):t.postMessage({type:"error",responseId:r.requestId,message:"No such service: ".concat(r.service)}),r.hasDebugLogging&&P.setLogging(!0)});return function(){return r()}},H=r(89),K=r.n(H),$=function(t){var e=t.blindcopyto,r=t.sinetblindcopyto,n=t.copyto,o=t.sinetcopyto,i=t.sendto,a=t.sinetsendto,c=t.principal,u=t.inetprincipal,s=t.inetfrom,f=i&&i.length>0||a&&a.length>0,p=n&&n.length>0||o&&o.length>0,l=e&&e.length>0||r&&r.length>0;return(c||u||s)&&(f||p||l)};function X(t){return K()(t,["blindcopyto","sinetblindcopyto","copyto","sinetcopyto","sendto","sinetsendto","principal","inetprincipal","inetfrom","unid","tua0"])}var W,J,Z,Y,Q,tt,et,rt;function nt(t){return function(e,r){try{r(null,t(e))}catch(t){r(t)}}}V((Z=self,(Q={__nextRequestNumber:0,__postDelay:10,__MAX_CHUNK_SIZE:25e4,__MAX_CONCURRENT_POSTS:1e4}).postMessage=function(t,e,r){var n=JSON.stringify(e),o=Math.ceil(n.length/Q.__MAX_CHUNK_SIZE);if(0!==o){var i=Q._getRequestID();!function e(a){Y=setTimeout(function(){Y=void 0,t.postMessage({id:i,start:0===a,eom:a===o-1,type:"message-chunk",message:n.substring(a*Q.__MAX_CHUNK_SIZE,a*Q.__MAX_CHUNK_SIZE+Q.__MAX_CHUNK_SIZE)}),a<o-1?e(a+1):r&&r()},Q.__postDelay)}(0)}},Q._getRequestID=function(){var t=Q.__nextRequestNumber%Q.__MAX_CONCURRENT_POSTS;return Q.__nextRequestNumber=t,Q.__nextRequestNumber++,t},Q.destroy=function(){Y&&clearTimeout(Y)},tt=Q,et=function(t){var e={__activeSequences:{},__eventListeners:{},__nextEventListenerID:0,_onMessage:function(t){var r=t.data;"message-chunk"===r.type&&(r.start&&e._newActiveRequest(r.id),e.__activeSequences[r.id]+=r.message,r.eom&&e._emitData(r.id))},addMessageListener:function(t){var r=e.__nextEventListenerID++;return e.__eventListeners[r]=t,function(){delete e.__eventListeners[r]}},_newActiveRequest:function(t){e.__activeSequences[t]=""},_emitData:function(t){Object.keys(e.__eventListeners).forEach(function(r){try{var n=JSON.parse(e.__activeSequences[t]);e.__eventListeners[r](n)}catch(r){console.error("ChunkedPostReceiver failed to parse: ".concat(e.__activeSequences[t]," - ").concat(r))}}),delete e.__activeSequences[t]},destroy:function(){t.removeEventListener("message",e._onMessage),e.__eventListeners=W,e.__activeSequences=W}};return t.addEventListener("message",e._onMessage),e}(Z),(rt={}).addMessageListener=et.addMessageListener,rt.postMessage=tt.postMessage.bind(null,Z),rt.destroy=function(){tt.destroy(),et.destroy(),tt=J,et=J},rt),{botsAndMailingListsFromStore:nt(w),parseAndSaveThreads:nt(function(t){return O.putThreads({threads:function(t){if(!t.responseJson)throw new Error("threadParser: invalid arguments");var e=t.responseJson;if(e.grouped&&e.grouped.tua0&&e.grouped.tua0.groups){var r={};return e.matches.forEach(function(t){r[t.unids[t.unids.length-1]]=!0}),e.grouped.tua0.groups.map(function(t){var e={id:t.doclist.docs[0].tua0,docs:t.doclist.docs.filter($).map(X)},n=!1;return t.doclist.docs.forEach(function(t){r[t.unid]&&(e.maildate=new Date(t.maildate).getTime(),n=!0)}),n||(e.maildate=void 0),e})}if(e.response&&e.response.docs)return e.response.docs.filter($).map(function(t){return{id:t.tua0,docs:[X(t)],maildate:new Date(t.maildate).getTime()}});throw new Error("threadParser: incorrect response")}(l()(t,["replace"])),replace:t.replace})}),constructGraphFromDataStore:nt(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.constructGraph,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O,i=t.oldestTimestamp,a=t.cacheLimit,c=e(t),u=function(e){return r(o()({threads:e},t))};if("number"!=typeof i)throw new Error("constructGraphFromDataStore: Missing timestamp param");q("Trying G1 with ".concat(new Date(i).toISOString()));var s=n.threadSelector({filterTimestamp:i,filterPeople:o()({},c.botsList,c.mailingLists)}),f=u(s),p=f;if(p)return q("G1 success, caching and pruning"),n.set({key:"cachedGraph",value:p}),n.pruneOldThreads(i),{type:"g1",numThreadsUsed:s.length};q("Trying G2");var l=f=u(s=n.threadSelector({filterTimestamp:void 0,filterPeople:o()({},c.botsList,c.mailingLists)}));if(l)return q("G2 success, caching and pruning"),n.set({key:"cachedGraph",value:l}),n.pruneOldThreads(a||i-18144e5),{type:"g2",numThreadsUsed:s.length};q("Looking for a cached graph (G3)");var v=n.get({key:"cachedGraph"});return v&&Object.keys(v).length?(q("G3 successfully aquired"),{type:"g3"}):(q("No graph available."),{type:"failed",numThreadsUsed:s.length})}),suggestRecipientsFromStore:nt(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O,n=r.get("cachedGraph");if(!n)return[];var o=e({initialList:t.initialList,edgesBySource:n,limit:t.limit}),i=r.get("namesByNotesOrInet");return o.map(function(t){return t in i?i[t]:t})}),wake:function(t,e){setTimeout(e,t.time)},getStoreStats:nt(O.getStoreStats),getSerializedStore:nt(O.getSerializedStore),get:nt(O.get),setStore:nt(O.setStore),set:nt(O.set),getInitiatorlessThreadIds:nt(O.getInitiatorlessThreadIds),getNamesToLookUp:nt(O.getNamesToLookUp),putSolrNames:nt(O.putSolrNames),putBotNames:nt(O.putBotNames),putMailingListNames:nt(O.putMailingListNames)})},function(t,e,r){var n=r(29),o=r(10),i=r(27),a=r(2),c=r(9);t.exports=function(t,e,r,u){if(!a(t))return t;for(var s=-1,f=(e=o(e,t)).length,p=f-1,l=t;null!=l&&++s<f;){var v=c(e[s]),d=r;if(s!=p){var h=l[v];void 0===(d=u?u(h,v,l):void 0)&&(d=a(h)?h:i(e[s+1])?[]:{})}n(l,v,d),l=l[v]}return t}},function(t,e,r){var n=r(17),o=r(92),i=r(10);t.exports=function(t,e,r){for(var a=-1,c=e.length,u={};++a<c;){var s=e[a],f=n(t,s);r(f,s)&&o(u,i(s,t),f)}return u}},function(t,e,r){var n=r(93),o=r(68);t.exports=function(t,e){return n(t,e,function(e,r){return o(t,r)})}},function(t,e,r){var n=r(7),o=r(16);t.exports=function(t){return n(t,o(t))}},function(t,e,r){var n=r(55),o=r(63),i=r(59),a=r(62),c=r(58),u=r(25),s=r(1),f=r(65),p=r(24),l=r(48),v=r(2),d=r(57),h=r(44),g=r(54),y=r(95);t.exports=function(t,e,r,b,_,x,m){var j=g(t,r),O=g(e,r),S=m.get(O);if(S)n(t,r,S);else{var w=x?x(j,O,r+"",t,e,m):void 0,E=void 0===w;if(E){var L=s(O),N=!L&&p(O),T=!L&&!N&&h(O);w=O,L||N||T?s(j)?w=j:f(j)?w=a(j):N?(E=!1,w=o(O,!0)):T?(E=!1,w=i(O,!0)):w=[]:d(O)||u(O)?(w=j,u(j)?w=y(j):v(j)&&!l(j)||(w=c(O))):E=!1}E&&(m.set(O,w),_(w,O,b,x,m),m.delete(O)),n(t,r,w)}}},function(t,e,r){var n=r(23),o=r(55),i=r(79),a=r(96),c=r(2),u=r(16),s=r(54);t.exports=function t(e,r,f,p,l){e!==r&&i(r,function(i,u){if(c(i))l||(l=new n),a(e,r,u,f,t,p,l);else{var v=p?p(s(e,u),i,u+"",e,r,l):void 0;void 0===v&&(v=i),o(e,u,v)}},u)}},function(t,e,r){var n=r(33);t.exports=function(t,e){return n(e,function(e){return t[e]})}},function(t,e,r){var n=r(67);t.exports=function(t){return null!=t&&t.length?n(t,1):[]}},function(t,e,r){var n=r(57);t.exports=function(t){return n(t)?void 0:t}},function(t,e){t.exports=function(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(r=r>o?o:r)<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var i=Array(o);++n<o;)i[n]=t[n+e];return i}},function(t,e,r){var n=r(17),o=r(101);t.exports=function(t,e){return e.length<2?t:n(t,o(e,0,-1))}},function(t,e){t.exports=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}},function(t,e,r){var n=r(10),o=r(103),i=r(102),a=r(9);t.exports=function(t,e){return e=n(e,t),null==(t=i(t,e))||delete t[a(o(e))]}},function(t,e,r){var n=r(18),o=r(4),i="[object Set]";t.exports=function(t){return o(t)&&n(t)==i}},function(t,e,r){var n=r(105),o=r(43),i=r(42),a=i&&i.isSet,c=a?o(a):n;t.exports=c},function(t,e,r){var n=r(18),o=r(4),i="[object Map]";t.exports=function(t){return o(t)&&n(t)==i}},function(t,e,r){var n=r(107),o=r(43),i=r(42),a=i&&i.isMap,c=a?o(a):n;t.exports=c},function(t,e,r){var n=r(2),o=Object.create,i=function(){function t(){}return function(e){if(!n(e))return{};if(o)return o(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();t.exports=i},function(t,e,r){var n=r(11),o=n?n.prototype:void 0,i=o?o.valueOf:void 0;t.exports=function(t){return i?Object(i.call(t)):{}}},function(t,e){var r=/\\w*$/;t.exports=function(t){var e=new t.constructor(t.source,r.exec(t));return e.lastIndex=t.lastIndex,e}},function(t,e,r){var n=r(31);t.exports=function(t,e){var r=e?n(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}},function(t,e,r){var n=r(31),o=r(112),i=r(111),a=r(110),c=r(59),u="[object Boolean]",s="[object Date]",f="[object Map]",p="[object Number]",l="[object RegExp]",v="[object Set]",d="[object String]",h="[object Symbol]",g="[object ArrayBuffer]",y="[object DataView]",b="[object Float32Array]",_="[object Float64Array]",x="[object Int8Array]",m="[object Int16Array]",j="[object Int32Array]",O="[object Uint8Array]",S="[object Uint8ClampedArray]",w="[object Uint16Array]",E="[object Uint32Array]";t.exports=function(t,e,r){var L=t.constructor;switch(e){case g:return n(t);case u:case s:return new L(+t);case y:return o(t,r);case b:case _:case x:case m:case j:case O:case S:case w:case E:return c(t,r);case f:return new L;case p:case d:return new L(t);case l:return i(t);case v:return new L;case h:return a(t)}}},function(t,e){var r=Object.prototype.hasOwnProperty;t.exports=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&r.call(t,"index")&&(n.index=t.index,n.input=t.input),n}},function(t,e,r){var n=r(7),o=r(61);t.exports=function(t,e){return n(t,o(t),e)}},function(t,e,r){var n=r(7),o=r(36);t.exports=function(t,e){return n(t,o(t),e)}},function(t,e){t.exports=function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}},function(t,e,r){var n=r(2),o=r(26),i=r(117),a=Object.prototype.hasOwnProperty;t.exports=function(t){if(!n(t))return i(t);var e=o(t),r=[];for(var c in t)("constructor"!=c||!e&&a.call(t,c))&&r.push(c);return r}},function(t,e,r){var n=r(7),o=r(16);t.exports=function(t,e){return t&&n(e,o(e),t)}},function(t,e,r){var n=r(7),o=r(6);t.exports=function(t,e){return t&&n(e,o(e),t)}},function(t,e){t.exports=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t}},function(t,e){t.exports=function(){}},function(t,e,r){var n=r(71),o=r(122),i=r(38),a=n&&1/i(new n([,-0]))[1]==1/0?function(t){return new n(t)}:o;t.exports=a},function(t,e){t.exports=function(t,e,r){for(var n=-1,o=null==t?0:t.length;++n<o;)if(r(e,t[n]))return!0;return!1}},function(t,e){t.exports=function(t,e,r){for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1}},function(t,e){t.exports=function(t){return t!=t}},function(t,e){t.exports=function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}},function(t,e,r){var n=r(127),o=r(126),i=r(125);t.exports=function(t,e,r){return e==e?i(t,e,r):n(t,o,r)}},function(t,e,r){var n=r(128);t.exports=function(t,e){return!(null==t||!t.length)&&n(t,e,0)>-1}},function(t,e,r){var n=r(11),o=r(25),i=r(1),a=n?n.isConcatSpreadable:void 0;t.exports=function(t){return i(t)||o(t)||!!(a&&t&&t[a])}},function(t,e,r){var n=r(17);t.exports=function(t){return function(e){return n(e,t)}}},function(t,e){t.exports=function(t){return function(e){return null==e?void 0:e[t]}}},function(t,e,r){var n=r(132),o=r(131),i=r(35),a=r(9);t.exports=function(t){return i(t)?n(a(t)):o(t)}},function(t,e,r){var n=r(10),o=r(25),i=r(1),a=r(27),c=r(46),u=r(9);t.exports=function(t,e,r){for(var s=-1,f=(e=n(e,t)).length,p=!1;++s<f;){var l=u(e[s]);if(!(p=null!=t&&r(t,l)))break;t=t[l]}return p||++s!=f?p:!!(f=null==t?0:t.length)&&c(f)&&a(l,f)&&(i(t)||o(t))}},function(t,e){t.exports=function(t,e){return null!=t&&e in Object(t)}},function(t,e,r){var n=r(11),o=r(33),i=r(1),a=r(34),c=1/0,u=n?n.prototype:void 0,s=u?u.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(i(e))return o(e,t)+"";if(a(e))return s?s.call(e):"";var r=e+"";return"0"==r&&1/e==-c?"-0":r}},function(t,e,r){var n=r(136);t.exports=function(t){return null==t?"":n(t)}},function(t,e,r){var n=r(40),o="Expected a function";function i(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(o);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var a=t.apply(this,n);return r.cache=i.set(o,a)||i,a};return r.cache=new(i.Cache||n),r}i.Cache=n,t.exports=i},function(t,e,r){var n=r(138),o=500;t.exports=function(t){var e=n(t,function(t){return r.size===o&&r.clear(),t}),r=e.cache;return e}},function(t,e,r){var n=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|(["\'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g,o=/\\\\(\\\\)?/g,i=r(139)(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(n,function(t,r,n,i){e.push(n?i.replace(o,"$1"):r||t)}),e});t.exports=i},function(t,e,r){var n=r(17);t.exports=function(t,e,r){var o=null==t?void 0:n(t,e);return void 0===o?r:o}},function(t,e,r){var n=r(39),o=r(141),i=r(68),a=r(35),c=r(70),u=r(69),s=r(9),f=1,p=2;t.exports=function(t,e){return a(t)&&c(e)?u(s(t),e):function(r){var a=o(r,t);return void 0===a&&a===e?i(r,t):n(e,a,f|p)}}},function(t,e,r){var n=r(70),o=r(6);t.exports=function(t){for(var e=o(t),r=e.length;r--;){var i=e[r],a=t[i];e[r]=[i,a,n(a)]}return e}},function(t,e,r){var n=r(8)(r(3),"WeakMap");t.exports=n},function(t,e,r){var n=r(8)(r(3),"Promise");t.exports=n},function(t,e,r){var n=r(8)(r(3),"DataView");t.exports=n},function(t,e){t.exports=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i}},function(t,e,r){var n=r(74),o=1,i=Object.prototype.hasOwnProperty;t.exports=function(t,e,r,a,c,u){var s=r&o,f=n(t),p=f.length;if(p!=n(e).length&&!s)return!1;for(var l=p;l--;){var v=f[l];if(!(s?v in e:i.call(e,v)))return!1}var d=u.get(t);if(d&&u.get(e))return d==e;var h=!0;u.set(t,e),u.set(e,t);for(var g=s;++l<p;){var y=t[v=f[l]],b=e[v];if(a)var _=s?a(b,y,v,e,t,u):a(y,b,v,t,e,u);if(!(void 0===_?y===b||c(y,b,r,a,u):_)){h=!1;break}g||(g="constructor"==v)}if(h&&!g){var x=t.constructor,m=e.constructor;x!=m&&"constructor"in t&&"constructor"in e&&!("function"==typeof x&&x instanceof x&&"function"==typeof m&&m instanceof m)&&(h=!1)}return u.delete(t),u.delete(e),h}},function(t,e){t.exports=function(t){var e=-1,r=Array(t.size);return t.forEach(function(t,n){r[++e]=[n,t]}),r}},function(t,e,r){var n=r(11),o=r(75),i=r(15),a=r(78),c=r(149),u=r(38),s=1,f=2,p="[object Boolean]",l="[object Date]",v="[object Error]",d="[object Map]",h="[object Number]",g="[object RegExp]",y="[object Set]",b="[object String]",_="[object Symbol]",x="[object ArrayBuffer]",m="[object DataView]",j=n?n.prototype:void 0,O=j?j.valueOf:void 0;t.exports=function(t,e,r,n,j,S,w){switch(r){case m:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case x:return!(t.byteLength!=e.byteLength||!S(new o(t),new o(e)));case p:case l:case h:return i(+t,+e);case v:return t.name==e.name&&t.message==e.message;case g:case b:return t==e+"";case d:var E=c;case y:var L=n&s;if(E||(E=u),t.size!=e.size&&!L)return!1;var N=w.get(t);if(N)return N==e;n|=f,w.set(t,e);var T=a(E(t),E(e),n,j,S,w);return w.delete(t),T;case _:if(O)return O.call(t)==O.call(e)}return!1}},function(t,e){t.exports=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e){var r="__lodash_hash_undefined__";t.exports=function(t){return this.__data__.set(t,r),this}},function(t,e,r){var n=r(23),o=r(78),i=r(150),a=r(148),c=r(18),u=r(1),s=r(24),f=r(44),p=1,l="[object Arguments]",v="[object Array]",d="[object Object]",h=Object.prototype.hasOwnProperty;t.exports=function(t,e,r,g,y,b){var _=u(t),x=u(e),m=_?v:c(t),j=x?v:c(e),O=(m=m==l?d:m)==d,S=(j=j==l?d:j)==d,w=m==j;if(w&&s(t)){if(!s(e))return!1;_=!0,O=!1}if(w&&!O)return b||(b=new n),_||f(t)?o(t,e,r,g,y,b):i(t,e,m,r,g,y,b);if(!(r&p)){var E=O&&h.call(t,"__wrapped__"),L=S&&h.call(e,"__wrapped__");if(E||L){var N=E?t.value():t,T=L?e.value():e;return b||(b=new n),y(N,T,r,g,b)}}return!!w&&(b||(b=new n),a(t,e,r,g,y,b))}},function(t,e,r){var n=r(19);t.exports=function(t,e){var r=n(this,t),o=r.size;return r.set(t,e),this.size+=r.size==o?0:1,this}},function(t,e,r){var n=r(19);t.exports=function(t){return n(this,t).has(t)}},function(t,e,r){var n=r(19);t.exports=function(t){return n(this,t).get(t)}},function(t,e){t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},function(t,e,r){var n=r(19);t.exports=function(t){var e=n(this,t).delete(t);return this.size-=e?1:0,e}},function(t,e,r){var n=r(20),o="__lodash_hash_undefined__";t.exports=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=n&&void 0===e?o:e,this}},function(t,e,r){var n=r(20),o=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return n?void 0!==e[t]:o.call(e,t)}},function(t,e,r){var n=r(20),o="__lodash_hash_undefined__",i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(n){var r=e[t];return r===o?void 0:r}return i.call(e,t)?e[t]:void 0}},function(t,e){t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},function(t,e,r){var n=r(20);t.exports=function(){this.__data__=n?n(null):{},this.size=0}},function(t,e,r){var n=r(164),o=r(163),i=r(162),a=r(161),c=r(160);function u(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}u.prototype.clear=n,u.prototype.delete=o,u.prototype.get=i,u.prototype.has=a,u.prototype.set=c,t.exports=u},function(t,e,r){var n=r(165),o=r(22),i=r(41);t.exports=function(){this.size=0,this.__data__={hash:new n,map:new(i||o),string:new n}}},function(t,e,r){var n=r(22),o=r(41),i=r(40),a=200;t.exports=function(t,e){var r=this.__data__;if(r instanceof n){var c=r.__data__;if(!o||c.length<a-1)return c.push([t,e]),this.size=++r.size,this;r=this.__data__=new i(c)}return r.set(t,e),this.size=r.size,this}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e){t.exports=function(t){return this.__data__.get(t)}},function(t,e){t.exports=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}},function(t,e,r){var n=r(22);t.exports=function(){this.__data__=new n,this.size=0}},function(t,e,r){var n=r(21);t.exports=function(t,e){var r=this.__data__,o=n(r,t);return o<0?(++this.size,r.push([t,e])):r[o][1]=e,this}},function(t,e,r){var n=r(21);t.exports=function(t){return n(this.__data__,t)>-1}},function(t,e,r){var n=r(21);t.exports=function(t){var e=this.__data__,r=n(e,t);return r<0?void 0:e[r][1]}},function(t,e,r){var n=r(21),o=Array.prototype.splice;t.exports=function(t){var e=this.__data__,r=n(e,t);return!(r<0||(r==e.length-1?e.pop():o.call(e,r,1),--this.size,0))}},function(t,e){t.exports=function(){this.__data__=[],this.size=0}},function(t,e,r){var n=r(23),o=r(39),i=1,a=2;t.exports=function(t,e,r,c){var u=r.length,s=u,f=!c;if(null==t)return!s;for(t=Object(t);u--;){var p=r[u];if(f&&p[2]?p[1]!==t[p[0]]:!(p[0]in t))return!1}for(;++u<s;){var l=(p=r[u])[0],v=t[l],d=p[1];if(f&&p[2]){if(void 0===v&&!(l in t))return!1}else{var h=new n;if(c)var g=c(v,d,l,t,e,h);if(!(void 0===g?o(d,v,i|a,c,h):g))return!1}}return!0}},function(t,e,r){var n=r(177),o=r(143),i=r(69);t.exports=function(t){var e=o(t);return 1==e.length&&e[0][2]?i(e[0][0],e[0][1]):function(r){return r===t||n(r,t,e)}}},function(t,e,r){var n=r(178),o=r(142),i=r(47),a=r(1),c=r(133);t.exports=function(t){return"function"==typeof t?t:null==t?i:"object"==typeof t?a(t)?o(t[0],t[1]):n(t):c(t)}},function(t,e){t.exports=function(t){return function(e,r,n){for(var o=-1,i=Object(e),a=n(e),c=a.length;c--;){var u=a[t?c:++o];if(!1===r(i[u],u,i))break}return e}}},function(t,e,r){var n=r(79),o=r(6);t.exports=function(t,e){return t&&n(t,e,o)}},function(t,e,r){var n=r(80)(Object.keys,Object);t.exports=n},function(t,e,r){var n=r(26),o=r(182),i=Object.prototype.hasOwnProperty;t.exports=function(t){if(!n(t))return o(t);var e=[];for(var r in Object(t))i.call(t,r)&&"constructor"!=r&&e.push(r);return e}},function(t,e,r){var n=r(12),o=r(46),i=r(4),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,t.exports=function(t){return i(t)&&o(t.length)&&!!a[n(t)]}},function(t,e){t.exports=function(){return!1}},function(t,e,r){var n=r(12),o=r(4),i="[object Arguments]";t.exports=function(t){return o(t)&&n(t)==i}},function(t,e){t.exports=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}},function(t,e,r){var n=r(15),o=r(14),i=r(27),a=r(2);t.exports=function(t,e,r){if(!a(r))return!1;var c=typeof e;return!!("number"==c?o(r)&&i(e,r.length):"string"==c&&e in r)&&n(r[e],t)}},function(t,e){var r=800,n=16,o=Date.now;t.exports=function(t){var e=0,i=0;return function(){var a=o(),c=n-(a-i);if(i=a,c>0){if(++e>=r)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}},function(t,e){t.exports=function(t){return function(){return t}}},function(t,e,r){var n=r(190),o=r(88),i=r(47),a=o?function(t,e){return o(t,"toString",{configurable:!0,enumerable:!1,value:n(e),writable:!0})}:i;t.exports=a},function(t,e){t.exports=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}},function(t,e){t.exports=function(t,e){return null==t?void 0:t[e]}},function(t,e,r){var n=r(3)["__core-js_shared__"];t.exports=n},function(t,e,r){var n,o=r(194),i=(n=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";t.exports=function(t){return!!i&&i in t}},function(t,e){var r=Object.prototype.toString;t.exports=function(t){return r.call(t)}},function(t,e,r){var n=r(11),o=Object.prototype,i=o.hasOwnProperty,a=o.toString,c=n?n.toStringTag:void 0;t.exports=function(t){var e=i.call(t,c),r=t[c];try{t[c]=void 0;var n=!0}catch(t){}var o=a.call(t);return n&&(e?t[c]=r:delete t[c]),o}},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){var n=r(48),o=r(195),i=r(2),a=r(86),c=/^\\[object .+?Constructor\\]$/,u=Function.prototype,s=Object.prototype,f=u.toString,p=s.hasOwnProperty,l=RegExp("^"+f.call(p).replace(/[\\\\^$.*+?()[\\]{}|]/g,"\\\\$&").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!i(t)||o(t))&&(n(t)?l:c).test(a(t))}}]);'},3497:function(t,e,r){var n=r(406),i=r(952),o=r.dj.c();r(3496),t.exports=n(i,"app/cognitive-es/build/cognitive-worker.js",o)},3498:function(t,e,r){var n,i;n=[r(2),r(24),r(753)],void 0===(i=function(t,e,r){var n=r.cognitiveConstants,i=t([],{serviceDelegator:void 0,constructor:function(e){if(t.safeMixin(this,e),!this.serviceDelegator)throw"DominoRequestQueuer: missing service delegator"},enqueue:function(t){var r=e(i._promiseQueue[0]).then(function(){i._promiseQueue.length>0&&i._promiseQueue.pop()}.bind(this));return i._promiseQueue.unshift(r.then(function(){return this.serviceDelegator.requestService("wake",{time:"number"==typeof t?t:n.ENDPOINT_DELAYS.domino})}.bind(this))),r}});return Object.defineProperty(i,"_promiseQueue",{value:[]}),i}.apply(null,n))||(t.exports=i)},3499:function(t,e,r){var n,i;n=[r(575),r(753),r(497),r(640),r(517),r(1741),r(15),r(1),r(1469)],void 0===(i=function(t,e,r,n,i,o,s,a,u){var h="There isn't a cached store",l="The received cache entry is not was was expected",c=n("dataCollectionUtilities");return{saveState:function(t){return t.requestService("getSerializedStore").then(function(t){return t?o.put("cognitive",{id:"store",data:t},!0):(new s).reject("No store received from service - unable to save state")})},getCachedCognitiveStore:function(){var t=new s;return o.get("cognitive","store",!0).then(function(e){if(!e||e instanceof Error)e&&!e.id&&e instanceof Error&&"NotFoundError"===e.name||null===e?(t.resolve(h),c("Creating new store")):t.resolve(l);else{if(a("cognitive-debug"))try{c("Using cached store",JSON.parse(e.data))}catch(t){console.log("Failed to parse cached store for logging: ",t)}t.resolve(e.data)}}).otherwise(t.resolve.bind(t)),t.promise},syncCognitiveDataStoreService:function(t,e){return e&&e===h?(new s).resolve():t.requestService("setStore",{newStore:e}).otherwise(function(t){c("Restored a corrupted cache - starting with new store: ",t),r.onElement("suggested-recipients-set-store-failed",{type:t.message})})},getNewestMessageIsoDateInStore:function(t){return t.requestService("get",{key:"newestMessageDate"}).then(function(t){return new Date(t).toISOString()})},syncNameController:function(e){return e.requestService("get",{key:"namesByNotesOrInet"}).then(function(e){var r=t(e);c("Adding "+r.length+" names to nameController cache"),i.seedNameCache(r)})},waitRandomInterval:function(t){return t.requestService.bind(t,"wake",{time:u.initialWait()})},findInitialQueryDate:function(t){if(t){var r,n=new Date(t.currentMS),i=e.cognitiveConstants.NUM_DAYS_MAIL_TO_LOAD;return n.setDate(n.getDate()-i),t.cachedISO>=n.toISOString()&&(c("Restoring data collection from where we left off last session.",t.cachedISO),r=t.cachedISO),r}},parseAndPutThreadsJson:function(t,e){return t.requestService("parseAndSaveThreads",{responseJson:e}).then(function(t){return c("knows successful parse of "+t+" threads."),t})},lookupNewNames:function(t,e){return t.requestService("getNamesToLookUp").then(function(t){e.enqueueNames(t)})},reportStoreAnalytics:function(t,e){return t.requestService("getStoreStats",{}).always(function(t){r.onElement("suggested-recipients-data-collect-end",{isSuccess:!0,numThreads:t&&t.numThreads,numNames:t&&t.numNames,numBots:t&&t.numBots,numLists:t&&t.numLists,numNodes:t&&t.numNodes,isMainWindow:e})})},__NO_CACHED_STORE:h,__UNEXPECTED_CACHE_ENTRY:l}}.apply(null,n))||(t.exports=i)},3500:function(t,e,r){var n,i;n=[r(34),r(2),r(45),r(1),r(10),r(47),r(497),r(753)],void 0===(i=function(t,e,r,n,i,o,s,a){var u={dataCollector:void 0,uinfo:void 0,delegator:void 0};return e([r,t],{isGraphConstructed:!1,_processingProms:void 0,constructor:function(t){e.safeMixin(this,t),Object.keys(u).forEach(function(t){if(!this[t])throw new Error("GraphDataProcessor: Missing dependency: "+t)}.bind(this)),this._processingProms=[],this.own(i(this.dataCollector,"state-changed",this._requestGraphConstruction.bind(this)))},isFinishedProcessing:function(){return o(this._processingProms)},_constructGraphParams:function(t){return{threadMinimum:n("bvt")?6:null,currentUserInet:this.uinfo.get("user").toLowerCase(),oldestTimestamp:Math.max((t||0)-a.cognitiveConstants.NUM_MS_TO_GRAPH,0)}},_requestGraphConstruction:function(t){var e=this.delegator.requestService("constructGraphFromDataStore",this._constructGraphParams(t.serverTimeAtLogin)).then(function(t){s.onElement("suggested-recipients-graph-created",{type:t.type,numThreadsUsed:t.numThreadsUsed}),this.isGraphConstructed="failed"!==t.type}.bind(this)).then(this.emit.bind(this,"graph-changed",t));return this._processingProms.push(e),e}})}.apply(null,n))||(t.exports=i)},3501:function(t,e,r){var n=r(631),i=r(158),o=r(815),s=r(687),a=r(1744),u=i(function(t){var e=a(t);return e="function"==typeof e?e:void 0,o(n(t,1,s,!0),void 0,e)});t.exports=u},3502:function(t,e,r){var n,i;function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n=[r(2),r(45),r(15),r(513),r(654),r(3501),r(623),r(575),r(753),r(640)],void 0===(i=function(t,e,r,n,i,s,a,u,h,l){var c=h.cognitiveConstants,f=l("BotLookupQueue");return t([e],{wait:void 0,apiActions:n,_pendingRequest:!1,_outstandingProm:void 0,_outstandingBots:void 0,_outstandingLists:void 0,constructor:function(e){if(this._outstandingLists=[],this._outstandingBots=[],t.safeMixin(this,e),!this.wait)throw"BotLookupQueue: need to specify wait() function when constructing queue!"},_bogusNameReducer:function(t,e){return"string"==typeof e?t[e]=!0:e.display&&(t[e.display]=!0),t},_buildQueue:function(t,e){var r={},n=[];return i(t,function(t){"object"===o(t)&&(t.inet||t.notes)?n.push(t):r=this._bogusNameReducer(r,t)}.bind(this)),e===c.LOOKUP_TYPES.BOT?this._outstandingBots=s(this._outstandingBots,n,a):this._outstandingLists=s(this._outstandingLists,n,a),r},enqueueNames:function(t){var e=this._buildQueue(t.botsList,c.LOOKUP_TYPES.BOT);f("Found "+Object.keys(e).length+" bots immediately"),this._sendInfo({},e,c.LOOKUP_TYPES.BOT);var r=this._buildQueue(t.mailingLists,c.LOOKUP_TYPES.LIST);return f("Found "+Object.keys(r).length+" lists immediately"),this._sendInfo({},r,c.LOOKUP_TYPES.LIST),this._outstandingProm&&!this._outstandingProm.isFulfilled()||(this._outstandingProm=this._kickOffRequests()),this._outstandingProm},hasPendingLookups:function(){return!!(this._pendingRequest||this._outstandingBots.length+this._outstandingLists.length>0)},_kickOffRequests:function(t){var e=t||new r;return this._kick(c.LOOKUP_TYPES.BOT).then(this._kick.bind(this,c.LOOKUP_TYPES.LIST)).then(function(){this.hasPendingLookups()?this._kickOffRequests(e):(e.then(function(t){return delete this._outstandingProm,t}.bind(this)),e.resolve())}.bind(this)).otherwise(e.reject),e.promise},_kick:function(t,e){var n=e||new r,i=t===c.LOOKUP_TYPES.BOT?this._outstandingBots:this._outstandingLists;if(i.length>0&&!this._pendingRequest)f("Waiting to request: "+t),this._pendingRequest=!0,this.wait().then(this._requestBatch.bind(this,t)).then(function(){this._pendingRequest=!1,setTimeout(this._kick.bind(this,t,n),0)}.bind(this)).otherwise(n.reject);else{if(0!==i.length)throw"BotLookupQueue: too many _kicks";n.resolve()}return n.promise},_requestBatch:function(t){var e=t===c.LOOKUP_TYPES.BOT?this._outstandingBots:this._outstandingLists,r=t===c.LOOKUP_TYPES.BOT?c.MAX_BOT_BATCH:c.MAX_LIST_BATCH,n=e.splice(0,r);f("requesting "+n.length);var o={};n.forEach(function(t){(t.inet||t.notes)&&(o[t.inet||t.notes]=t)});var s=u(o);return this.apiActions[t===c.LOOKUP_TYPES.BOT?"botLineup":"mailingListsFollowup"].bind(this.apiActions)(s).then(function(e){var r=e.map(function(t){return t.inet||t.notes}),n={},s={};i(o,function(t,e){r.indexOf(e)>-1?s[e]=t:n[e]=t}),this._sendInfo(n,s,t)}.bind(this))},_sendInfo:function(t,e,r){var n=Object.keys(t).length,i=Object.keys(e).length;if(n||i){f("Giving "+n+" exonerated names"),f("Giving "+i+" confirmed names");var o="found-"+r,s={exonerated:t};s[r===c.LOOKUP_TYPES.BOT?"guiltyBots":"guiltyLists"]=e,this.emit(o,s)}}})}.apply(null,n))||(t.exports=i)},3503:function(t,e,r){var n,i;n=[r(575),r(716),r(2),r(0),r(45),r(15),r(1470),r(640),r(753)],void 0===(i=function(t,e,r,n,i,o,s,a,u){var h=u.cognitiveConstants,l=a("NameLookupQueue");return r([i],{_outstandingNames:void 0,_isWaitingProm:void 0,nameController:void 0,wait:void 0,constructor:function(t){if(this._outstandingNames={},r.safeMixin(this,t),!this.wait||!this.nameController)throw"NameLookupQueue: missing required constructor arguments"},enqueueNames:function(t){l("Queuing "+t.length+" solr names");var e={};return t.filter(function(t){return!this._outstandingNames[t]},this).forEach(function(t){var r=s(t);return r.originalString=t,e=this._preparseName(e,r,function(t){this._outstandingNames[t.originalString]=t}.bind(this)),r},this),this._sendFoundMap(e),this._isWaitingProm&&!this._isWaitingProm.isFulfilled()||(this._isWaitingProm=this._kickOffRequests()),this._isWaitingProm},hasPendingLookups:function(){return!(!Object.keys(this._outstandingNames).length&&!this._pendingRequest)},_kickOffRequests:function(t){var e=t||new o;if(Object.keys(this._outstandingNames).length>0&&!this._pendingRequest)l("Waiting to request..."),this._pendingRequest=!0,this.wait().then(this._requestNameBatch.bind(this)).then(function(t){return setTimeout(this._kickOffRequests.bind(this,e),0),t}.bind(this)).otherwise(e.reject);else{if(0!==Object.keys(this._outstandingNames).length)throw"NameLookupQueue: too many _kicks";e.resolve()}return e.promise},_requestNameBatch:function(){var t=this._getNextNameBatch();return l("requesting "+t.length+" names"),this.nameController.requestNotesNames(t).then(function(){var e=t.reduce(function(t,e){return t[e.originalString]=this._searchNameController(e),t}.bind(this),{});return this._pendingRequest=!1,this._sendFoundMap(e),e}.bind(this))},_preparseName:function(t,e,r){var n=this._searchNameController(e);return n.inet&&n.display?t[e.originalString]=n:r(e),t},_getNextNameBatch:function(){for(var e=[],r={},n=t(this._outstandingNames);n.length&&e.length<h.MAX_NAME_BATCH;){var i=n.shift();delete this._outstandingNames[i.originalString],r=this._preparseName(r,i,function(t){e.push(t)})}return this._sendFoundMap(r),e},_searchNameController:function(t){var r=n.mixin({},t);r.display=null;var i=this.nameController.getNameModel(r);return e(i,["notes","display","inet"])},_sendFoundMap:function(t){var e=Object.keys(t).length;e&&(l("Have name data for "+e+" names"),this.emit("name-data",t))}})}.apply(null,n))||(t.exports=i)},3504:function(t,e,r){var n,i;n=[r(497),r(2),r(15),r(3503),r(3502),r(152),r(640),r(391),r(45),r(10),r(1),r(47),r(27),r(92),r(554),r(2983),r(268),r(753)],void 0===(i=function(t,e,r,n,i,o,s,a,u,h,l,c,f,d,p,v,_,g){var m=void 0,b="Other Window Is Collecting Data. We can stop.",y=s("DataCollector"),w={nameController:m,enqueueDominoRequest:m,util:m,delegator:m,uinfo:m};return e([u,p],{handles:m,subspacePollHandle:m,serverTimeAtLogin:m,nameLookupQueue:m,nameLookupsFinishedDfd:m,gettingCurrentServerTimeProm:m,isCollectingData:m,botAndMailingListProcessingPromises:m,allDocsEndpoint:m,__noNeedToCollect:b,constructor:function(t){e.safeMixin(this,t),Object.keys(w).forEach(function(t){if(!this[t])throw new Error("GraphDataProcessor: Missing dependency: "+t)}.bind(this)),this.botAndMailingListProcessingPromises=[],this.nameLookupsFinishedDfd=new r,this.nameLookupQueue=new n({nameController:this.nameController,wait:this.enqueueDominoRequest}),this.botLookupQueue=new i({wait:this.enqueueDominoRequest}),this.allDocsEndpoint=this.uinfo.get("mailServer")+o.get("mailSearchApiPathPrefix")+"/api/search/searchdocuments"},destroy:function(){this.subspacePollHandle&&this.subspacePollHandle.remove(),this.inherited(arguments)},start:function(){return this.init().then(this._restoreSession.bind(this)).then(function(){if(_.getIsOfflineMode())throw"Feature turned off in offline mode"}).then(this._checkForOtherWindows.bind(this)).then(this._getCurrentServerTime.bind(this)).then(this.util.waitRandomInterval.bind(this.util,this.delegator)).then(t.onElement.bind(t,"suggested-recipients-data-collect-start",{})).then(this._collectData.bind(this)).then(function(t){return y("Collection requests complete, may need to wait for more name lookups."),t}).then(this._determineIfWaitingForNameModelLookups.bind(this)).then(this._botAndMailingListLookup.bind(this)).then(c.bind(c,this.botAndMailingListProcessingPromises)).then(function(t){return y("Bot and mailing list lookups completed"),this.subspacePollHandle&&this.subspacePollHandle.remove(),y("**Data Collector has finished all of it's work!**"),this.util.reportStoreAnalytics(this.delegator,!0).then(function(){return t})}.bind(this)).otherwise(function(e){if(this.isCollectingData=!1,this.subspacePollHandle&&this.subspacePollHandle.remove(),"Feature turned off in offline mode"===e)y("Data Collector is disabled in offline mode."),t.onElement("suggested-recipients-data-collect-end",{isSuccess:!0,isOffline:!0});else{if("Feature not supported"!==e){if(e===b)return y("Data Collector is not collecting data. Another window is collecting data."),this.util.reportStoreAnalytics(this.delegator,!1);throw y("DataCollector error: ",e),t.onElement("suggested-recipients-data-collect-end",{isSuccess:!1}),e}y("Data Collector is not supported with the current verse configuration.")}}.bind(this))},_doInit:function(){return this._listenToSubspace(),this._listenToNameQueue(),(new r).resolve()},_restoreSession:function(){if(!l("offline-support"))throw"Feature not supported";return this.util.getCachedCognitiveStore().then(this.util.syncCognitiveDataStoreService.bind(this.util,this.delegator)).then(this._emitStateChange.bind(this)).then(this.util.syncNameController.bind(this.util,this.delegator)).otherwise(function(){y("Failed to restore session. Starting with new - clean - store."),t.onElement("suggested-recipients-restore-session-fail")})},_collectData:function(){return this.isCollectingData=!0,this.util.getNewestMessageIsoDateInStore(this.delegator).then(function(t){return this.util.findInitialQueryDate({cachedISO:t,currentMS:this.serverTimeAtLogin})}.bind(this)).then(this._recursivelyCollectData.bind(this,null)).then(function(){this.isCollectingData=!1}.bind(this)).otherwise(function(t){throw this.isCollectingData=!1,t}.bind(this))},_recursivelyCollectData:function(t,e){var n,i=!1;t=t||new r;return v().then(this.util.getNewestMessageIsoDateInStore.bind(this.util,this.delegator)).then(function(t){return e?g.getSuggestedRecipientQuery(e):g.getSuggestedRecipientQuery(t)}).then(function(t){return n=t}).then(this._performRequest.bind(this)).then(this.util.parseAndPutThreadsJson.bind(this.util,this.delegator)).then(function(t){t<n.rows&&(i=!0)}).then(this.util.lookupNewNames.bind(this.util,this.delegator,this.nameLookupQueue)).then(this._saveState.bind(this)).then(function(){i?t.resolve():(y("Current message date is: ",new Date(this.serverTimeAtLogin).toISOString()),y("- Performing next sequence. -"),this._recursivelyCollectData(t))}.bind(this)).otherwise(t.reject),t.promise},_botAndMailingListLookup:function(){return function(){return this.delegator.requestService("botsAndMailingListsFromStore",{currentUserInet:this.uinfo.get("user").toLowerCase()}).then(function(t){return y("Setting up for bot and mailing list validation: ",t),function(){this.own(h(this.botLookupQueue,"found-bot",function(t){y("Bots data received",t),this.botAndMailingListProcessingPromises.push(this.delegator.requestService("putBotNames",t).then(this._saveState.bind(this)))}.bind(this)),h(this.botLookupQueue,"found-list",function(t){y("Mailing Lists data received",t),this.botAndMailingListProcessingPromises.push(this.delegator.requestService("putMailingListNames",t).then(this._saveState.bind(this)))}.bind(this)))}.bind(this)(),t}.bind(this)).then(function(t){return y("Queuing "+Object.keys(t.mailingLists).length+" mailing lists"),y("Queuing "+Object.keys(t.botsList).length+" bots"),this.botLookupQueue.enqueueNames(t)}.bind(this))}.bind(this)()},_listenToSubspace:function(){this.subspacePollHandle&&this.subspacePollHandle.remove(),this.subspacePollHandle=h(a,"cognitive-data-poll",function(t,e){e&&(y("Another window is checking for data collection"),f.publish("subspace",{type:"cognitive-data-alive"}),y("Responded that we are collecting data"))}.bind(this))},_checkForOtherWindows:function(){var t,e=new r,n=h(a,"cognitive-data-alive",function(r,i){i&&(n.remove(),clearTimeout(t),y("Other window already collecting data"),e.reject(b))}.bind(this));return y("Checking for other windows..."),f.publish("subspace",{type:"cognitive-data-poll"}),t=setTimeout(function(){n.remove(),y("No other windows responded. Begin data collection"),e.resolve()},2e3),e.promise},_listenToNameQueue:function(){this.own(h(this.nameLookupQueue,"name-data",function(t){this.delegator.requestService("putSolrNames",{solrNames:t}).then(this._saveState.bind(this)).then(this._resolveIfNameLookupsFinished.bind(this))}.bind(this)))},_determineIfWaitingForNameModelLookups:function(){if(!this._resolveIfNameLookupsFinished())return y("Waiting for more name lookups."),this.nameLookupsFinishedDfd.promise},_resolveIfNameLookupsFinished:function(){return!this.isCollectingData&&!this.nameLookupQueue.hasPendingLookups()&&(y("Name lookup sequence Finished"),this.nameLookupsFinishedDfd.resolve(),!0)},_performRequest:function(t){var e={data:t,handleAs:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}};return this.enqueueDominoRequest().then(d.post.bind(d,this.allDocsEndpoint,e)).then(function(t){return y("Received JSON response: ",t),t})},_getCurrentServerTime:function(){if(this.gettingCurrentServerTimeProm)return this.gettingCurrentServerTimeProm();if(this.serverTimeAtLogin)return new r.resolve(this.serverTimeAtLogin);var t=g.getCurrentTimeQuery();return this.gettingCurrentServerTimeProm=this._performRequest(t).then(function(t){var e=t.response.docs[0].maildate;return this.serverTimeAtLogin=new Date(e).getTime(),this.serverTimeAtLogin}.bind(this)),v().then(function(){this.gettingCurrentServerTimeProm.always(function(){this.gettingCurrentServerTimeProm=m}.bind(this))}.bind(this)),this.gettingCurrentServerTimeProm},_saveState:function(){return this.util.saveState(this.delegator).then(this._emitStateChange.bind(this))},_emitStateChange:function(){this.emit("state-changed",{serverTimeAtLogin:this.serverTimeAtLogin})}})}.apply(null,n))||(t.exports=i)},5508:function(t,e,r){(t.exports=r(7)(!1)).push([t.i,".default-font{font-family:HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif}.font2,.msg-row-divider-font{font-family:Helvetica Neue,Helvetica,Arial,sans-serif}.msg-row-divider-font{font-size:12px;font-style:uppercase}.unread-font-style{font-weight:700;color:#121212}.left-panel-title-font{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:16px;font-weight:700}.left-panel-count-font{font-size:12px;font-weight:400;font-family:HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;color:#5a5a5a}.left-panel-item-font{font-size:12px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-weight:400}.set-notification-colors{background-color:#f4f4f4;color:#5a5a5a}.quickAddPanel .hidden .suggestions-list,.resizing .socpimComposeView .hidden .suggestions-list{visibility:hidden}.quickAddPanel .hidden .suggestions-list,.socpimComposeView .hidden .suggestions-list{max-height:0;border:0;visibility:visible}.quickAddPanel .suggestions-list,.socpimComposeView .suggestions-list{overflow:hidden;-webkit-order:1;order:1;transition:max-height .5s;max-height:62px;-webkit-flex-direction:row;flex-direction:row;background-color:#f4f4f4;border-bottom:1px solid #e0e0e0}.quickAddPanel .suggestions-list .label-text,.socpimComposeView .suggestions-list .label-text{white-space:nowrap;margin:0 0 0 20px;padding:0;width:auto;line-height:34px;padding-right:8px}.quickAddPanel .suggestions-list .alert-label,.socpimComposeView .suggestions-list .alert-label{height:0;width:0;font-size:0}.quickAddPanel .suggestions-list .list,.socpimComposeView .suggestions-list .list{border-top:3px solid transparent;border-bottom:3px solid transparent;-webkit-align-items:center;align-items:center;overflow:auto;max-height:inherit;line-height:22px;box-sizing:border-box}.quickAddPanel .suggestions-list .list .people-list,.socpimComposeView .suggestions-list .list .people-list{display:-webkit-flex;display:flex;-webkit-flex-wrap:wrap;flex-wrap:wrap;-webkit-flex-direction:row;flex-direction:row;position:relative;margin:auto}.quickAddPanel .suggestions-list .list .people-list .person,.socpimComposeView .suggestions-list .list .people-list .person{cursor:pointer;margin:1px 6px;padding:2px;text-decoration:underline}.quickAddPanel .suggestions-list .list .people-list .person:focus,.quickAddPanel .suggestions-list .list .people-list .person:hover,.socpimComposeView .suggestions-list .list .people-list .person:focus,.socpimComposeView .suggestions-list .list .people-list .person:hover{color:#325c80;margin:0 5px;border:1px solid #325c80;text-decoration:none}",""])},5510:function(t,e,r){var n=r(5508);"string"==typeof n&&(n=[[t.i,n,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};r(6)(n,i);n.locals&&(t.exports=n.locals)},569:function(t,e,r){var n,i;n=[r(583),r(753),r(3504),r(3500),r(3499),r(3498),r(1471),r(1469),r(1468),r(3495),r(3472)],void 0===(i=function(t,e,r,n,i,o,s,a,u,h,l){return t.enforce("cognitive"),{DataCollector:r,GraphDataProcessor:n,dataCollectionUtilities:i,dominoRequestQueuerClass:o,ServiceDelegator:s,timings:a,workerChannel:u,cognitiveFolderController:h,constructSuggestedRecipientsComponents:l}}.apply(null,n))||(t.exports=i)},622:function(t,e,r){var n=r(631),i=r(866),o=r(158),s=r(172),a=o(function(t,e){if(null==t)return[];var r=e.length;return r>1&&s(t,e[0],e[1])?e=[]:r>2&&s(e[0],e[1],e[2])&&(e=[e[0]]),i(t,n(e,1),[])});t.exports=a},753:function(t,e,r){"use strict";var n,i;function o(t){var e={__activeSequences:{},__eventListeners:{},__nextEventListenerID:0,_onMessage:function(t){var r=t.data;"message-chunk"===r.type&&(r.start&&e._newActiveRequest(r.id),e.__activeSequences[r.id]+=r.message,r.eom&&e._emitData(r.id))},addMessageListener:function(t){var r=e.__nextEventListenerID++;return e.__eventListeners[r]=t,function(){delete e.__eventListeners[r]}},_newActiveRequest:function(t){e.__activeSequences[t]=""},_emitData:function(t){Object.keys(e.__eventListeners).forEach(function(r){try{var n=JSON.parse(e.__activeSequences[t]);e.__eventListeners[r](n)}catch(r){console.error("ChunkedPostReceiver failed to parse: ".concat(e.__activeSequences[t]," - ").concat(r))}}),delete e.__activeSequences[t]},destroy:function(){t.removeEventListener("message",e._onMessage),e.__eventListeners=n,e.__activeSequences=n}};return t.addEventListener("message",e._onMessage),e}function s(){var t,e={};return e.__nextRequestNumber=0,e.__postDelay=10,e.__MAX_CHUNK_SIZE=25e4,e.__MAX_CONCURRENT_POSTS=1e4,e.postMessage=function(r,n,i){var o=JSON.stringify(n),s=Math.ceil(o.length/e.__MAX_CHUNK_SIZE);if(0!==s){var a=e._getRequestID();!function n(u){t=setTimeout(function(){t=void 0,r.postMessage({id:a,start:0===u,eom:u===s-1,type:"message-chunk",message:o.substring(u*e.__MAX_CHUNK_SIZE,u*e.__MAX_CHUNK_SIZE+e.__MAX_CHUNK_SIZE)}),u<s-1?n(u+1):i&&i()},e.__postDelay)}(0)}},e._getRequestID=function(){var t=e.__nextRequestNumber%e.__MAX_CONCURRENT_POSTS;return e.__nextRequestNumber=t,e.__nextRequestNumber++,t},e.destroy=function(){t&&clearTimeout(t)},e}function a(t){var e=s(),r=o(t),n={};return n.addMessageListener=r.addMessageListener,n.postMessage=e.postMessage.bind(null,t),n.destroy=function(){e.destroy(),r.destroy(),e=i,r=i},n}r.r(e);var u={STORE_VERSION_NUMBER:1,STORE_TEMPLATE:Object.freeze({VERSION:1,reducedThreadsById:{},newestMessageDate:0,namesByNotesOrInet:{},solrNames:{},botsList:{},mailingLists:{},exonerated:{},cachedGraph:{}}),SOLR_NAME_NOT_LOOKED_UP:"tbd",INITIATOR_BONUS:3,DEFAULT_SENT_WEIGHT:6,MINIMUM_NUMBER_OF_THREADS:50,NUM_DAYS_MAIL_TO_LOAD:14,NUM_MS_TO_GRAPH:12096e5,MAX_NAME_BATCH:50,MAX_BOT_BATCH:20,MAX_LIST_BATCH:50,LOOKUP_TYPES:{BOT:"bot",LIST:"list"},ENDPOINT_DELAYS:{domino:6e5}},h=function(t){return{start:0,rows:100,thread:1,sent:1,sort:"maildate asc",softdeletion:2,fieldlimit:"unid,tua0,inetfrom,inetprincipal,principal,sendto,copyto,sinetsendto,maildate",query:"*:* AND (maildate:[NOW/DAY-".concat(u.NUM_DAYS_MAIL_TO_LOAD,"DAY TO NOW/DAY%2B2DAY])").concat(t?" AND (maildate:[".concat(t," TO *])"):"")}},l=function(){return{start:0,rows:1,sort:"maildate desc",softdeletion:2,fieldlimit:"maildate",query:"*:*"}};r.d(e,"ChunkedPostReceiver",function(){return o}),r.d(e,"ChunkedPostChannel",function(){return a}),r.d(e,"ChunkedPostSender",function(){return s}),r.d(e,"cognitiveConstants",function(){return u}),r.d(e,"getSuggestedRecipientQuery",function(){return h}),r.d(e,"getCurrentTimeQuery",function(){return l})},781:function(t,e,r){var n=r(81);t.exports=function(t,e){if(t!==e){var r=void 0!==t,i=null===t,o=t==t,s=n(t),a=void 0!==e,u=null===e,h=e==e,l=n(e);if(!u&&!l&&!s&&t>e||s&&a&&h&&!u&&!l||i&&a&&h||!r&&h||!o)return 1;if(!i&&!s&&!l&&t<e||l&&r&&o&&!i&&!s||u&&r&&o||!a&&o||!h)return-1}return 0}},782:function(t,e,r){var n;function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}void 0===(n=function(){function t(e,r,n){if(0!=arguments.length)if(this.x=null,this.x_square=null,this.kernel_type=0,this.degree=0,this.gamma=0,this.coef0=0,this.kernel_type=n.kernel_type,this.degree=n.degree,this.gamma=n.gamma,this.coef0=n.coef0,this.x=function t(e){var r;if(null==e||"object"!=i(e))return e;if(e instanceof Date)return(r=new Date).setTime(e.getTime()),r;if(e instanceof Array){r=[];for(var n=0,o=e.length;n<o;n++)r[n]=t(e[n]);return r}if(e instanceof Object){for(var s in r={},e)e.hasOwnProperty(s)&&(r[s]=t(e[s]));return r}}(r),2==this.kernel_type){this.x_square=function(t,e){for(var r=new Array(t),n=0;n<t;n++)r[n]=e;return r}(e,0);for(var o=0;o<e;o++)this.x_square[o]=t.dot(this.x[o],this.x[o])}else this.x_square=null}return t.prototype.swap_index=function(t,e){var r=this.x[t];if(this.x[t]=this.x[e],this.x[e]=r,null!=this.x_square){r=this.x_square[t];this.x_square[t]=this.x_square[e],this.x_square[e]=r}},t.powi=function(t,e){for(var r=t,n=1,i=e;i>0;i/=2)i%2==1&&(n*=r),r*=r;return n},t.prototype.kernel_function=function(e,r){switch(this.kernel_type){case 0:return t.dot(this.x[e],this.x[r]);case 1:return t.powi(this.gamma*t.dot(this.x[e],this.x[r])+this.coef0,this.degree);case 2:return Math.exp(-this.gamma*(this.x_square[e]+this.x_square[r]-2*t.dot(this.x[e],this.x[r])));case 3:return Math.tanh(this.gamma*t.dot(this.x[e],this.x[r])+this.coef0);case 4:return this.x[e][Math.round(this.x[r][0].value)].value;default:return 0}},t.dot=function(t,e){for(var r=0,n=t.length,i=e.length,o=0,s=0;o<n&&s<i;)t[o].index==e[s].index?r+=t[o++].value*e[s++].value:t[o].index>e[s].index?++s:++o;return r},t.k_function=function(e,r,n){switch(n.kernel_type){case 0:return t.dot(e,r);case 1:return t.powi(n.gamma*t.dot(e,r)+n.coef0,n.degree);case 2:for(var i=0,o=e.length,s=r.length,a=0,u=0;a<o&&u<s;)if(e[a].index==r[u].index){var h=e[a++].value-r[u++].value;i+=h*h}else e[a].index>r[u].index?(i+=r[u].value*r[u].value,++u):(i+=e[a].value*e[a].value,++a);for(;a<o;)i+=e[a].value*e[a].value,++a;for(;u<s;)i+=r[u].value*r[u].value,++u;return Math.exp(-n.gamma*i);case 3:return Math.tanh(n.gamma*t.dot(e,r)+n.coef0);case 4:return e[Math.round(r[0].value)].value;default:return 0}},t}.apply(null,[]))||(t.exports=n)},864:function(t,e,r){var n=r(781);t.exports=function(t,e,r){for(var i=-1,o=t.criteria,s=e.criteria,a=o.length,u=r.length;++i<a;){var h=n(o[i],s[i]);if(h)return i>=u?h:h*("desc"==r[i]?-1:1)}return t.index-e.index}},865:function(t,e){t.exports=function(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t}},866:function(t,e,r){var n=r(157),i=r(118),o=r(949),s=r(865),a=r(161),u=r(864),h=r(102);t.exports=function(t,e,r){var l=-1;e=n(e.length?e:[h],a(i));var c=o(t,function(t,r,i){return{criteria:n(e,function(e){return e(t)}),index:++l,value:t}});return s(c,function(t,e){return u(t,e,r)})}},867:function(t,e,r){var n;void 0===(n=function(){function t(t,e){this.l=0,this.size=0,this.head=null,this.lru_head=null,this.head_t=function(){this.prev=null,this.next=null,this.data=null,this.len=0},this.l=t,this.size=e,this.head=new Array(this.l);for(var r=0;r<this.l;r++)this.head[r]=new this.head_t;this.size/=4,this.size-=4*this.l,this.size=Math.max(this.size,2*this.l),this.lru_head=new this.head_t,this.lru_head.next=this.lru_head.prev=this.lru_head}return t.prototype.lru_delete=function(t){t.prev.next=t.next,t.next.prev=t.prev},t.prototype.lru_insert=function(t){t.next=this.lru_head,t.prev=this.lru_head.prev,t.prev.next=t,t.next.prev=t},t.prototype.get_data=function(t,e,r){var n=this.head[t];n.len>0&&this.lru_delete(n);var i=r-n.len;if(i>0){for(;this.size<i;){var o=this.lru_head.next;this.lru_delete(o),this.size+=o.len,o.data=null,o.len=0}var s=function(t,e){for(var r=new Array(t),n=0;n<t;n++)r[n]=e;return r}(r,0);null!=n.data&&function(t,e,r,n,i){for(var o=0;o<i;o++)r[n+o]=t[e+o]}(n.data,0,s,0,n.len),n.data=s,this.size-=i;var a=n.len;n.len=r,r=a}return this.lru_insert(n),e[0]=n.data,r},t.prototype.swap_index=function(t,e){if(t!=e){this.head[t].len>0&&this.lru_delete(this.head[t]),this.head[e].len>0&&this.lru_delete(this.head[e]);var r=this.head[t].data;this.head[t].data=this.head[e].data,this.head[e].data=r;r=this.head[t].len;if(this.head[t].len=this.head[e].len,this.head[e].len=r,this.head[t].len>0&&this.lru_insert(this.head[t]),this.head[e].len>0&&this.lru_insert(this.head[e]),t>e){r=t;t=e,e=r}for(var n=this.lru_head.next;n!==this.lru_head;n=n.next)if(n.len>t)if(n.len>e){r=n.data[t];n.data[t]=n.data[e],n.data[e]=r}else this.lru_delete(n),this.size+=n.len,n.data=null,n.len=0}},t}.apply(null,[]))||(t.exports=n)},952:function(t,e,r){var n,i;n=[r(1476)],void 0===(i=function(t){var e={};return{load:function(r,n,i){t.load(r,n,i,e,function(t,e){n(["text!"+t],e)})}}}.apply(null,n))||(t.exports=i)}}]);
//# sourceMappingURL=cognitive-VxqSfDzTmnu3C_Lmoj3KtNdPCiuUV8FKBAsNZ6uViu0.js.map